<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>Seth Fischer</title><link href="https://seth.fischer.nz/" rel="alternate"></link><link href="https://seth.fischer.nz/feeds/all.atom.xml" rel="self"></link><id>https://seth.fischer.nz/</id><updated>2021-12-24T09:15:00+13:00</updated><subtitle>Software Engineer</subtitle><entry><title>Leaf battery degradation case A: AZE0 24 kW⋅h—part 3 2021-10</title><link href="https://seth.fischer.nz/leaf-battery-degradation-case-a-part-3.html" rel="alternate"></link><published>2021-12-24T09:15:00+13:00</published><updated>2021-12-24T09:15:00+13:00</updated><author><name>Seth Fischer</name></author><id>tag:seth.fischer.nz,2021-12-24:/leaf-battery-degradation-case-a-part-3.html</id><summary type="html">&lt;p class="first last"&gt;Part&amp;nbsp;3 in a series detailing the state of health (SoH) degradation of
a Nissan Leaf AZE0 24&amp;nbsp;kW⋅h battery.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;Part&amp;nbsp;3 in a series following the state of health (SoH) degradation of a Nissan
Leaf AZE0 24&amp;nbsp;kW⋅h battery.&lt;/p&gt;
&lt;p&gt;Vehicle specification:&lt;/p&gt;
&lt;table class="docutils field-list" frame="void" rules="none"&gt;
&lt;col class="field-name" /&gt;
&lt;col class="field-body" /&gt;
&lt;tbody valign="top"&gt;
&lt;tr class="field"&gt;&lt;th class="field-name"&gt;Vehicle:&lt;/th&gt;&lt;td class="field-body"&gt;Nissan Leaf&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class="field"&gt;&lt;th class="field-name"&gt;Type:&lt;/th&gt;&lt;td class="field-body"&gt;ZAA-AZE0&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class="field"&gt;&lt;th class="field-name"&gt;MY:&lt;/th&gt;&lt;td class="field-body"&gt;2013&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;Articles in the series &lt;em&gt;Nissan Leaf battery degradation case&amp;nbsp;A: AZE0 24&amp;nbsp;kW⋅h&lt;/em&gt;:&lt;/p&gt;
&lt;ol class="arabic simple"&gt;
&lt;li&gt;&lt;a class="reference external" href="https://seth.fischer.nz/leaf-battery-degradation-case-a-part-1.html"&gt;Part&amp;nbsp;1 2019-10&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="https://seth.fischer.nz/leaf-battery-degradation-case-a-part-2.html"&gt;Part&amp;nbsp;2 2020-10&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;Part&amp;nbsp;3 2021-10 (this article).&lt;/li&gt;
&lt;/ol&gt;
&lt;div class="section" id="summary"&gt;
&lt;h2&gt;Summary&lt;/h2&gt;
&lt;table border="1" class="colwidths-auto docutils"&gt;
&lt;caption&gt;2020-10/2021-10&lt;/caption&gt;
&lt;thead valign="bottom"&gt;
&lt;tr&gt;&lt;th class="head"&gt;Period&lt;/th&gt;
&lt;th class="head"&gt;Distance&lt;/th&gt;
&lt;th class="head"&gt;∆SoH&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td&gt;12&amp;nbsp;months&lt;/td&gt;
&lt;td&gt;9 379&amp;nbsp;km&lt;/td&gt;
&lt;td&gt;−3.64 &lt;abbr title="percentage points"&gt;pp&lt;/abbr&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;In the year ending October 2021 the vehicle travelled 9 379&amp;nbsp;km and the SoH
reduced by 3.64 percentage points.&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class="section" id="data"&gt;
&lt;h2&gt;Data&lt;/h2&gt;
&lt;p&gt;Battery parameters were recorded using &lt;a class="reference external" href="https://play.google.com/store/apps/details?id=com.Turbo3.Leaf_Spy_Pro"&gt;Leaf Spy Pro for Android&lt;/a&gt;. The table
below shows the battery parameters for the year ending October 2021.&lt;/p&gt;
&lt;table border="1" class="colwidths-auto docutils"&gt;
&lt;caption&gt;Battery degradation 2020-10/2021-10 as recorded by Leaf Spy.&lt;/caption&gt;
&lt;thead valign="bottom"&gt;
&lt;tr&gt;&lt;th class="head"&gt;Date&lt;/th&gt;
&lt;th class="head"&gt;Odometer (km)&lt;/th&gt;
&lt;th class="head"&gt;A⋅h&lt;/th&gt;
&lt;th class="head"&gt;SoH (%)&lt;/th&gt;
&lt;th class="head"&gt;Hx (%)&lt;/th&gt;
&lt;th class="head"&gt;Fast charges&lt;/th&gt;
&lt;th class="head"&gt;Type 1,2 charges&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td&gt;2020-10-25&lt;/td&gt;
&lt;td&gt;39481&lt;/td&gt;
&lt;td&gt;53.48&lt;/td&gt;
&lt;td&gt;81.77&lt;/td&gt;
&lt;td&gt;75.38&lt;/td&gt;
&lt;td&gt;27&lt;/td&gt;
&lt;td&gt;1396&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;2020-11-17&lt;/td&gt;
&lt;td&gt;40000&lt;/td&gt;
&lt;td&gt;53.10&lt;/td&gt;
&lt;td&gt;81.20&lt;/td&gt;
&lt;td&gt;74.72&lt;/td&gt;
&lt;td&gt;27&lt;/td&gt;
&lt;td&gt;1417&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;2020-12-24&lt;/td&gt;
&lt;td&gt;41386&lt;/td&gt;
&lt;td&gt;56.42&lt;/td&gt;
&lt;td&gt;86.27&lt;/td&gt;
&lt;td&gt;80.88&lt;/td&gt;
&lt;td&gt;37&lt;/td&gt;
&lt;td&gt;1434&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;2021-01-04&lt;/td&gt;
&lt;td&gt;42111&lt;/td&gt;
&lt;td&gt;55.84&lt;/td&gt;
&lt;td&gt;85.38&lt;/td&gt;
&lt;td&gt;79.76&lt;/td&gt;
&lt;td&gt;46&lt;/td&gt;
&lt;td&gt;1440&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;2021-02-08&lt;/td&gt;
&lt;td&gt;42834&lt;/td&gt;
&lt;td&gt;52.80&lt;/td&gt;
&lt;td&gt;80.73&lt;/td&gt;
&lt;td&gt;74.16&lt;/td&gt;
&lt;td&gt;46&lt;/td&gt;
&lt;td&gt;1469&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;2021-04-03&lt;/td&gt;
&lt;td&gt;44197&lt;/td&gt;
&lt;td&gt;52.64&lt;/td&gt;
&lt;td&gt;80.51&lt;/td&gt;
&lt;td&gt;73.90&lt;/td&gt;
&lt;td&gt;46&lt;/td&gt;
&lt;td&gt;1524&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;2021-05-06&lt;/td&gt;
&lt;td&gt;45048&lt;/td&gt;
&lt;td&gt;52.05&lt;/td&gt;
&lt;td&gt;79.85&lt;/td&gt;
&lt;td&gt;72.79&lt;/td&gt;
&lt;td&gt;46&lt;/td&gt;
&lt;td&gt;1572&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;2021-06-05&lt;/td&gt;
&lt;td&gt;45760&lt;/td&gt;
&lt;td&gt;51.90&lt;/td&gt;
&lt;td&gt;79.36&lt;/td&gt;
&lt;td&gt;72.54&lt;/td&gt;
&lt;td&gt;47&lt;/td&gt;
&lt;td&gt;1618&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;2021-07-02&lt;/td&gt;
&lt;td&gt;46232&lt;/td&gt;
&lt;td&gt;51.72&lt;/td&gt;
&lt;td&gt;79.08&lt;/td&gt;
&lt;td&gt;72.20&lt;/td&gt;
&lt;td&gt;47&lt;/td&gt;
&lt;td&gt;1644&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;2021-08-01&lt;/td&gt;
&lt;td&gt;46912&lt;/td&gt;
&lt;td&gt;51.72&lt;/td&gt;
&lt;td&gt;79.09&lt;/td&gt;
&lt;td&gt;72.22&lt;/td&gt;
&lt;td&gt;47&lt;/td&gt;
&lt;td&gt;1682&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;2021-09-02&lt;/td&gt;
&lt;td&gt;47279&lt;/td&gt;
&lt;td&gt;51.93&lt;/td&gt;
&lt;td&gt;79.41&lt;/td&gt;
&lt;td&gt;72.59&lt;/td&gt;
&lt;td&gt;48&lt;/td&gt;
&lt;td&gt;1698&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;2021-10-01&lt;/td&gt;
&lt;td&gt;48032&lt;/td&gt;
&lt;td&gt;51.72&lt;/td&gt;
&lt;td&gt;79.08&lt;/td&gt;
&lt;td&gt;72.21&lt;/td&gt;
&lt;td&gt;49&lt;/td&gt;
&lt;td&gt;1732&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;2021-11-01&lt;/td&gt;
&lt;td&gt;48860&lt;/td&gt;
&lt;td&gt;51.10&lt;/td&gt;
&lt;td&gt;78.13&lt;/td&gt;
&lt;td&gt;71.08&lt;/td&gt;
&lt;td&gt;50&lt;/td&gt;
&lt;td&gt;1772&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;a class="reference external" href="https://seth.fischer.nz/static/leaf-battery-degradation-case-a/part-3/battery-2020-10--2021-10.csv"&gt;Battery degradation 2020-10/2021-10 CSV file&lt;/a&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="observations"&gt;
&lt;h2&gt;Observations&lt;/h2&gt;
&lt;ol class="arabic"&gt;
&lt;li&gt;&lt;p class="first"&gt;The count of Type 1 and 2 charges is higher than actual due to the Leaf's
built-in charge timer recording one charge when the vehicle is plugged in,
and a second when the timer initiates charging.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p class="first"&gt;The increase in SoH from 81.20% to 86.27% in December 2020 is due to a
series of quick charges made on an inter-city journey.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p class="first"&gt;In the year ending October 2021 the vehicle travelled 9 379&amp;nbsp;km and the SoH
reduced by 3.64 percentage points.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p class="first"&gt;On 2021-09-26 it was observed that the eleventh battery capacity level bar
had been lost.&lt;/p&gt;
&lt;img alt="Eleventh battery capacity bar lost in September 2021." src="https://seth.fischer.nz/static/leaf-battery-degradation-case-a/part-3/eleventh-bar-lost-2021-09-26.jpg" /&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p class="first"&gt;From 2021-03-13 the vehicle was parked uncovered.&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
</content><category term="Electric vehicles"></category><category term="EV"></category><category term="Nissan Leaf"></category></entry><entry><title>Include a Git revision in firmware with PlatformIO</title><link href="https://seth.fischer.nz/platformio-git-revision-in-firmware.html" rel="alternate"></link><published>2021-05-20T22:16:00+12:00</published><updated>2021-05-20T22:16:00+12:00</updated><author><name>Seth Fischer</name></author><id>tag:seth.fischer.nz,2021-05-20:/platformio-git-revision-in-firmware.html</id><summary type="html">&lt;p class="first last"&gt;How to include a Git revision in constant your firmware at build time
with PlatformIO.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;How to include a Git revision in your firmware at build time with &lt;a class="reference external" href="https://platformio.org/"&gt;PlatformIO&lt;/a&gt;.&lt;/p&gt;
&lt;div class="contents topic" id="contents"&gt;
&lt;p class="topic-title"&gt;Contents&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;a class="reference internal" href="#project-structure" id="id1"&gt;Project structure&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#configuration-file" id="id2"&gt;Configuration file&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#user-defined-script" id="id3"&gt;User defined script&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#main-cpp" id="id4"&gt;Main.cpp&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#output" id="id5"&gt;Output&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class="admonition note"&gt;
&lt;p class="first admonition-title"&gt;Note&lt;/p&gt;
&lt;p&gt;This article is a comprehensive write up of two PlatformIO issues the
&lt;a class="reference external" href="https://github.com/sethfischer"&gt;author&lt;/a&gt; responded to on GitHub.com in late 2020:&lt;/p&gt;
&lt;ul class="last simple"&gt;
&lt;li&gt;&lt;a class="reference external" href="https://github.com/platformio/platformio-core/issues/3698#issuecomment-704672408"&gt;platformio/platformio-core/issues/3698&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="https://github.com/platformio/platformio-core/issues/3759#issuecomment-740188206"&gt;platformio/platformio-core/issues/3759&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;p&gt;PlatformIO supports the generation of &lt;a class="reference external" href="https://docs.platformio.org/en/latest/projectconf/section_env_build.html#dynamic-build-flags"&gt;dynamic build flags&lt;/a&gt;. This feature
allows the creation of build flags by executing a user defined script. The
script should output one or more gcc &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;-D&lt;/span&gt;&lt;/tt&gt; options to standard output. For
example:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
-D SRC_REVISION=&amp;quot;b4837070c4b10d37acfbf0283b758d38e739a670&amp;quot;
&lt;/pre&gt;
&lt;p&gt;The &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;-D&lt;/span&gt;&lt;/tt&gt; option allows the defination of a macro. From the &lt;a class="reference external" href="https://linux.die.net/man/1/gcc"&gt;gcc(1) man page&lt;/a&gt;:&lt;/p&gt;
&lt;blockquote&gt;
&lt;dl class="docutils"&gt;
&lt;dt&gt;-D name&lt;/dt&gt;
&lt;dd&gt;Predefine name as a macro, with definition 1.&lt;/dd&gt;
&lt;dt&gt;-D name=definition&lt;/dt&gt;
&lt;dd&gt;The contents of definition are tokenized and processed as if they
appeared during translation phase three in a #define directive. In
particular, the definition will be truncated by embedded newline
characters.&lt;/dd&gt;
&lt;/dl&gt;
&lt;/blockquote&gt;
&lt;div class="section" id="project-structure"&gt;
&lt;h2&gt;&lt;a class="toc-backref" href="#id1"&gt;Project structure&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;This example uses a typical PlatformIO project structure:&lt;/p&gt;
&lt;pre class="literal"&gt;
.
├── src
│   └── main.cpp
├── define-git-revision.py
└── platformio.ini
&lt;/pre&gt;&lt;/div&gt;
&lt;div class="section" id="configuration-file"&gt;
&lt;h2&gt;&lt;a class="toc-backref" href="#id2"&gt;Configuration file&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;The script to run is defined by the &lt;tt class="docutils literal"&gt;build_flags&lt;/tt&gt; option in
&lt;tt class="docutils literal"&gt;platformio.ini&lt;/tt&gt;. Scripts are indicated by prepending them with a &lt;tt class="docutils literal"&gt;!&lt;/tt&gt;.&lt;/p&gt;
&lt;pre class="code ini literal-block"&gt;
&lt;span class="k"&gt;[platformio]&lt;/span&gt;
&lt;span class="na"&gt;description&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;Include Git revision in firmware with PlatformIO&lt;/span&gt;

&lt;span class="k"&gt;[env:esp32dev]&lt;/span&gt;
&lt;span class="na"&gt;board&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;esp32dev&lt;/span&gt;
&lt;span class="na"&gt;framework&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;arduino&lt;/span&gt;
&lt;span class="na"&gt;monitor_speed&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;115200&lt;/span&gt;
&lt;span class="na"&gt;platform&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;espressif32&lt;/span&gt;
&lt;span class="na"&gt;build_flags&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;
    &lt;span class="na"&gt;!python3 define-git-revision.py&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;&lt;a class="reference external" href="https://seth.fischer.nz/static/platformio-git-revision-in-firmware/platformio.ini"&gt;Download platformio.ini&lt;/a&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="user-defined-script"&gt;
&lt;h2&gt;&lt;a class="toc-backref" href="#id3"&gt;User defined script&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;The following Python script &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;define-git-revision.py&lt;/span&gt;&lt;/tt&gt; will set two predefined
macros:&lt;/p&gt;
&lt;ol class="arabic simple"&gt;
&lt;li&gt;&lt;tt class="docutils literal"&gt;SRC_REVISION&lt;/tt&gt; containing the Git revision, for example
&lt;tt class="docutils literal"&gt;97c333a4b3c732523e09742318d7acc52b33dbcc&lt;/tt&gt;, and&lt;/li&gt;
&lt;li&gt;&lt;tt class="docutils literal"&gt;SRC_STATE&lt;/tt&gt; defining the state of the working tree as either &lt;tt class="docutils literal"&gt;clean&lt;/tt&gt; or
&lt;tt class="docutils literal"&gt;dirty&lt;/tt&gt;.&lt;/li&gt;
&lt;/ol&gt;
&lt;pre class="code python literal-block"&gt;
&lt;span class="ch"&gt;#!/usr/bin/env python3&lt;/span&gt;
&lt;span class="sd"&gt;&amp;quot;&amp;quot;&amp;quot;Git revision and working tree state&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;

&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;subprocess&lt;/span&gt;

&lt;span class="n"&gt;REVISION&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;subprocess&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;check_output&lt;/span&gt;&lt;span class="p"&gt;([&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;git&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;rev-parse&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;HEAD&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;strip&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;

&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;subprocess&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;check_output&lt;/span&gt;&lt;span class="p"&gt;([&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;git&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;diff&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;--stat&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;strip&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="n"&gt;STATE&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;clean&amp;quot;&lt;/span&gt;
&lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="n"&gt;STATE&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;dirty&amp;quot;&lt;/span&gt;


&lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;-D SRC_REVISION='&lt;/span&gt;&lt;span class="se"&gt;\&amp;quot;&lt;/span&gt;&lt;span class="si"&gt;{}&lt;/span&gt;&lt;span class="se"&gt;\&amp;quot;&lt;/span&gt;&lt;span class="s2"&gt;'&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;REVISION&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;decode&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;UTF-8&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)))&lt;/span&gt;
&lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;-D SRC_STATE='&lt;/span&gt;&lt;span class="se"&gt;\&amp;quot;&lt;/span&gt;&lt;span class="si"&gt;{}&lt;/span&gt;&lt;span class="se"&gt;\&amp;quot;&lt;/span&gt;&lt;span class="s2"&gt;'&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;STATE&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;&lt;a class="reference external" href="https://seth.fischer.nz/static/platformio-git-revision-in-firmware/define-git-revision.py"&gt;Download define-git-revision.py&lt;/a&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="main-cpp"&gt;
&lt;h2&gt;&lt;a class="toc-backref" href="#id4"&gt;Main.cpp&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;The predefined macros may be used in &lt;tt class="docutils literal"&gt;src/main.cpp&lt;/tt&gt; as follows:&lt;/p&gt;
&lt;pre class="code cpp literal-block"&gt;
&lt;span class="cp"&gt;#ifndef UNIT_TEST
&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="cp"&gt;#include&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="cpf"&gt;&amp;lt;Arduino.h&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;
&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="cp"&gt;#ifndef SRC_REVISION
#define SRC_REVISION &amp;quot;(revision not defined)&amp;quot;
#endif
&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="cp"&gt;#ifndef SRC_STATE
#define SRC_STATE &amp;quot;(state not defined)&amp;quot;
#endif
&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;setup&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
    &lt;/span&gt;&lt;span class="n"&gt;Serial&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;begin&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;115200&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;

&lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;loop&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
    &lt;/span&gt;&lt;span class="n"&gt;Serial&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;println&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;SRC_REVISION&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
    &lt;/span&gt;&lt;span class="n"&gt;Serial&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;println&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;SRC_STATE&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
    &lt;/span&gt;&lt;span class="n"&gt;Serial&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;println&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;

    &lt;/span&gt;&lt;span class="n"&gt;delay&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1000&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;

&lt;/span&gt;&lt;span class="cp"&gt;#endif&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;&lt;a class="reference external" href="https://seth.fischer.nz/static/platformio-git-revision-in-firmware/main.cpp"&gt;Download main.cpp&lt;/a&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="output"&gt;
&lt;h2&gt;&lt;a class="toc-backref" href="#id5"&gt;Output&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Example output on the PlatformIO device monitor:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
&amp;gt; Executing task: platformio device monitor &amp;lt;

--- Available filters and text transformations: colorize, debug, default, direct, esp32_exception_decoder, hexlify, log2file, nocontrol, printable, send_on_enter, time
--- More details at http://bit.ly/pio-monitor-filters
--- Miniterm on /dev/ttyUSB0  115200,8,N,1 ---
--- Quit: Ctrl+C | Menu: Ctrl+T | Help: Ctrl+T followed by Ctrl+H ---
b4837070c4b10d37acfbf0283b758d38e739a670
dirty

b4837070c4b10d37acfbf0283b758d38e739a670
dirty
&lt;/pre&gt;
&lt;/div&gt;
</content><category term="Mechatronics"></category><category term="Arduino"></category><category term="Git"></category><category term="PlatformIO"></category><category term="Python"></category></entry><entry><title>Leaf battery degradation case A: AZE0 24 kW⋅h—part 2 2020-10</title><link href="https://seth.fischer.nz/leaf-battery-degradation-case-a-part-2.html" rel="alternate"></link><published>2021-01-11T22:14:00+13:00</published><updated>2021-01-11T22:14:00+13:00</updated><author><name>Seth Fischer</name></author><id>tag:seth.fischer.nz,2021-01-11:/leaf-battery-degradation-case-a-part-2.html</id><summary type="html">&lt;p class="first last"&gt;Part&amp;nbsp;2 in a series detailing the state of health (SoH) degradation of
a Nissan Leaf AZE0 24&amp;nbsp;kW⋅h battery.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;Part&amp;nbsp;2 in a series following the state of health (SoH) degradation of a Nissan
Leaf AZE0 24&amp;nbsp;kW⋅h battery.&lt;/p&gt;
&lt;p&gt;Vehicle specification:&lt;/p&gt;
&lt;table class="docutils field-list" frame="void" rules="none"&gt;
&lt;col class="field-name" /&gt;
&lt;col class="field-body" /&gt;
&lt;tbody valign="top"&gt;
&lt;tr class="field"&gt;&lt;th class="field-name"&gt;Vehicle:&lt;/th&gt;&lt;td class="field-body"&gt;Nissan Leaf&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class="field"&gt;&lt;th class="field-name"&gt;Type:&lt;/th&gt;&lt;td class="field-body"&gt;ZAA-AZE0&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class="field"&gt;&lt;th class="field-name"&gt;MY:&lt;/th&gt;&lt;td class="field-body"&gt;2013&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;Articles in the series &lt;em&gt;Nissan Leaf battery degradation case&amp;nbsp;A: AZE0 24&amp;nbsp;kW⋅h&lt;/em&gt;:&lt;/p&gt;
&lt;ol class="arabic simple"&gt;
&lt;li&gt;&lt;a class="reference external" href="https://seth.fischer.nz/leaf-battery-degradation-case-a-part-1.html"&gt;Part&amp;nbsp;1 2019-10&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;Part&amp;nbsp;2 2020-10 (this article).&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="https://seth.fischer.nz/leaf-battery-degradation-case-a-part-3.html"&gt;Part&amp;nbsp;3 2021-10&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;div class="section" id="summary"&gt;
&lt;h2&gt;Summary&lt;/h2&gt;
&lt;table border="1" class="colwidths-auto docutils"&gt;
&lt;caption&gt;2019-10/2020-10&lt;/caption&gt;
&lt;thead valign="bottom"&gt;
&lt;tr&gt;&lt;th class="head"&gt;Period&lt;/th&gt;
&lt;th class="head"&gt;Distance&lt;/th&gt;
&lt;th class="head"&gt;∆SoH&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td&gt;12&amp;nbsp;months&lt;/td&gt;
&lt;td&gt;8 421&amp;nbsp;km&lt;/td&gt;
&lt;td&gt;−2.77 &lt;abbr title="percentage points"&gt;pp&lt;/abbr&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;A series of DC fast charges gave the SoH a temporary boost of 4.10
percentage points.&lt;/li&gt;
&lt;li&gt;In the year ending October 2019 the vehicle travelled 8 421&amp;nbsp;km and the SoH
reduced by 2.77 percentage points.&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class="section" id="data"&gt;
&lt;h2&gt;Data&lt;/h2&gt;
&lt;p&gt;Battery parameters were recorded using &lt;a class="reference external" href="https://play.google.com/store/apps/details?id=com.Turbo3.Leaf_Spy_Lite"&gt;Leaf Spy for Android&lt;/a&gt;. The table below
shows the battery parameters for the year ending October 2020.&lt;/p&gt;
&lt;table border="1" class="colwidths-auto docutils"&gt;
&lt;caption&gt;Battery degradation 2019-10/2020-10 as recorded by Leaf Spy.&lt;/caption&gt;
&lt;thead valign="bottom"&gt;
&lt;tr&gt;&lt;th class="head"&gt;Date&lt;/th&gt;
&lt;th class="head"&gt;Odometer (km)&lt;/th&gt;
&lt;th class="head"&gt;A⋅h&lt;/th&gt;
&lt;th class="head"&gt;SoH (%)&lt;/th&gt;
&lt;th class="head"&gt;Hx (%)&lt;/th&gt;
&lt;th class="head"&gt;Fast charges&lt;/th&gt;
&lt;th class="head"&gt;Type 1,2 charges&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td&gt;2019-10-07&lt;/td&gt;
&lt;td&gt;31060&lt;/td&gt;
&lt;td&gt;55.31&lt;/td&gt;
&lt;td&gt;84.53&lt;/td&gt;
&lt;td&gt;77.15&lt;/td&gt;
&lt;td&gt;12&lt;/td&gt;
&lt;td&gt;1160&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;2019-10-12&lt;/td&gt;
&lt;td&gt;31873&lt;/td&gt;
&lt;td&gt;57.96&lt;/td&gt;
&lt;td&gt;88.63&lt;/td&gt;
&lt;td&gt;83.85&lt;/td&gt;
&lt;td&gt;21&lt;/td&gt;
&lt;td&gt;1173&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;2019-10-20&lt;/td&gt;
&lt;td&gt;32013&lt;/td&gt;
&lt;td&gt;57.05&lt;/td&gt;
&lt;td&gt;87.24&lt;/td&gt;
&lt;td&gt;82.10&lt;/td&gt;
&lt;td&gt;21&lt;/td&gt;
&lt;td&gt;1176&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;2019-10-27&lt;/td&gt;
&lt;td&gt;32184&lt;/td&gt;
&lt;td&gt;56.45&lt;/td&gt;
&lt;td&gt;86.32&lt;/td&gt;
&lt;td&gt;80.94&lt;/td&gt;
&lt;td&gt;21&lt;/td&gt;
&lt;td&gt;1178&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;2019-11-03&lt;/td&gt;
&lt;td&gt;32322&lt;/td&gt;
&lt;td&gt;55.99&lt;/td&gt;
&lt;td&gt;85.61&lt;/td&gt;
&lt;td&gt;80.04&lt;/td&gt;
&lt;td&gt;21&lt;/td&gt;
&lt;td&gt;1179&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;2019-12-01&lt;/td&gt;
&lt;td&gt;33031&lt;/td&gt;
&lt;td&gt;55.16&lt;/td&gt;
&lt;td&gt;84.35&lt;/td&gt;
&lt;td&gt;78.46&lt;/td&gt;
&lt;td&gt;21&lt;/td&gt;
&lt;td&gt;1189&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;2019-12-09&lt;/td&gt;
&lt;td&gt;33309&lt;/td&gt;
&lt;td&gt;55.28&lt;/td&gt;
&lt;td&gt;84.52&lt;/td&gt;
&lt;td&gt;78.67&lt;/td&gt;
&lt;td&gt;22&lt;/td&gt;
&lt;td&gt;1192&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;2019-12-15&lt;/td&gt;
&lt;td&gt;33463&lt;/td&gt;
&lt;td&gt;55.05&lt;/td&gt;
&lt;td&gt;84.18&lt;/td&gt;
&lt;td&gt;78.24&lt;/td&gt;
&lt;td&gt;23&lt;/td&gt;
&lt;td&gt;1199&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;2019-12-22&lt;/td&gt;
&lt;td&gt;33661&lt;/td&gt;
&lt;td&gt;55.90&lt;/td&gt;
&lt;td&gt;85.47&lt;/td&gt;
&lt;td&gt;79.87&lt;/td&gt;
&lt;td&gt;25&lt;/td&gt;
&lt;td&gt;1206&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;2020-03-10&lt;/td&gt;
&lt;td&gt;35585&lt;/td&gt;
&lt;td&gt;54.45&lt;/td&gt;
&lt;td&gt;83.26&lt;/td&gt;
&lt;td&gt;77.15&lt;/td&gt;
&lt;td&gt;25&lt;/td&gt;
&lt;td&gt;1275&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;2020-08-23&lt;/td&gt;
&lt;td&gt;38123&lt;/td&gt;
&lt;td&gt;54.09&lt;/td&gt;
&lt;td&gt;82.71&lt;/td&gt;
&lt;td&gt;76.50&lt;/td&gt;
&lt;td&gt;27&lt;/td&gt;
&lt;td&gt;1359&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;2020-10-25&lt;/td&gt;
&lt;td&gt;39481&lt;/td&gt;
&lt;td&gt;53.48&lt;/td&gt;
&lt;td&gt;81.77&lt;/td&gt;
&lt;td&gt;75.38&lt;/td&gt;
&lt;td&gt;27&lt;/td&gt;
&lt;td&gt;1396&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;a class="reference external" href="https://seth.fischer.nz/static/leaf-battery-degradation-case-a/part-2/battery-2019-10--2020-10.csv"&gt;Battery degradation 2019-10/2020-10 CSV file&lt;/a&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="observations"&gt;
&lt;h2&gt;Observations&lt;/h2&gt;
&lt;ol class="arabic simple"&gt;
&lt;li&gt;The count of Type 1 and 2 charges is higher than actual due to the Leaf's
built-in charge timer recording one charge when the vehicle is plugged in,
and a second when the timer initiates charging.&lt;/li&gt;
&lt;li&gt;The increase in SoH from 84.53% to 88.63% in October 2019 is due to nine
quick charges with in a 36 hour period while making the delivery journey.&lt;/li&gt;
&lt;li&gt;In the year ending October 2019 the vehicle travelled 8 421&amp;nbsp;km and the SoH
reduced 2.77 percentage points.&lt;/li&gt;
&lt;li&gt;Vehicle was parked under cover.&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
</content><category term="Electric vehicles"></category><category term="EV"></category><category term="Nissan Leaf"></category></entry><entry><title>Leaf battery degradation case A: AZE0 24 kW⋅h—part 1 2019-10</title><link href="https://seth.fischer.nz/leaf-battery-degradation-case-a-part-1.html" rel="alternate"></link><published>2021-01-11T21:48:00+13:00</published><updated>2021-01-11T21:48:00+13:00</updated><author><name>Seth Fischer</name></author><id>tag:seth.fischer.nz,2021-01-11:/leaf-battery-degradation-case-a-part-1.html</id><summary type="html">&lt;p class="first last"&gt;Part&amp;nbsp;1 in a series detailing the state of health (SoH) degradation of
a Nissan Leaf AZE0 24&amp;nbsp;kW⋅h battery.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;Part&amp;nbsp;1 in a series following the state of health (SoH) degradation of a Nissan
Leaf AZE0 24&amp;nbsp;kW⋅h battery.&lt;/p&gt;
&lt;p&gt;Vehicle specification:&lt;/p&gt;
&lt;table class="docutils field-list" frame="void" rules="none"&gt;
&lt;col class="field-name" /&gt;
&lt;col class="field-body" /&gt;
&lt;tbody valign="top"&gt;
&lt;tr class="field"&gt;&lt;th class="field-name"&gt;Vehicle:&lt;/th&gt;&lt;td class="field-body"&gt;Nissan Leaf&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class="field"&gt;&lt;th class="field-name"&gt;Type:&lt;/th&gt;&lt;td class="field-body"&gt;ZAA-AZE0&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class="field"&gt;&lt;th class="field-name"&gt;MY:&lt;/th&gt;&lt;td class="field-body"&gt;2013&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;Articles in the series &lt;em&gt;Nissan Leaf battery degradation case&amp;nbsp;A: AZE0 24&amp;nbsp;kW⋅h&lt;/em&gt;:&lt;/p&gt;
&lt;ol class="arabic simple"&gt;
&lt;li&gt;Part&amp;nbsp;1 2019-10 (this article).&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="https://seth.fischer.nz/leaf-battery-degradation-case-a-part-2.html"&gt;Part&amp;nbsp;2 2020-10&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="https://seth.fischer.nz/leaf-battery-degradation-case-a-part-3.html"&gt;Part&amp;nbsp;3 2021-10&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;div class="section" id="summary"&gt;
&lt;h2&gt;Summary&lt;/h2&gt;
&lt;table border="1" class="colwidths-auto docutils"&gt;
&lt;caption&gt;2013-12/2019-10&lt;/caption&gt;
&lt;thead valign="bottom"&gt;
&lt;tr&gt;&lt;th class="head"&gt;Period&lt;/th&gt;
&lt;th class="head"&gt;Distance&lt;/th&gt;
&lt;th class="head"&gt;∆SoH&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td&gt;70&amp;nbsp;months&lt;/td&gt;
&lt;td&gt;31 060&amp;nbsp;km&lt;/td&gt;
&lt;td&gt;−15.47 &lt;abbr title="percentage points"&gt;pp&lt;/abbr&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;From December 2013 (date of manufacture) to October 2019 the SoH reduced on
average 2.65 percentage points per year to 84.53%.&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class="section" id="data"&gt;
&lt;h2&gt;Data&lt;/h2&gt;
&lt;p&gt;Records started in October 2019 when the vehicle was estimated to be 70 months
old (approximately six years).&lt;/p&gt;
&lt;p&gt;The readings dated 2013-12-01 are theoretical readings of a new battery. The
readings dated 2019-10-07 were made with &lt;a class="reference external" href="https://play.google.com/store/apps/details?id=com.Turbo3.Leaf_Spy_Lite"&gt;Leaf Spy for Android&lt;/a&gt;.&lt;/p&gt;
&lt;table border="1" class="colwidths-auto docutils"&gt;
&lt;caption&gt;Battery degradation 2013-12/2019-10.&lt;/caption&gt;
&lt;thead valign="bottom"&gt;
&lt;tr&gt;&lt;th class="head"&gt;Date&lt;/th&gt;
&lt;th class="head"&gt;Odometer (km)&lt;/th&gt;
&lt;th class="head"&gt;A⋅h&lt;/th&gt;
&lt;th class="head"&gt;SoH (%)&lt;/th&gt;
&lt;th class="head"&gt;Hx (%)&lt;/th&gt;
&lt;th class="head"&gt;Fast charges&lt;/th&gt;
&lt;th class="head"&gt;Type 1,2 charges&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td&gt;2013-12-01&lt;/td&gt;
&lt;td&gt;0&lt;/td&gt;
&lt;td&gt;&amp;nbsp;&lt;/td&gt;
&lt;td&gt;100.00&lt;/td&gt;
&lt;td&gt;100.00&lt;/td&gt;
&lt;td&gt;0&lt;/td&gt;
&lt;td&gt;0&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;2019-10-07&lt;/td&gt;
&lt;td&gt;31060&lt;/td&gt;
&lt;td&gt;55.31&lt;/td&gt;
&lt;td&gt;84.53&lt;/td&gt;
&lt;td&gt;77.15&lt;/td&gt;
&lt;td&gt;12&lt;/td&gt;
&lt;td&gt;1160&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;a class="reference external" href="https://seth.fischer.nz/static/leaf-battery-degradation-case-a/part-1/battery-2013-12--2019-10.csv"&gt;Battery degradation 2013-12/2019-10 CSV file&lt;/a&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="observations"&gt;
&lt;h2&gt;Observations&lt;/h2&gt;
&lt;ol class="arabic simple"&gt;
&lt;li&gt;The month of manufacture is unknown so for the purpose of this articles a
manufacture date of December 2013 has been used.&lt;/li&gt;
&lt;li&gt;SoH declined from 100% to 84.53% from 2013 (year of manufacture) to October
2019, a reduction of 15.47 percentage points. On average this is a
reduction of 2.65 percentage points per year.&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
</content><category term="Electric vehicles"></category><category term="EV"></category><category term="Nissan Leaf"></category></entry><entry><title>An introduction to Drupal 8 development tools</title><link href="https://seth.fischer.nz/drupal-8-development-tools.html" rel="alternate"></link><published>2015-07-07T21:19:00+12:00</published><updated>2015-07-07T21:19:00+12:00</updated><author><name>Seth Fischer</name></author><id>tag:seth.fischer.nz,2015-07-07:/drupal-8-development-tools.html</id><summary type="html">&lt;p class="first"&gt;This Drupal 8 article is obsolete.&lt;/p&gt;
&lt;p class="last"&gt;The use of third party components in Drupal 8 has inspired two new
tools for Drupal 8 developers: the Drupal Console and the Drupal Web
Profiler. Based on the Symfony Console component, the Drupal Console is a
scaffolding generator which allows developers to reduce development time by
automating the generation of boilerplate code. The Drupal Web Profiler is a
port of the Symfony 2 Web Profiler Bundle as a Drupal 8 module providing a
toolbar with convenient access to performance and profile information.&lt;/p&gt;
</summary><content type="html">&lt;div class="admonition warning"&gt;
&lt;p class="first admonition-title"&gt;Warning&lt;/p&gt;
&lt;p class="last"&gt;This Drupal&amp;nbsp;8 article is obsolete. It was published in July 2015, four
months before Drupal&amp;nbsp;8 was released.&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;The use of third party components in &lt;a class="reference external" href="https://www.drupal.org/8"&gt;Drupal&amp;nbsp;8&lt;/a&gt; has inspired two new tools for
Drupal&amp;nbsp;8 developers: the Drupal Console and the Drupal Web Profiler. Based on
the &lt;a class="reference external" href="https://symfony.com/doc/2.7/components/console.html"&gt;Symfony&amp;nbsp;2 Console&lt;/a&gt; component, the &lt;a class="reference external" href="https://drupalconsole.com/"&gt;Drupal Console&lt;/a&gt; is a scaffolding
generator which allows developers to reduce development time by automating the
generation of boilerplate code. The &lt;a class="reference external" href="https://www.drupal.org/project/webprofiler"&gt;Drupal Web Profiler&lt;/a&gt; is a port of the
&lt;a class="reference external" href="https://github.com/symfony/web-profiler-bundle"&gt;Symfony 2 WebProfiler bundle&lt;/a&gt; as a Drupal&amp;nbsp;8 module providing a toolbar with
convenient access to performance and profile information.&lt;/p&gt;
&lt;div class="contents topic" id="contents"&gt;
&lt;p class="topic-title"&gt;Contents&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;a class="reference internal" href="#drupal-console" id="id3"&gt;Drupal Console&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a class="reference internal" href="#commands-in-the-generate-namespace" id="id4"&gt;Commands in the generate namespace&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#additional-commands" id="id5"&gt;Additional commands&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#custom-commands" id="id6"&gt;Custom commands&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#chain-command-execution" id="id7"&gt;Chain command execution&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#web-profiler" id="id8"&gt;Web Profiler&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a class="reference internal" href="#data-collectors" id="id9"&gt;Data collectors&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#profiling-decoupled-requests" id="id10"&gt;Profiling decoupled requests&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#web-profiler-console-commands" id="id11"&gt;Web Profiler console commands&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#further-reading" id="id12"&gt;Further reading&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class="section" id="drupal-console"&gt;
&lt;h2&gt;&lt;a class="toc-backref" href="#id3"&gt;Drupal Console&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;The Drupal Console (&lt;a class="reference external" href="https://github.com/hechoendrupal/drupal-console"&gt;hechoendrupal/DrupalConsole&lt;/a&gt; on GitHub) is a
&lt;a class="reference external" href="https://symfony.com/doc/2.7/components/console.html"&gt;Symfony 2 console application&lt;/a&gt; which provides a number of generators to
assist developers in creating boilerplate code. Drupal Console is a valuable
learning tool which allows developers to get up and running with best practice
code by kick-starting a &lt;a class="reference external" href="https://www.drupal.org/node/2156625"&gt;PSR-4 compliant directory structure&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Commands are namespaced, the top-level namespaces currently being:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;tt class="docutils literal"&gt;cache&lt;/tt&gt;&lt;/li&gt;
&lt;li&gt;&lt;tt class="docutils literal"&gt;config&lt;/tt&gt;&lt;/li&gt;
&lt;li&gt;&lt;tt class="docutils literal"&gt;container&lt;/tt&gt;&lt;/li&gt;
&lt;li&gt;&lt;tt class="docutils literal"&gt;generate&lt;/tt&gt;&lt;/li&gt;
&lt;li&gt;&lt;tt class="docutils literal"&gt;migrate&lt;/tt&gt;&lt;/li&gt;
&lt;li&gt;&lt;tt class="docutils literal"&gt;module&lt;/tt&gt;&lt;/li&gt;
&lt;li&gt;&lt;tt class="docutils literal"&gt;rest&lt;/tt&gt;&lt;/li&gt;
&lt;li&gt;&lt;tt class="docutils literal"&gt;router&lt;/tt&gt;&lt;/li&gt;
&lt;li&gt;&lt;tt class="docutils literal"&gt;site&lt;/tt&gt;&lt;/li&gt;
&lt;li&gt;&lt;tt class="docutils literal"&gt;test&lt;/tt&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="section" id="commands-in-the-generate-namespace"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id4"&gt;Commands in the generate namespace&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;Drupal Console currently has thirteen commands in the generate namespace:&lt;/p&gt;
&lt;dl class="docutils"&gt;
&lt;dt&gt;&lt;tt class="docutils literal"&gt;generate:authentication:provider&lt;/tt&gt;&lt;/dt&gt;
&lt;dd&gt;Generate an authentication provider.&lt;/dd&gt;
&lt;dt&gt;&lt;tt class="docutils literal"&gt;generate:command&lt;/tt&gt;&lt;/dt&gt;
&lt;dd&gt;Generate commands for the console.&lt;/dd&gt;
&lt;dt&gt;&lt;tt class="docutils literal"&gt;generate:controller&lt;/tt&gt;&lt;/dt&gt;
&lt;dd&gt;Generate &amp;amp; register a controller.&lt;/dd&gt;
&lt;dt&gt;&lt;tt class="docutils literal"&gt;generate:entity&lt;/tt&gt;&lt;/dt&gt;
&lt;dd&gt;&lt;ul class="first last simple"&gt;
&lt;li&gt;&lt;tt class="docutils literal"&gt;generate:entity:config&lt;/tt&gt; Generate a new &lt;tt class="docutils literal"&gt;EntityConfig&lt;/tt&gt;.&lt;/li&gt;
&lt;li&gt;&lt;tt class="docutils literal"&gt;generate:entity:content&lt;/tt&gt; Generate a new &lt;tt class="docutils literal"&gt;EntityContent&lt;/tt&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;/dd&gt;
&lt;dt&gt;&lt;tt class="docutils literal"&gt;generate:form:config&lt;/tt&gt;&lt;/dt&gt;
&lt;dd&gt;Generate a new &lt;tt class="docutils literal"&gt;ConfigFormBase&lt;/tt&gt;.&lt;/dd&gt;
&lt;dt&gt;&lt;tt class="docutils literal"&gt;generate:module&lt;/tt&gt;&lt;/dt&gt;
&lt;dd&gt;Generate a module.&lt;/dd&gt;
&lt;dt&gt;&lt;tt class="docutils literal"&gt;generate:permissions&lt;/tt&gt;&lt;/dt&gt;
&lt;dd&gt;Generate module permissions.&lt;/dd&gt;
&lt;dt&gt;&lt;tt class="docutils literal"&gt;generate:plugin&lt;/tt&gt;&lt;/dt&gt;
&lt;dd&gt;&lt;ul class="first last simple"&gt;
&lt;li&gt;&lt;tt class="docutils literal"&gt;generate:plugin:block&lt;/tt&gt; Generate a plugin block.&lt;/li&gt;
&lt;li&gt;&lt;tt class="docutils literal"&gt;generate:plugin:imageeffect&lt;/tt&gt; Generate image effect plugin.&lt;/li&gt;
&lt;li&gt;&lt;tt class="docutils literal"&gt;generate:plugin:rest:resource&lt;/tt&gt; Generate plugin rest resource.&lt;/li&gt;
&lt;li&gt;&lt;tt class="docutils literal"&gt;generate:plugin:rulesaction&lt;/tt&gt; Generate a plugin rule action.&lt;/li&gt;
&lt;/ul&gt;
&lt;/dd&gt;
&lt;dt&gt;&lt;tt class="docutils literal"&gt;generate:service&lt;/tt&gt;&lt;/dt&gt;
&lt;dd&gt;Generate a service.&lt;/dd&gt;
&lt;/dl&gt;
&lt;p class="rubric"&gt;Example: Generating a module&lt;/p&gt;
&lt;p&gt;The examples below demonstrate how a module is generated with
&lt;tt class="docutils literal"&gt;generate:module&lt;/tt&gt; All other commands follow a similar pattern.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$ &lt;/span&gt;drupal generate:module

&lt;span class="go"&gt; Welcome to the Drupal module generator&lt;/span&gt;

&lt;span class="go"&gt;Enter the new module name: awesome&lt;/span&gt;
&lt;span class="go"&gt;Enter the module machine name [awesome]:&lt;/span&gt;
&lt;span class="go"&gt;Enter the module Path [/modules/custom]:&lt;/span&gt;
&lt;span class="go"&gt;Enter module description [My Awesome Module]:&lt;/span&gt;
&lt;span class="go"&gt;Enter package name [Other]:&lt;/span&gt;
&lt;span class="go"&gt;Enter Drupal Core version [8.x]:&lt;/span&gt;
&lt;span class="go"&gt;Do you want to generate a default Controller [no]? yes&lt;/span&gt;
&lt;span class="go"&gt;Would you like to add module dependencies [yes]? no&lt;/span&gt;
&lt;span class="go"&gt;Do you want to generate a unit test class [yes]? yes&lt;/span&gt;
&lt;span class="go"&gt;Do you confirm generation [yes]? yes&lt;/span&gt;

&lt;span class="go"&gt; Generated or updated files&lt;/span&gt;

&lt;span class="go"&gt;Site path: /var/www/drupal8&lt;/span&gt;
&lt;span class="go"&gt;1 - /modules/custom/awesome/awesome.info.yml&lt;/span&gt;
&lt;span class="go"&gt;2 - /modules/custom/awesome/awesome.module&lt;/span&gt;
&lt;span class="go"&gt;3 - /modules/custom/awesome/src/Controller/DefaultController.php&lt;/span&gt;
&lt;span class="go"&gt;4 - /modules/custom/awesome/awesome.routing.yml&lt;/span&gt;
&lt;span class="go"&gt;5 - /modules/custom/awesome/Tests/Controller/DefaultControllerTest.php&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Rather than using the default interactive prompt, options can be passed
to the command.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$ &lt;/span&gt;drupal generate:module &lt;span class="se"&gt;\&lt;/span&gt;
--module&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;awesome&amp;quot;&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
--machine-name&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;awesome&amp;quot;&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
--module-path&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;modules/custom&amp;quot;&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
--description&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;My Awesome Module&amp;quot;&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
--core&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;8.x&amp;quot;&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
--package&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Other&amp;quot;&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
--controller &lt;span class="se"&gt;\&lt;/span&gt;
--dependencies
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="additional-commands"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id5"&gt;Additional commands&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;In addition to commands in the generate namespace Drupal Console has many other
commands. Run &lt;tt class="docutils literal"&gt;drupal list&lt;/tt&gt; to list available commands. Modules can define
their own commands so the available commands may vary according to the modules
installed.&lt;/p&gt;
&lt;p&gt;Site status information may be viewed with the command &lt;tt class="docutils literal"&gt;site:status&lt;/tt&gt;,
optionally passing the &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;--format=json&lt;/span&gt;&lt;/tt&gt; option.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$ &lt;/span&gt;drupal site:status --format&lt;span class="o"&gt;=&lt;/span&gt;json
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Output of preceding command:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;quot;system&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;quot;Drupal&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;8.0.0-dev&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;quot;Access to update.php&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Protected&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;quot;Configuration files&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Protected&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;quot;Cron maintenance tasks&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Last run 44 min 45 sec ago&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;quot;D3.js library&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Enabled&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;quot;Database system&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;MySQL, MariaDB, Percona Server, or equivalent&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;quot;Database system version&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;5.5.43-0+deb7u1&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;quot;Database updates&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Out of date&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;quot;Drupal core update status&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;lt;a href=\&amp;quot;\/admin\/reports\/updates\&amp;quot;&amp;gt;Unknown release date (version 8.0.0-beta11 available)&amp;lt;\/a&amp;gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;quot;File system&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Writable (&amp;lt;em&amp;gt;public&amp;lt;\/em&amp;gt; download method)&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;quot;GD library&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;2.0.36&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;quot;GD library PNG support&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;2.0.36&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;quot;Image toolkit&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;gd&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;quot;Module and theme update status&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;lt;a href=\&amp;quot;\/admin\/reports\/updates\&amp;quot;&amp;gt;Out of date&amp;lt;\/a&amp;gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;quot;Node Access Permissions&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Disabled&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;quot;PHP&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;5.4.41-0+deb7u1 (&amp;lt;a href=\&amp;quot;\/admin\/reports\/status\/php\&amp;quot;&amp;gt;more information&amp;lt;\/a&amp;gt;)&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;quot;PHP extensions&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Enabled&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;quot;PHP memory limit&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;-1 (Unlimited)&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;quot;Search index progress&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;100% (0 remaining)&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;quot;Trusted Host Settings&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Not enabled&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;quot;Unicode library&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;PHP Mbstring Extension&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;quot;Update notifications&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Enabled&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;quot;Upload progress&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Not enabled&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;quot;Web server&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;quot;highlight.js library&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Enabled&amp;quot;&lt;/span&gt;
    &lt;span class="p"&gt;},&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;quot;database&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;quot;Driver&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;mysql&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;quot;Host&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;localhost&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;quot;Database connection&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;drupal8&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;quot;Port&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;quot;Username&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;drupal8&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;quot;Password&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;redacted&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;quot;Connection&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;mysql\/\/drupal8:redacted@localhost\/drupal8&amp;quot;&lt;/span&gt;
    &lt;span class="p"&gt;},&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;quot;theme&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;quot;theme_default&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;bartik&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;quot;theme_admin&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;seven&amp;quot;&lt;/span&gt;
    &lt;span class="p"&gt;},&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;quot;directory&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;quot;Site root directory&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;\/var\/www\/drupal8\/&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;quot;Site temporary directory&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;\/tmp&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;quot;Default theme directory&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;\/core\/themes\/bartik&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;quot;Admin theme directory&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;\/core\/themes\/seven&amp;quot;&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="custom-commands"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id6"&gt;Custom commands&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;Modules may define commands by extending
&lt;tt class="docutils literal"&gt;Symfony\Component\Console\Command\Command&lt;/tt&gt;. Drupal Console can create
scaffolding for a custom command with the command &lt;tt class="docutils literal"&gt;generate:command&lt;/tt&gt;. Refer
to the &lt;a class="reference external" href="https://symfony.com/doc/2.7/components/console.html"&gt;Symfony&amp;nbsp;2 Console Component documentation&lt;/a&gt; for additional information.
For an example implementation refer to the source code of Web Profiler
&lt;tt class="docutils literal"&gt;git clone &lt;span class="pre"&gt;http://git.drupal.org/project/webprofiler.git&lt;/span&gt;&lt;/tt&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="chain-command-execution"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id7"&gt;Chain command execution&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;Commands may be recorded in YAML and executed with the &lt;tt class="docutils literal"&gt;chain&lt;/tt&gt; command:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$ &lt;/span&gt;drupal chain --file&lt;span class="o"&gt;=&lt;/span&gt;~/d8-project-init.yml
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;In the example below a module is created, followed by a controller for that
module.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# d8-project-init.yml&lt;/span&gt;
&lt;span class="nt"&gt;commands&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="nt"&gt;command&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;generate:module&lt;/span&gt;
      &lt;span class="nt"&gt;options&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="nt"&gt;module&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;awesome&lt;/span&gt;
        &lt;span class="nt"&gt;machine-name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;awesome&lt;/span&gt;
        &lt;span class="nt"&gt;module-path&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;/modules/custom/&lt;/span&gt;
        &lt;span class="nt"&gt;description&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;My Awesome module&lt;/span&gt;
        &lt;span class="nt"&gt;core&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;8.x&lt;/span&gt;
        &lt;span class="nt"&gt;package&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;Test&lt;/span&gt;
        &lt;span class="nt"&gt;controller&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;false&lt;/span&gt;
        &lt;span class="nt"&gt;dependencies&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="nt"&gt;test&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;false&lt;/span&gt;
    &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="nt"&gt;command&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;generate:controller&lt;/span&gt;
      &lt;span class="nt"&gt;options&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="nt"&gt;module&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;awesome&lt;/span&gt;
        &lt;span class="nt"&gt;class-name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;AwesomeController&lt;/span&gt;
        &lt;span class="nt"&gt;method-name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;index&lt;/span&gt;
        &lt;span class="nt"&gt;route&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;/awesome/index&lt;/span&gt;
        &lt;span class="nt"&gt;services&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;twig&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="web-profiler"&gt;
&lt;h2&gt;&lt;a class="toc-backref" href="#id8"&gt;Web Profiler&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;The &lt;a class="reference external" href="https://www.drupal.org/project/webprofiler"&gt;Drupal Web Profiler&lt;/a&gt; provides convenient access to a selection of
performance and profile information on a per request basis.&lt;/p&gt;
&lt;div class="section" id="data-collectors"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id9"&gt;Data collectors&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;The Web Profiler provides a number of data collectors which include:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;PHP configuration&lt;/li&gt;
&lt;li&gt;route and controller name&lt;/li&gt;
&lt;li&gt;page load timeline and memory use&lt;/li&gt;
&lt;li&gt;front-end statistics (timings for: DNS lookup time; TCP handshake;
&lt;abbr title="Time to first byte"&gt;TTFB&lt;/abbr&gt;; data download; and DOM build)&lt;/li&gt;
&lt;li&gt;database query time and number of queries&lt;/li&gt;
&lt;li&gt;authentication details&lt;/li&gt;
&lt;li&gt;number of views&lt;/li&gt;
&lt;li&gt;number of blocks loaded and rendered&lt;/li&gt;
&lt;li&gt;number of modules and themes available&lt;/li&gt;
&lt;li&gt;cache statistics&lt;/li&gt;
&lt;li&gt;asset statistics&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;A summary of the data collected is displayed in the Web Profiler toolbar
which is displayed along the lower edge of the viewport.&lt;/p&gt;
&lt;figure&gt;
    &lt;picture&gt;
        &lt;source srcset="/static/drupal-8-development-tools/drupal-8-webprofiler-toolbar-large.png"
            media="(min-width: 950px)"/&gt;
        &lt;img src="/static/drupal-8-development-tools/drupal-8-webprofiler-toolbar-medium.png"
            alt="Drupal 8 Web Profiler toolbar"/&gt;
    &lt;/picture&gt;
    &lt;figcaption&gt;The Drupal 8 Web Profiler toolbar.&lt;/figcaption&gt;
&lt;/figure&gt;&lt;p&gt;Additional detail for each data collector may be viewed by clicking the
relevant icon in the toolbar overlay. Below is the detailed report for the page
load timeline.&lt;/p&gt;
&lt;figure&gt;
    &lt;picture&gt;
        &lt;source srcset="/static/drupal-8-development-tools/drupal-8-webprofiler-report-large.png"
            media="(min-width: 950px)"/&gt;
        &lt;source srcset="/static/drupal-8-development-tools/drupal-8-webprofiler-report-medium.png"
            media="(min-width: 600px)"/&gt;
        &lt;img src="/static/drupal-8-development-tools/drupal-8-webprofiler-report-small.png"
            alt="Drupal 8 Web Profiler toolbar"/&gt;
    &lt;/picture&gt;
    &lt;figcaption&gt;Example of a Drupal 8 Web Profiler report timeline.&lt;/figcaption&gt;
&lt;/figure&gt;&lt;/div&gt;
&lt;div class="section" id="profiling-decoupled-requests"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id10"&gt;Profiling decoupled requests&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;The included &lt;a class="reference external" href="https://www.drupal.org/docs/8/api/routing-system/routing-system-overview"&gt;HTTP routing framework&lt;/a&gt; and &lt;a class="reference external" href="https://www.drupal.org/docs/8/core/modules/rest/overview"&gt;REST API&lt;/a&gt; modules in Drupal&amp;nbsp;8
make it easier to develop decoupled, or headless, applications using a
client-side framework such as &lt;a class="reference external" href="https://emberjs.com/"&gt;ember.js&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;When profiling an API or headless request the Web Profiler toolbar is not
available. However the profile data remains available for each request via a
token and link provided in the HTTP response headers &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;X-Debug-Token&lt;/span&gt;&lt;/tt&gt; and
&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;X-Debug-Token-Link&lt;/span&gt;&lt;/tt&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kr"&gt;HTTP&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="m"&gt;1.1&lt;/span&gt; &lt;span class="m"&gt;200&lt;/span&gt; &lt;span class="ne"&gt;OK&lt;/span&gt;
&lt;span class="na"&gt;Date&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="l"&gt;Fri, 26 Jun 2015 23:53:36 GMT&lt;/span&gt;
&lt;span class="na"&gt;Server&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="l"&gt;Apache/2.2.22 (Debian)&lt;/span&gt;
&lt;span class="na"&gt;X-Generator&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="l"&gt;Drupal 8 (https://www.drupal.org)&lt;/span&gt;
&lt;span class="na"&gt;X-Debug-Token&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="l"&gt;0ac668&lt;/span&gt;
&lt;span class="na"&gt;X-Debug-Token-Link&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="l"&gt;/admin/reports/profiler/view/0ac668&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Visiting the X-Debug-Token-Link (in this case
&lt;tt class="docutils literal"&gt;/admin/reports/profiler/view/0ac668&lt;/tt&gt;) provides access to the report for the
relevant request.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="web-profiler-console-commands"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id11"&gt;Web Profiler console commands&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;Web profiler provides three console commands:&lt;/p&gt;
&lt;dl class="docutils"&gt;
&lt;dt&gt;&lt;tt class="docutils literal"&gt;webprofiler:benchmark&lt;/tt&gt;&lt;/dt&gt;
&lt;dd&gt;Benchmark a URL.&lt;/dd&gt;
&lt;dt&gt;&lt;tt class="docutils literal"&gt;webprofiler:export&lt;/tt&gt;&lt;/dt&gt;
&lt;dd&gt;Export Web Profiler profiles to file.&lt;/dd&gt;
&lt;dt&gt;&lt;tt class="docutils literal"&gt;webprofiler:list&lt;/tt&gt;&lt;/dt&gt;
&lt;dd&gt;List Web Profiler profiles.&lt;/dd&gt;
&lt;/dl&gt;
&lt;p class="rubric"&gt;Benchmark a URL&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$ &lt;/span&gt;drupal webprofiler:benchmark http://drupal8/
&lt;span class="go"&gt; 105/105 [============================] 100% Done.&lt;/span&gt;
&lt;span class="go"&gt;date: &amp;#39;Sun, 06/28/2015 - 21:00:43&amp;#39;&lt;/span&gt;
&lt;span class="go"&gt;git_commit: &amp;quot;e39a32842072bfbaa2b15c5284625ff63ebc4a08\n&amp;quot;&lt;/span&gt;
&lt;span class="go"&gt;number_of_runs: 100&lt;/span&gt;
&lt;span class="go"&gt;url: &amp;#39;http://drupal8/&amp;#39;&lt;/span&gt;
&lt;span class="go"&gt;results:&lt;/span&gt;
&lt;span class="go"&gt;    average: { time: &amp;#39;340 ms&amp;#39;, memory: &amp;#39;38.8 MB&amp;#39; }&lt;/span&gt;
&lt;span class="go"&gt;    median: { time: &amp;#39;336 ms&amp;#39;, memory: &amp;#39;38.8 MB&amp;#39; }&lt;/span&gt;
&lt;span class="go"&gt;    95_percentile: { time: &amp;#39;326 ms&amp;#39;, memory: &amp;#39;38.8 MB&amp;#39; }&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p class="rubric"&gt;Export profile data to a file for later analysis&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$ &lt;/span&gt;drupal webprofiler:export --directory&lt;span class="o"&gt;=&lt;/span&gt;/tmp/
&lt;span class="go"&gt; 266/266 [============================] 100% Done.&lt;/span&gt;
&lt;span class="go"&gt;Exported 264 profiles&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p class="rubric"&gt;List and filter profiles&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$ &lt;/span&gt;drupal webprofiler:list --url&lt;span class="o"&gt;=&lt;/span&gt;http://drupal8/ --method&lt;span class="o"&gt;=&lt;/span&gt;GET --limit&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;5&lt;/span&gt;
&lt;span class="go"&gt;+--------+-----------+--------+-----------------+----------------------------+&lt;/span&gt;
&lt;span class="go"&gt;| Token  | IP        | Method | URL             | Time                       |&lt;/span&gt;
&lt;span class="go"&gt;+--------+-----------+--------+-----------------+----------------------------+&lt;/span&gt;
&lt;span class="go"&gt;| 6f6333 | 127.0.0.1 | GET    | http://drupal8/ | Sun, 06/28/2015 - 20:57:01 |&lt;/span&gt;
&lt;span class="go"&gt;| 429e2e | 127.0.0.1 | GET    | http://drupal8/ | Sun, 06/28/2015 - 20:57:00 |&lt;/span&gt;
&lt;span class="go"&gt;| dc1461 | 127.0.0.1 | GET    | http://drupal8/ | Sun, 06/28/2015 - 20:57:00 |&lt;/span&gt;
&lt;span class="go"&gt;| d00a91 | 127.0.0.1 | GET    | http://drupal8/ | Sun, 06/28/2015 - 20:56:59 |&lt;/span&gt;
&lt;span class="go"&gt;| ef359a | 127.0.0.1 | GET    | http://drupal8/ | Sun, 06/28/2015 - 20:56:59 |&lt;/span&gt;
&lt;span class="go"&gt;+--------+-----------+--------+-----------------+----------------------------+&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="further-reading"&gt;
&lt;h2&gt;&lt;a class="toc-backref" href="#id12"&gt;Further reading&lt;/a&gt;&lt;/h2&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;a class="reference external" href="https://www.gitbook.com/book/hechoendrupal/drupal-console/details"&gt;The Drupal Console book&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="https://symfony.com/doc/2.7/profiler/data_collector.html"&gt;How to create a custom data collector&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="https://drupalize.me/blog/201401/introduction-restful-web-services-drupal-8"&gt;An introduction to RESTful web services in Drupal 8&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="https://pantheon.io/blog/headless-websites-whats-big-deal-decoupled-architecture"&gt;Headless websites: What’s the big deal?&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
</content><category term="Web development"></category><category term="Drupal 8"></category><category term="Drupal"></category></entry><entry><title>Symfony 2 PDF service using LaTeX</title><link href="https://seth.fischer.nz/symfony-2-latex-pdf-service.html" rel="alternate"></link><published>2015-04-19T20:11:00+12:00</published><updated>2015-04-19T20:11:00+12:00</updated><author><name>Seth Fischer</name></author><id>tag:seth.fischer.nz,2015-04-19:/symfony-2-latex-pdf-service.html</id><summary type="html">&lt;p class="first"&gt;This Symfony 2 article is obsolete.&lt;/p&gt;
&lt;p class="last"&gt;Portable Document Format (PDF) has become a universally accepted format
for sharing documentation. As a result, the dynamic generation of PDF
documents is an expected feature of many web applications. After reviewing
a number of libraries for generating PDF documents it was decided to write
a service wrapping the LaTeX typesetting system . LaTeX is ideally suited
to the production of scientific and technical documentation.&lt;/p&gt;
</summary><content type="html">&lt;div class="admonition warning"&gt;
&lt;p class="first admonition-title"&gt;Warning&lt;/p&gt;
&lt;p class="last"&gt;This Symfony&amp;nbsp;2 article is obsolete. Symfony&amp;nbsp;2 reached end-of-life in
November 2018.&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;Portable Document Format (PDF) has become a universally accepted format for
sharing documentation. As a result, the dynamic generation of PDF documents is
an expected feature of many web applications. After reviewing a number of
libraries for generating PDF documents it was decided to write a service
wrapping the &lt;a class="reference external" href="https://www.latex-project.org/"&gt;LaTeX&lt;/a&gt; typesetting system . LaTeX is ideally suited to the
production of scientific and technical documentation.&lt;/p&gt;
&lt;p&gt;The code examples used in this article are from the certificate generation
component of IB2020, a &lt;a class="reference external" href="https://symfony.com/"&gt;Symfony&lt;/a&gt; 2 web application for the management of
welder qualifications.&lt;/p&gt;
&lt;div class="contents topic" id="contents"&gt;
&lt;p class="topic-title"&gt;Contents&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;a class="reference internal" href="#pdf-generating-libraries" id="id2"&gt;PDF generating libraries&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#latex" id="id3"&gt;LaTeX&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#symfony-2-service" id="id4"&gt;Symfony 2 service&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a class="reference internal" href="#configure-the-service-container" id="id5"&gt;Configure the service container&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#service-object" id="id6"&gt;Service object&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#twig-template" id="id7"&gt;Twig template&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#utilising-the-service" id="id8"&gt;Utilising the service&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#further-reading" id="id9"&gt;Further reading&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class="section" id="pdf-generating-libraries"&gt;
&lt;h2&gt;&lt;a class="toc-backref" href="#id2"&gt;PDF generating libraries&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Before implementing the LaTeX service the following PDF generating libraries
were considered:&lt;/p&gt;
&lt;ol class="arabic simple"&gt;
&lt;li&gt;&lt;a class="reference external" href="https://sourceforge.net/projects/tcpdf/"&gt;TCPDF&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;HTML layout and rendering engine written in PHP.&lt;/li&gt;
&lt;li&gt;Coordinate-based interface.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="https://github.com/dompdf/dompdf"&gt;dompdf&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;HTML layout and rendering engine written in PHP.&lt;/li&gt;
&lt;li&gt;Style-driven renderer.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="https://github.com/wkhtmltopdf/wkhtmltopdf"&gt;wkhtmltopdf&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;Command line tools to render HTML into PDF (and various other image
formats) using the QT WebKit rendering engine.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="https://github.com/KnpLabs/KnpSnappyBundle"&gt;KnpLabs/KnpSnappyBundle&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;Symfony&amp;nbsp;2 bundle wrapping &lt;tt class="docutils literal"&gt;wkhtmltopdf&lt;/tt&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="https://github.com/zendframework/ZendPdf/"&gt;zendframework/ZendPdf&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;HTML layout and rendering engine written in PHP.&lt;/li&gt;
&lt;li&gt;Coordinate-based interface.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
&lt;div class="section" id="latex"&gt;
&lt;h2&gt;&lt;a class="toc-backref" href="#id3"&gt;LaTeX&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;The LaTeX system is a markup language and high-quality typesetting system. It
is written in the &lt;a class="reference external" href="http://tug.org/"&gt;TeX macro language&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;A PDF document may be generated directly from a LaTeX source document with the
&lt;tt class="docutils literal"&gt;pdflatex&lt;/tt&gt; binary, part of the Debian &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;texlive-full&lt;/span&gt;&lt;/tt&gt; meta-package. Some
LaTeX documents require multiple passes with &lt;tt class="docutils literal"&gt;pdflatex&lt;/tt&gt;, a process which is
automated with the script &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;rubber-pipe&lt;/span&gt;&lt;/tt&gt;.&lt;/p&gt;
&lt;p&gt;LaTeX and &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;rubber-pipe&lt;/span&gt;&lt;/tt&gt; may be installed on Debian-based distributions with
the following commands:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$ &lt;/span&gt;sudo apt-get install texlive-full
&lt;span class="gp"&gt;$ &lt;/span&gt;sudo apt-get install rubber
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The PDF LaTeX service is essentially a wrapper around &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;rubber-pipe&lt;/span&gt;&lt;/tt&gt; which in
turn invokes &lt;tt class="docutils literal"&gt;pdflatex&lt;/tt&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="symfony-2-service"&gt;
&lt;h2&gt;&lt;a class="toc-backref" href="#id4"&gt;Symfony 2 service&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;&lt;a class="reference external" href="https://symfony.com/doc/2.3/book/service_container.html"&gt;Services&lt;/a&gt; are re-usable, decoupled components, that may be accessed from any
part of the application. The &lt;a class="reference external" href="https://symfony.com/doc/2.3/glossary.html#term-service"&gt;definition of a service&lt;/a&gt; from the Symfony
documentation:&lt;/p&gt;
&lt;!-- vale off

A service is usually used “globally”, such as a database connection
object or an object that delivers email messages. In Symfony,
services are often configured and retrieved from the service
container. --&gt;
&lt;!-- vale on --&gt;
&lt;p&gt;The PDF LaTeX service consists of the following three components:&lt;/p&gt;
&lt;ol class="arabic simple"&gt;
&lt;li&gt;The &lt;strong&gt;Symfony service container&lt;/strong&gt; configured in &lt;tt class="docutils literal"&gt;services.yml&lt;/tt&gt;.&lt;/li&gt;
&lt;li&gt;A &lt;strong&gt;class&lt;/strong&gt; &lt;tt class="docutils literal"&gt;Pdflatex&lt;/tt&gt; of which an instance is available in the service
container.&lt;/li&gt;
&lt;li&gt;A &lt;strong&gt;Twig template&lt;/strong&gt; &lt;tt class="docutils literal"&gt;show.tex.twig&lt;/tt&gt; used to output the LaTeX source
document.&lt;/li&gt;
&lt;/ol&gt;
&lt;div class="section" id="configure-the-service-container"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id5"&gt;Configure the service container&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;The service container is configured with &lt;tt class="docutils literal"&gt;services.yml&lt;/tt&gt;. Two services are
defined in the &lt;a class="reference external" href="https://yaml.org/"&gt;YAML&lt;/a&gt; below: 1. &lt;tt class="docutils literal"&gt;electrotech.twig.ib2020_extension&lt;/tt&gt;, which
provides a Twig filer to escape LaTeX special characters; and
2. &lt;tt class="docutils literal"&gt;electrotech.pdf.pdflatex&lt;/tt&gt;, the PDF LaTeX service itself.&lt;/p&gt;
&lt;p&gt;For convenience the &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;rubber-pipe&lt;/span&gt;&lt;/tt&gt; binary is defined as a parameter.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# src/Electrotech/WeldqualBundle/Resources/config/services.yml&lt;/span&gt;

&lt;span class="nt"&gt;parameters&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="nt"&gt;electrotech.twig.ib2020_extension.class&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;Electrotech\WeldqualBundle\Twig\Ib2020Extension&lt;/span&gt;
    &lt;span class="nt"&gt;electrotech.pdf.pdflatex.rubber-pipe&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;/usr/bin/rubber-pipe&lt;/span&gt;

&lt;span class="nt"&gt;services&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="nt"&gt;electrotech.twig.ib2020_extension&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="nt"&gt;class&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="err"&gt;%&lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;electrotech.twig.ib2020_extension.class%&lt;/span&gt;
        &lt;span class="nt"&gt;arguments&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p p-Indicator"&gt;[&lt;/span&gt;&lt;span class="err"&gt;%&lt;/span&gt;&lt;span class="nv"&gt;kernel.bundles%&lt;/span&gt;&lt;span class="p p-Indicator"&gt;]&lt;/span&gt;
        &lt;span class="nt"&gt;tags&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="p p-Indicator"&gt;{&lt;/span&gt;&lt;span class="nt"&gt; name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="nv"&gt;twig.extension&lt;/span&gt; &lt;span class="p p-Indicator"&gt;}&lt;/span&gt;

    &lt;span class="nt"&gt;electrotech.pdf.pdflatex&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="nt"&gt;class&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;        &lt;span class="l l-Scalar l-Scalar-Plain"&gt;Electrotech\WeldqualBundle\Pdf\Pdflatex&lt;/span&gt;
        &lt;span class="nt"&gt;arguments&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;    &lt;span class="p p-Indicator"&gt;[&lt;/span&gt;&lt;span class="err"&gt;%&lt;/span&gt;&lt;span class="nv"&gt;electrotech.pdf.pdflatex.rubber-pipe%&lt;/span&gt;&lt;span class="p p-Indicator"&gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="service-object"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id6"&gt;Service object&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;An instance of the class &lt;tt class="docutils literal"&gt;Pdflatex&lt;/tt&gt; provides the service. &lt;tt class="docutils literal"&gt;Pdflatex&lt;/tt&gt; takes
a LaTeX source document and returns a PDF document.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="cp"&gt;&amp;lt;?php&lt;/span&gt;
&lt;span class="c1"&gt;// src/Electrotech/WeldqualBundle/Pdf/Pdflatex.php&lt;/span&gt;

&lt;span class="k"&gt;namespace&lt;/span&gt; &lt;span class="nx"&gt;Electrotech\WeldqualBundle\Pdf&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Pdflatex&lt;/span&gt;
&lt;span class="p"&gt;{&lt;/span&gt;

    &lt;span class="sd"&gt;/**&lt;/span&gt;
&lt;span class="sd"&gt;     * Full system path to rubber-pipe binary&lt;/span&gt;
&lt;span class="sd"&gt;     * @var string&lt;/span&gt;
&lt;span class="sd"&gt;     */&lt;/span&gt;
    &lt;span class="k"&gt;private&lt;/span&gt; &lt;span class="nv"&gt;$binary&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

    &lt;span class="sd"&gt;/**&lt;/span&gt;
&lt;span class="sd"&gt;     * Options for rubber-pipe&lt;/span&gt;
&lt;span class="sd"&gt;     * @var array&lt;/span&gt;
&lt;span class="sd"&gt;     */&lt;/span&gt;
    &lt;span class="k"&gt;private&lt;/span&gt; &lt;span class="nv"&gt;$options&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;array&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
        &lt;span class="s1"&gt;&amp;#39;--pdf&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="k"&gt;null&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="s1"&gt;&amp;#39;--into&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;/tmp/&amp;#39;&lt;/span&gt;
    &lt;span class="p"&gt;);&lt;/span&gt;

    &lt;span class="sd"&gt;/**&lt;/span&gt;
&lt;span class="sd"&gt;     * Tex source document&lt;/span&gt;
&lt;span class="sd"&gt;     * @var string&lt;/span&gt;
&lt;span class="sd"&gt;     */&lt;/span&gt;
    &lt;span class="k"&gt;private&lt;/span&gt; &lt;span class="nv"&gt;$texSource&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

    &lt;span class="sd"&gt;/**&lt;/span&gt;
&lt;span class="sd"&gt;     * Generated PDF document&lt;/span&gt;
&lt;span class="sd"&gt;     */&lt;/span&gt;
    &lt;span class="k"&gt;private&lt;/span&gt; &lt;span class="nv"&gt;$pdf&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

    &lt;span class="sd"&gt;/**&lt;/span&gt;
&lt;span class="sd"&gt;     * Initial working dir&lt;/span&gt;
&lt;span class="sd"&gt;     * @var string&lt;/span&gt;
&lt;span class="sd"&gt;     */&lt;/span&gt;
    &lt;span class="k"&gt;private&lt;/span&gt; &lt;span class="nv"&gt;$cwd&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;/tmp/&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

    &lt;span class="sd"&gt;/**&lt;/span&gt;
&lt;span class="sd"&gt;     * Environment variables&lt;/span&gt;
&lt;span class="sd"&gt;     * @var array|null&lt;/span&gt;
&lt;span class="sd"&gt;     */&lt;/span&gt;
    &lt;span class="k"&gt;private&lt;/span&gt; &lt;span class="nv"&gt;$env&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;null&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

    &lt;span class="sd"&gt;/**&lt;/span&gt;
&lt;span class="sd"&gt;     * Error output&lt;/span&gt;
&lt;span class="sd"&gt;     * @var string&lt;/span&gt;
&lt;span class="sd"&gt;     */&lt;/span&gt;
    &lt;span class="k"&gt;private&lt;/span&gt; &lt;span class="nv"&gt;$stderr&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;null&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

    &lt;span class="sd"&gt;/**&lt;/span&gt;
&lt;span class="sd"&gt;     * Return value&lt;/span&gt;
&lt;span class="sd"&gt;     * @var integer&lt;/span&gt;
&lt;span class="sd"&gt;     */&lt;/span&gt;
    &lt;span class="k"&gt;private&lt;/span&gt; &lt;span class="nv"&gt;$returnValue&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;


    &lt;span class="k"&gt;public&lt;/span&gt; &lt;span class="k"&gt;function&lt;/span&gt; &lt;span class="fm"&gt;__construct&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;$binary&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="nv"&gt;$this&lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="na"&gt;binary&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nv"&gt;$binary&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;

    &lt;span class="sd"&gt;/**&lt;/span&gt;
&lt;span class="sd"&gt;     * Create rubber-pipe command&lt;/span&gt;
&lt;span class="sd"&gt;     */&lt;/span&gt;
    &lt;span class="k"&gt;public&lt;/span&gt; &lt;span class="k"&gt;function&lt;/span&gt; &lt;span class="nf"&gt;getCommand&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
    &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="nv"&gt;$args&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
        &lt;span class="k"&gt;foreach&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;$this&lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="na"&gt;options&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="nv"&gt;$option&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="nv"&gt;$value&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="p"&gt;{&lt;/span&gt;
            &lt;span class="nv"&gt;$args&lt;/span&gt; &lt;span class="o"&gt;.=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39; &amp;#39;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="nv"&gt;$option&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
            &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;$value&lt;/span&gt; &lt;span class="o"&gt;!==&lt;/span&gt; &lt;span class="k"&gt;null&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
            &lt;span class="p"&gt;{&lt;/span&gt;
                &lt;span class="nv"&gt;$args&lt;/span&gt; &lt;span class="o"&gt;.=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39; &amp;#39;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="nv"&gt;$value&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
            &lt;span class="p"&gt;}&lt;/span&gt;
        &lt;span class="p"&gt;}&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nv"&gt;$this&lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="na"&gt;binary&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="nv"&gt;$args&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;

    &lt;span class="sd"&gt;/**&lt;/span&gt;
&lt;span class="sd"&gt;     * Execute rubber-pipe command&lt;/span&gt;
&lt;span class="sd"&gt;     */&lt;/span&gt;
    &lt;span class="k"&gt;public&lt;/span&gt; &lt;span class="k"&gt;function&lt;/span&gt; &lt;span class="nf"&gt;execute&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
    &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="nv"&gt;$descriptorSpec&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;array&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
            &lt;span class="mi"&gt;0&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="k"&gt;array&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;pipe&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;r&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
            &lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="k"&gt;array&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;pipe&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;w&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
            &lt;span class="mi"&gt;2&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="k"&gt;array&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;pipe&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;w&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
        &lt;span class="p"&gt;);&lt;/span&gt;

        &lt;span class="nv"&gt;$process&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;proc_open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
            &lt;span class="nv"&gt;$this&lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="na"&gt;getCommand&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt;
            &lt;span class="nv"&gt;$descriptorSpec&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
            &lt;span class="nv"&gt;$pipes&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
            &lt;span class="nv"&gt;$this&lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="na"&gt;cwd&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
            &lt;span class="nv"&gt;$this&lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="na"&gt;env&lt;/span&gt;
        &lt;span class="p"&gt;);&lt;/span&gt;

        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;is_resource&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;$process&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
            &lt;span class="nb"&gt;fwrite&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;$pipes&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="nv"&gt;$this&lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="na"&gt;getTexSource&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;
            &lt;span class="nb"&gt;fclose&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;$pipes&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]);&lt;/span&gt;

            &lt;span class="nv"&gt;$this&lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="na"&gt;pdf&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;stream_get_contents&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;$pipes&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]);&lt;/span&gt;
            &lt;span class="nv"&gt;$this&lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="na"&gt;stderr&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;stream_get_contents&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;$pipes&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;]);&lt;/span&gt;
            &lt;span class="nv"&gt;$this&lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="na"&gt;returnValue&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;proc_close&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;$process&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
        &lt;span class="p"&gt;}&lt;/span&gt;

        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;$this&lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="na"&gt;returnValue&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="p"&gt;{&lt;/span&gt;
            &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="k"&gt;true&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
        &lt;span class="p"&gt;}&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="k"&gt;false&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;

    &lt;span class="sd"&gt;/**&lt;/span&gt;
&lt;span class="sd"&gt;     * Set path to rubber-pipe binary&lt;/span&gt;
&lt;span class="sd"&gt;     * @param string $binary Full system path to rubber-pipe binary&lt;/span&gt;
&lt;span class="sd"&gt;     */&lt;/span&gt;
    &lt;span class="k"&gt;public&lt;/span&gt; &lt;span class="k"&gt;function&lt;/span&gt; &lt;span class="nf"&gt;setBinary&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;$binary&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="nv"&gt;$this&lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="na"&gt;binary&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nv"&gt;$binary&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;

    &lt;span class="sd"&gt;/**&lt;/span&gt;
&lt;span class="sd"&gt;     * Get path to rubber-pipe binary&lt;/span&gt;
&lt;span class="sd"&gt;     * @return string Full system path to rubber-pipe binary&lt;/span&gt;
&lt;span class="sd"&gt;     */&lt;/span&gt;
    &lt;span class="k"&gt;public&lt;/span&gt; &lt;span class="k"&gt;function&lt;/span&gt; &lt;span class="nf"&gt;getBinary&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
    &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nv"&gt;$this&lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="na"&gt;binary&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;

    &lt;span class="sd"&gt;/**&lt;/span&gt;
&lt;span class="sd"&gt;     * Set LaTeX source&lt;/span&gt;
&lt;span class="sd"&gt;     * @param string $texSource LaTeX source document&lt;/span&gt;
&lt;span class="sd"&gt;     */&lt;/span&gt;
    &lt;span class="k"&gt;public&lt;/span&gt; &lt;span class="k"&gt;function&lt;/span&gt; &lt;span class="nf"&gt;setTexSource&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;$texSource&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="nv"&gt;$this&lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="na"&gt;texSource&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nv"&gt;$texSource&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;

    &lt;span class="sd"&gt;/**&lt;/span&gt;
&lt;span class="sd"&gt;     * Get LaTeX source&lt;/span&gt;
&lt;span class="sd"&gt;     * @return string LaTeX source document&lt;/span&gt;
&lt;span class="sd"&gt;     */&lt;/span&gt;
    &lt;span class="k"&gt;public&lt;/span&gt; &lt;span class="k"&gt;function&lt;/span&gt; &lt;span class="nf"&gt;getTexSource&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
    &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nv"&gt;$this&lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="na"&gt;texSource&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;

    &lt;span class="sd"&gt;/**&lt;/span&gt;
&lt;span class="sd"&gt;     * Get PDF file contents&lt;/span&gt;
&lt;span class="sd"&gt;     * @return mixed Generated PDF file contents&lt;/span&gt;
&lt;span class="sd"&gt;     */&lt;/span&gt;
    &lt;span class="k"&gt;public&lt;/span&gt; &lt;span class="k"&gt;function&lt;/span&gt; &lt;span class="nf"&gt;getPdf&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
    &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nv"&gt;$this&lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="na"&gt;pdf&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;

    &lt;span class="sd"&gt;/**&lt;/span&gt;
&lt;span class="sd"&gt;     * Get errors&lt;/span&gt;
&lt;span class="sd"&gt;     * @return string Error output&lt;/span&gt;
&lt;span class="sd"&gt;     */&lt;/span&gt;
    &lt;span class="k"&gt;public&lt;/span&gt; &lt;span class="k"&gt;function&lt;/span&gt; &lt;span class="nf"&gt;getStderr&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
    &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nv"&gt;$this&lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="na"&gt;stderr&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;

    &lt;span class="sd"&gt;/**&lt;/span&gt;
&lt;span class="sd"&gt;     * Get return value&lt;/span&gt;
&lt;span class="sd"&gt;     * @return integer Return value from rubber-pipe command&lt;/span&gt;
&lt;span class="sd"&gt;     */&lt;/span&gt;
    &lt;span class="k"&gt;public&lt;/span&gt; &lt;span class="k"&gt;function&lt;/span&gt; &lt;span class="nf"&gt;getReturnValue&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
    &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nv"&gt;$this&lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="na"&gt;returnValue&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="twig-template"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id7"&gt;Twig template&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;A &lt;a class="reference external" href="https://twig.symfony.com/"&gt;Twig&lt;/a&gt; template &lt;tt class="docutils literal"&gt;show.tex.twig&lt;/tt&gt; is used to generate the LaTeX source
document.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c"&gt;% src/Electrotech/WeldqualBundle/Resources/views/Testweld/show.tex.twig&lt;/span&gt;

&lt;span class="c"&gt;% This template has been simplified for the sake of brevity.&lt;/span&gt;

&lt;span class="k"&gt;\documentclass&lt;/span&gt;&lt;span class="na"&gt;[10pt,a4paper]&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;article&lt;span class="nb"&gt;}&lt;/span&gt;

&lt;span class="k"&gt;\usepackage&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;array&lt;span class="nb"&gt;}&lt;/span&gt;
&lt;span class="k"&gt;\usepackage&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;calc&lt;span class="nb"&gt;}&lt;/span&gt;
&lt;span class="k"&gt;\usepackage&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;color&lt;span class="nb"&gt;}&lt;/span&gt;
&lt;span class="k"&gt;\usepackage&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;colortbl&lt;span class="nb"&gt;}&lt;/span&gt;
&lt;span class="k"&gt;\usepackage&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;graphicx&lt;span class="nb"&gt;}&lt;/span&gt;
&lt;span class="k"&gt;\usepackage&lt;/span&gt;&lt;span class="na"&gt;[margin=1cm]&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;geometry&lt;span class="nb"&gt;}&lt;/span&gt;
&lt;span class="k"&gt;\usepackage&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;multirow&lt;span class="nb"&gt;}&lt;/span&gt;
&lt;span class="k"&gt;\usepackage&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;tabularx&lt;span class="nb"&gt;}&lt;/span&gt;
&lt;span class="k"&gt;\usepackage&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;wasysym&lt;span class="nb"&gt;}&lt;/span&gt;

&lt;span class="c"&gt;% width of table columns&lt;/span&gt;
&lt;span class="k"&gt;\newlength&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;&lt;span class="k"&gt;\colOneWidth&lt;/span&gt;&lt;span class="nb"&gt;}&lt;/span&gt;
&lt;span class="k"&gt;\setlength&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;&lt;span class="k"&gt;\colOneWidth&lt;/span&gt;&lt;span class="nb"&gt;}{&lt;/span&gt;0.13&lt;span class="k"&gt;\textwidth&lt;/span&gt;&lt;span class="nb"&gt;}&lt;/span&gt;
&lt;span class="k"&gt;\newlength&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;&lt;span class="k"&gt;\colThreeWidth&lt;/span&gt;&lt;span class="nb"&gt;}&lt;/span&gt;
&lt;span class="k"&gt;\setlength&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;&lt;span class="k"&gt;\colThreeWidth&lt;/span&gt;&lt;span class="nb"&gt;}{&lt;/span&gt;0.13&lt;span class="k"&gt;\textwidth&lt;/span&gt;&lt;span class="nb"&gt;}&lt;/span&gt;
&lt;span class="k"&gt;\newlength&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;&lt;span class="k"&gt;\colFourWidth&lt;/span&gt;&lt;span class="nb"&gt;}&lt;/span&gt;
&lt;span class="k"&gt;\setlength&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;&lt;span class="k"&gt;\colFourWidth&lt;/span&gt;&lt;span class="nb"&gt;}{&lt;/span&gt;0.25&lt;span class="k"&gt;\textwidth&lt;/span&gt;&lt;span class="nb"&gt;}&lt;/span&gt;
&lt;span class="k"&gt;\newlength&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;&lt;span class="k"&gt;\colFiveWidth&lt;/span&gt;&lt;span class="nb"&gt;}&lt;/span&gt;
&lt;span class="k"&gt;\setlength&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;&lt;span class="k"&gt;\colFiveWidth&lt;/span&gt;&lt;span class="nb"&gt;}{&lt;/span&gt;0.13&lt;span class="k"&gt;\textwidth&lt;/span&gt;&lt;span class="nb"&gt;}&lt;/span&gt;
&lt;span class="k"&gt;\newlength&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;&lt;span class="k"&gt;\colThreeToFiveWidth&lt;/span&gt;&lt;span class="nb"&gt;}&lt;/span&gt;
&lt;span class="k"&gt;\setlength&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;&lt;span class="k"&gt;\colThreeToFiveWidth&lt;/span&gt;&lt;span class="nb"&gt;}{&lt;/span&gt;&lt;span class="k"&gt;\colThreeWidth&lt;/span&gt; + &lt;span class="k"&gt;\colFourWidth&lt;/span&gt; + &lt;span class="k"&gt;\colFiveWidth&lt;/span&gt;&lt;span class="nb"&gt;}&lt;/span&gt;
&lt;span class="k"&gt;\newlength&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;&lt;span class="k"&gt;\colFourToFiveWidth&lt;/span&gt;&lt;span class="nb"&gt;}&lt;/span&gt;
&lt;span class="k"&gt;\setlength&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;&lt;span class="k"&gt;\colFourToFiveWidth&lt;/span&gt;&lt;span class="nb"&gt;}{&lt;/span&gt;&lt;span class="k"&gt;\colFourWidth&lt;/span&gt; + &lt;span class="k"&gt;\colFiveWidth&lt;/span&gt;&lt;span class="nb"&gt;}&lt;/span&gt;


&lt;span class="c"&gt;% colours&lt;/span&gt;
&lt;span class="k"&gt;\definecolor&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;IB2020Blue&lt;span class="nb"&gt;}{&lt;/span&gt;RGB&lt;span class="nb"&gt;}{&lt;/span&gt;172,206,230&lt;span class="nb"&gt;}&lt;/span&gt; &lt;span class="c"&gt;% #ACCEE6&lt;/span&gt;
&lt;span class="k"&gt;\definecolor&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;invalidBg&lt;span class="nb"&gt;}{&lt;/span&gt;RGB&lt;span class="nb"&gt;}{&lt;/span&gt;242,222,222&lt;span class="nb"&gt;}&lt;/span&gt;  &lt;span class="c"&gt;% #F2DEDE&lt;/span&gt;
&lt;span class="k"&gt;\definecolor&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;invalidFg&lt;span class="nb"&gt;}{&lt;/span&gt;RGB&lt;span class="nb"&gt;}{&lt;/span&gt;185,74,72&lt;span class="nb"&gt;}&lt;/span&gt;    &lt;span class="c"&gt;% #B94A48&lt;/span&gt;

&lt;span class="c"&gt;% page style&lt;/span&gt;
&lt;span class="k"&gt;\pagestyle&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;empty&lt;span class="nb"&gt;}&lt;/span&gt; &lt;span class="c"&gt;% remove page numbering&lt;/span&gt;

&lt;span class="c"&gt;% PDF meta data&lt;/span&gt;
&lt;span class="k"&gt;\pdfinfo&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;
    /Title (Welder Qualification Certificate)
    /Creator (IB2020 &lt;span class="nb"&gt;{{&lt;/span&gt; electrotech&lt;span class="nb"&gt;_&lt;/span&gt;system&lt;span class="nb"&gt;_&lt;/span&gt;owner | e&lt;span class="nb"&gt;_&lt;/span&gt;latex &lt;span class="nb"&gt;}}&lt;/span&gt;)
    /Producer (IB2020 &lt;span class="nb"&gt;{{&lt;/span&gt; electrotech&lt;span class="nb"&gt;_&lt;/span&gt;system&lt;span class="nb"&gt;_&lt;/span&gt;owner | e&lt;span class="nb"&gt;_&lt;/span&gt;latex &lt;span class="nb"&gt;}}&lt;/span&gt;)
    /Author (IB2020 A Management Information System for Inspection Bodies)
    /CreationDate (D:&lt;span class="nb"&gt;{{&lt;/span&gt; &amp;quot;now&amp;quot;|date(&amp;quot;YmdGisO&amp;quot;) | e&lt;span class="nb"&gt;_&lt;/span&gt;latex &lt;span class="nb"&gt;}}&lt;/span&gt;)
    /ModDate (D:&lt;span class="nb"&gt;{{&lt;/span&gt; &amp;quot;now&amp;quot;|date(&amp;quot;YmdGisO&amp;quot;) | e&lt;span class="nb"&gt;_&lt;/span&gt;latex &lt;span class="nb"&gt;}}&lt;/span&gt;)
    /Subject (Welder Qualification Certificate)
    /Keywords (IB2020)
&lt;span class="nb"&gt;}&lt;/span&gt;


&lt;span class="k"&gt;\begin&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;document&lt;span class="nb"&gt;}&lt;/span&gt;

&lt;span class="c"&gt;% remove left indent from table&lt;/span&gt;
&lt;span class="k"&gt;\noindent&lt;/span&gt;&lt;span class="c"&gt;%&lt;/span&gt;
&lt;span class="k"&gt;\begin&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;tabularx&lt;span class="nb"&gt;}{&lt;/span&gt;&lt;span class="k"&gt;\textwidth&lt;/span&gt;&lt;span class="nb"&gt;}{&lt;/span&gt;@&lt;span class="nb"&gt;{}&lt;/span&gt;|p&lt;span class="nb"&gt;{&lt;/span&gt;&lt;span class="k"&gt;\colOneWidth&lt;/span&gt;&lt;span class="nb"&gt;}&lt;/span&gt;|X|p&lt;span class="nb"&gt;{&lt;/span&gt;&lt;span class="k"&gt;\colThreeWidth&lt;/span&gt;&lt;span class="nb"&gt;}&lt;/span&gt;|p&lt;span class="nb"&gt;{&lt;/span&gt;&lt;span class="k"&gt;\colFourWidth&lt;/span&gt;&lt;span class="nb"&gt;}&lt;/span&gt;|p&lt;span class="nb"&gt;{&lt;/span&gt;&lt;span class="k"&gt;\colFiveWidth&lt;/span&gt;&lt;span class="nb"&gt;}&lt;/span&gt;| &lt;span class="nb"&gt;}&lt;/span&gt;
    &lt;span class="k"&gt;\hline&lt;/span&gt;
        &lt;span class="k"&gt;\centering&lt;/span&gt; &lt;span class="k"&gt;\scriptsize&lt;/span&gt;&lt;span class="nb"&gt;{}&lt;/span&gt;Certificate Number&lt;span class="k"&gt;\newline&lt;/span&gt; &lt;span class="k"&gt;\normalsize&lt;/span&gt; &lt;span class="nb"&gt;{{&lt;/span&gt; entity.certificateNumber | e&lt;span class="nb"&gt;_&lt;/span&gt;latex &lt;span class="nb"&gt;}}&lt;/span&gt; &lt;span class="nb"&gt;&amp;amp;&lt;/span&gt;
        &lt;span class="k"&gt;\multicolumn&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;3&lt;span class="nb"&gt;}{&lt;/span&gt;c|&lt;span class="nb"&gt;}{&lt;/span&gt; &lt;span class="k"&gt;\cellcolor&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;IB2020Blue&lt;span class="nb"&gt;}&lt;/span&gt; &lt;span class="k"&gt;\textbf&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;Welder Qualification Certificate&lt;span class="nb"&gt;}&lt;/span&gt; &lt;span class="nb"&gt;}&lt;/span&gt; &lt;span class="nb"&gt;&amp;amp;&lt;/span&gt;
        &lt;span class="k"&gt;\raisebox&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;-0.5&lt;span class="k"&gt;\height&lt;/span&gt;&lt;span class="nb"&gt;}{&lt;/span&gt;
            &lt;span class="k"&gt;\includegraphics&lt;/span&gt;&lt;span class="na"&gt;[width=0.13\textwidth]&lt;/span&gt;&lt;span class="nb"&gt;{{&lt;/span&gt; &amp;#39;&lt;span class="nb"&gt;{&lt;/span&gt;&amp;#39; &lt;span class="nb"&gt;}}{{&lt;/span&gt; logoFile | e&lt;span class="nb"&gt;_&lt;/span&gt;latex &lt;span class="nb"&gt;}}{{&lt;/span&gt; &amp;#39;&lt;span class="nb"&gt;}&lt;/span&gt;&amp;#39; &lt;span class="nb"&gt;}}&lt;/span&gt;
        &lt;span class="nb"&gt;}&lt;/span&gt; &lt;span class="k"&gt;\\&lt;/span&gt;
    &lt;span class="k"&gt;\hline&lt;/span&gt;
        &lt;span class="k"&gt;\multicolumn&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;5&lt;span class="nb"&gt;}{&lt;/span&gt;|c|&lt;span class="nb"&gt;}{&lt;/span&gt;
            &lt;span class="nb"&gt;{{&lt;/span&gt; electrotech&lt;span class="nb"&gt;_&lt;/span&gt;system&lt;span class="nb"&gt;_&lt;/span&gt;owner | e&lt;span class="nb"&gt;_&lt;/span&gt;latex &lt;span class="nb"&gt;}}&lt;/span&gt;
            &lt;span class="k"&gt;\enspace&lt;/span&gt;
            IANZ Accredited Inspection Body No. &lt;span class="nb"&gt;{{&lt;/span&gt; electrotech&lt;span class="nb"&gt;_&lt;/span&gt;ianz&lt;span class="nb"&gt;_&lt;/span&gt;number | e&lt;span class="nb"&gt;_&lt;/span&gt;latex &lt;span class="nb"&gt;}}&lt;/span&gt;
        &lt;span class="nb"&gt;}&lt;/span&gt; &lt;span class="k"&gt;\\&lt;/span&gt;
    &lt;span class="k"&gt;\hline&lt;/span&gt;
&lt;span class="k"&gt;\end&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;tabularx&lt;span class="nb"&gt;}&lt;/span&gt;

&lt;span class="k"&gt;\end&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;document&lt;span class="nb"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;A &lt;a class="reference external" href="https://twig.symfony.com/doc/3.x/advanced.html#filters"&gt;custom Twig filter&lt;/a&gt; &lt;tt class="docutils literal"&gt;e_latex&lt;/tt&gt; is used to escape LaTeX special characters.
Custom Twig filters are created by extending &lt;tt class="docutils literal"&gt;Twig_Extension&lt;/tt&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="cp"&gt;&amp;lt;?php&lt;/span&gt;
&lt;span class="c1"&gt;// src/Electrotech/WeldqualBundle/Twig/Ib2020Extension.php&lt;/span&gt;

&lt;span class="k"&gt;namespace&lt;/span&gt; &lt;span class="nx"&gt;Electrotech\WeldqualBundle\Twig&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

&lt;span class="k"&gt;use&lt;/span&gt; &lt;span class="nx"&gt;Twig_Extension&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="k"&gt;use&lt;/span&gt; &lt;span class="nx"&gt;Twig_Filter_Method&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="k"&gt;use&lt;/span&gt; &lt;span class="nx"&gt;Twig_Test_Method&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Ib2020Extension&lt;/span&gt; &lt;span class="k"&gt;extends&lt;/span&gt; &lt;span class="nx"&gt;Twig_Extension&lt;/span&gt;
&lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="c1"&gt;// Unrelated methods have been omitted from this code sample for the sake&lt;/span&gt;
    &lt;span class="c1"&gt;// of brevity.&lt;/span&gt;

    &lt;span class="k"&gt;private&lt;/span&gt; &lt;span class="nv"&gt;$kernelBundles&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

    &lt;span class="k"&gt;public&lt;/span&gt; &lt;span class="k"&gt;function&lt;/span&gt; &lt;span class="fm"&gt;__construct&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;$kernelBundles&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="nv"&gt;$this&lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="na"&gt;kernelBundles&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nv"&gt;$kernelBundles&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;

    &lt;span class="sd"&gt;/**&lt;/span&gt;
&lt;span class="sd"&gt;     * Returns a list of filters to add to the existing list.&lt;/span&gt;
&lt;span class="sd"&gt;     *&lt;/span&gt;
&lt;span class="sd"&gt;     * @return array An array of filters&lt;/span&gt;
&lt;span class="sd"&gt;     */&lt;/span&gt;
    &lt;span class="k"&gt;public&lt;/span&gt; &lt;span class="k"&gt;function&lt;/span&gt; &lt;span class="nf"&gt;getFilters&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
    &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="k"&gt;array&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
            &lt;span class="s1"&gt;&amp;#39;e_latex&amp;#39;&lt;/span&gt;     &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="nx"&gt;Twig_Filter_Method&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;$this&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;escapeLatexFilter&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
        &lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;

    &lt;span class="sd"&gt;/**&lt;/span&gt;
&lt;span class="sd"&gt;     * Escape LaTeX special characters&lt;/span&gt;
&lt;span class="sd"&gt;     *&lt;/span&gt;
&lt;span class="sd"&gt;     * @return string&lt;/span&gt;
&lt;span class="sd"&gt;     */&lt;/span&gt;
    &lt;span class="k"&gt;public&lt;/span&gt; &lt;span class="k"&gt;function&lt;/span&gt; &lt;span class="nf"&gt;escapeLatexFilter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;$str&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;null&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="nv"&gt;$search&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;array&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;\\&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;#&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;$&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;%&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;&amp;amp;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;_&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;{&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;}&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;~&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;^&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
            &lt;span class="s1"&gt;&amp;#39;&amp;gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;&amp;lt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

        &lt;span class="nv"&gt;$replace&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;array&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;\textbackslash &amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;\#&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;\$&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;\%&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;\&amp;amp;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;\_&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
            &lt;span class="s1"&gt;&amp;#39;\{&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;\}&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;\textasciitilde &amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;\textasciicircum &amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
            &lt;span class="s1"&gt;&amp;#39;\textgreater&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;\textless&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nb"&gt;str_replace&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;$search&lt;/span&gt; &lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="nv"&gt;$replace&lt;/span&gt; &lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="nv"&gt;$str&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;

    &lt;span class="sd"&gt;/**&lt;/span&gt;
&lt;span class="sd"&gt;     * Returns the name of the extension&lt;/span&gt;
&lt;span class="sd"&gt;     *&lt;/span&gt;
&lt;span class="sd"&gt;     * @return string The extension name&lt;/span&gt;
&lt;span class="sd"&gt;     */&lt;/span&gt;
    &lt;span class="k"&gt;public&lt;/span&gt; &lt;span class="k"&gt;function&lt;/span&gt; &lt;span class="nf"&gt;getName&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
    &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;electrotech_twig_ib2020_extension&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="utilising-the-service"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id8"&gt;Utilising the service&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;The service is used in the controller by passing a certificate ID to the method
&lt;tt class="docutils literal"&gt;pdfAction()&lt;/tt&gt;. The LaTeX source document is then generated by the method
&lt;tt class="docutils literal"&gt;latexSource()&lt;/tt&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="cp"&gt;&amp;lt;?php&lt;/span&gt;

&lt;span class="c1"&gt;// Utilising the PDF LaTeX service&lt;/span&gt;
&lt;span class="nv"&gt;$pdflatex&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nv"&gt;$this&lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="na"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;electrotech.pdf.pdflatex&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="nv"&gt;$pdflatex&lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="na"&gt;setTexSource&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;$latexSource&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="nv"&gt;$pdf&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nv"&gt;$pdflatex&lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="na"&gt;getPdf&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Below is an example of how this service is used in a controller.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="cp"&gt;&amp;lt;?php&lt;/span&gt;

&lt;span class="c1"&gt;// src/Electrotech/WeldqualBundle/Controller/TestweldController.php&lt;/span&gt;

&lt;span class="k"&gt;namespace&lt;/span&gt; &lt;span class="nx"&gt;Electrotech\WeldqualBundle\Controller&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

&lt;span class="k"&gt;use&lt;/span&gt; &lt;span class="nx"&gt;Symfony\Component\HttpFoundation\Request&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="k"&gt;use&lt;/span&gt; &lt;span class="nx"&gt;Symfony\Component\HttpFoundation\Response&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="k"&gt;use&lt;/span&gt; &lt;span class="nx"&gt;Symfony\Component\HttpKernel\Exception\HttpException&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="k"&gt;use&lt;/span&gt; &lt;span class="nx"&gt;Symfony\Bundle\FrameworkBundle\Controller\Controller&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

&lt;span class="k"&gt;use&lt;/span&gt; &lt;span class="nx"&gt;Electrotech\WeldqualBundle\Entity\Testweld&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="k"&gt;use&lt;/span&gt; &lt;span class="nx"&gt;Electrotech\WeldqualBundle\Entity\Testweldassessment&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="k"&gt;use&lt;/span&gt; &lt;span class="nx"&gt;Electrotech\WeldqualBundle\Form\TestweldType&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="k"&gt;use&lt;/span&gt; &lt;span class="nx"&gt;Electrotech\WeldqualBundle\Helper\QualificationRangeHelper&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;


&lt;span class="sd"&gt;/**&lt;/span&gt;
&lt;span class="sd"&gt; * Testweld controller&lt;/span&gt;
&lt;span class="sd"&gt; */&lt;/span&gt;
&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;TestweldController&lt;/span&gt; &lt;span class="k"&gt;extends&lt;/span&gt; &lt;span class="nx"&gt;Controller&lt;/span&gt;
&lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="c1"&gt;// Unrelated methods have been omitted from this code sample for the sake&lt;/span&gt;
    &lt;span class="c1"&gt;// of brevity.&lt;/span&gt;

    &lt;span class="sd"&gt;/**&lt;/span&gt;
&lt;span class="sd"&gt;     * Creates a PDF certificate&lt;/span&gt;
&lt;span class="sd"&gt;     */&lt;/span&gt;
    &lt;span class="k"&gt;public&lt;/span&gt; &lt;span class="k"&gt;function&lt;/span&gt; &lt;span class="nf"&gt;pdfAction&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;$id&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="p"&gt;{&lt;/span&gt;

        &lt;span class="nv"&gt;$latexSource&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nv"&gt;$this&lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="na"&gt;latexSource&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;$id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;show.tex.twig&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

        &lt;span class="nv"&gt;$pdflatex&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nv"&gt;$this&lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="na"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;electrotech.pdf.pdflatex&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
        &lt;span class="nv"&gt;$pdflatex&lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="na"&gt;setTexSource&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;$latexSource&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;latex&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]);&lt;/span&gt;

        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;!&lt;/span&gt;&lt;span class="nv"&gt;$pdflatex&lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="na"&gt;execute&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;
        &lt;span class="p"&gt;{&lt;/span&gt;
            &lt;span class="k"&gt;throw&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="nx"&gt;HttpException&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;500&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;Error creating PDF: &amp;#39;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="nv"&gt;$pdflatex&lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="na"&gt;getStderr&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;
        &lt;span class="p"&gt;}&lt;/span&gt;

        &lt;span class="nv"&gt;$response&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="nx"&gt;Response&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;
        &lt;span class="nv"&gt;$response&lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="na"&gt;setContent&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;$pdflatex&lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="na"&gt;getPdf&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;
        &lt;span class="nv"&gt;$response&lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="na"&gt;headers&lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="na"&gt;set&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Content-Type&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;application/pdf&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
        &lt;span class="nv"&gt;$response&lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="na"&gt;headers&lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="na"&gt;set&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Content-Disposition&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;inline; filename=&amp;quot;&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="nv"&gt;$latexSource&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;filename&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;.pdf&amp;quot;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nv"&gt;$response&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;

    &lt;span class="sd"&gt;/**&lt;/span&gt;
&lt;span class="sd"&gt;     * Creates LaTeX source&lt;/span&gt;
&lt;span class="sd"&gt;     */&lt;/span&gt;
    &lt;span class="k"&gt;private&lt;/span&gt; &lt;span class="k"&gt;function&lt;/span&gt; &lt;span class="nf"&gt;latexSource&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;$id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nv"&gt;$template&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="nv"&gt;$em&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nv"&gt;$this&lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="na"&gt;getDoctrine&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="na"&gt;getManager&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;

        &lt;span class="nv"&gt;$entity&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nv"&gt;$em&lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="na"&gt;getRepository&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;ElectrotechWeldqualBundle:Testweld&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="na"&gt;find&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;$id&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;!&lt;/span&gt;&lt;span class="nv"&gt;$entity&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
            &lt;span class="k"&gt;throw&lt;/span&gt; &lt;span class="nv"&gt;$this&lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="na"&gt;createNotFoundException&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Unable to find Testweld entity.&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
        &lt;span class="p"&gt;}&lt;/span&gt;

        &lt;span class="nv"&gt;$em&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nv"&gt;$this&lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="na"&gt;getDoctrine&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="na"&gt;getManager&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;

        &lt;span class="nv"&gt;$weldVariables&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nv"&gt;$em&lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="na"&gt;getRepository&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;ElectrotechWeldqualBundle:Weldvariables&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
            &lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="na"&gt;fetchWeldVariables&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
                &lt;span class="nv"&gt;$entity&lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="na"&gt;getQualificationstandard&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="na"&gt;getEdition&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="na"&gt;getTechdoc&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt;
                &lt;span class="nv"&gt;$entity&lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="na"&gt;getProducttype&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt;
                &lt;span class="nv"&gt;$entity&lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="na"&gt;getWeldtype&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt;
                &lt;span class="nv"&gt;$entity&lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="na"&gt;getWeldposition&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt;
                &lt;span class="nv"&gt;$entity&lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="na"&gt;getWelddirection&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
            &lt;span class="p"&gt;);&lt;/span&gt;

        &lt;span class="nv"&gt;$qualifiedRange&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;null&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;$weldVariables&lt;/span&gt; &lt;span class="o"&gt;!==&lt;/span&gt; &lt;span class="k"&gt;null&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="p"&gt;{&lt;/span&gt;
            &lt;span class="nv"&gt;$qualifiedRange&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="nx"&gt;QualificationRangeHelper&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
                &lt;span class="nv"&gt;$entity&lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="na"&gt;getProducttype&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt;
                &lt;span class="nv"&gt;$entity&lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="na"&gt;getPipeod&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt;
                &lt;span class="nv"&gt;$weldVariables&lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="na"&gt;getQualifiedweldvariablesid&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
            &lt;span class="p"&gt;);&lt;/span&gt;
        &lt;span class="p"&gt;}&lt;/span&gt;

        &lt;span class="nv"&gt;$logoFile&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nv"&gt;$this&lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="na"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;kernel&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="na"&gt;getRootDir&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;DIRECTORY_SEPARATOR&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;
            &lt;span class="nv"&gt;$this&lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="na"&gt;container&lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="na"&gt;getParameter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;electrotech_upload_dir&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;DIRECTORY_SEPARATOR&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;
            &lt;span class="s1"&gt;&amp;#39;sysowner&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;DIRECTORY_SEPARATOR&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;logo.pdf&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

        &lt;span class="nv"&gt;$templating&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nv"&gt;$this&lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="na"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;templating&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

        &lt;span class="nv"&gt;$latexSource&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nv"&gt;$templating&lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="na"&gt;render&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
            &lt;span class="s1"&gt;&amp;#39;ElectrotechWeldqualBundle:Testweld:&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="nv"&gt;$template&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
            &lt;span class="k"&gt;array&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
                &lt;span class="s1"&gt;&amp;#39;entity&amp;#39;&lt;/span&gt;         &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="nv"&gt;$entity&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                &lt;span class="s1"&gt;&amp;#39;logoFile&amp;#39;&lt;/span&gt;       &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="nv"&gt;$logoFile&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                &lt;span class="s1"&gt;&amp;#39;qualifiedRange&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="nv"&gt;$qualifiedRange&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
            &lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="p"&gt;);&lt;/span&gt;

        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="k"&gt;array&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
            &lt;span class="s1"&gt;&amp;#39;latex&amp;#39;&lt;/span&gt;    &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="nv"&gt;$latexSource&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
            &lt;span class="s1"&gt;&amp;#39;filename&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="nv"&gt;$entity&lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="na"&gt;getFilename&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
        &lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="further-reading"&gt;
&lt;h2&gt;&lt;a class="toc-backref" href="#id9"&gt;Further reading&lt;/a&gt;&lt;/h2&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;a class="reference external" href="https://symfony.com/doc/2.3/cookbook/controller/service.html"&gt;How to define controllers as services&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="https://tobi.oetiker.ch/lshort/lshort.pdf"&gt;The not so short introduction to LaTeX 2ε&lt;/a&gt; by Tobias Oetiker.&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
</content><category term="Web development"></category><category term="Symfony 2"></category><category term="LaTeX"></category></entry><entry><title>Optimising page speed: a case study</title><link href="https://seth.fischer.nz/optimising-page-speed-case-study.html" rel="alternate"></link><published>2015-03-27T20:47:00+13:00</published><updated>2015-03-27T20:47:00+13:00</updated><author><name>Seth Fischer</name></author><id>tag:seth.fischer.nz,2015-03-27:/optimising-page-speed-case-study.html</id><summary type="html">&lt;p class="first last"&gt;As an exercise in optimising page speed the Pelican theme
pelican-bootstrap3 by Daan Debie was customised according to the specific
requirements of seth.fischer.nz. The customisations reduced the total
number of requests on the index page by 66% and the page size was reduced
by 62%.&lt;/p&gt;
</summary><content type="html">&lt;div class="admonition note"&gt;
&lt;p class="first admonition-title"&gt;Note&lt;/p&gt;
&lt;p class="last"&gt;This site is no longer using the theme &lt;a class="reference external" href="https://github.com/sethfischer/pelican-bootstrap3"&gt;sethfischer/pelican-bootstrap3&lt;/a&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;As an exercise in optimising page speed the &lt;a class="reference external" href="https://docs.getpelican.com/"&gt;Pelican&lt;/a&gt; theme
&lt;a class="reference external" href="https://github.com/DandyDev/pelican-bootstrap3"&gt;DandyDev/pelican-bootstrap3&lt;/a&gt; was customised to improve page speed. The
customisations reduced the total number of requests on the index page by 66%
and the page size was reduced by 62%.&lt;/p&gt;
&lt;div class="contents topic" id="contents"&gt;
&lt;p class="topic-title"&gt;Contents&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;a class="reference internal" href="#pre-optimisation" id="id1"&gt;Pre-optimisation&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#optimisations" id="id2"&gt;Optimisations&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a class="reference internal" href="#custom-font" id="id3"&gt;Custom font&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#custom-bootstrap" id="id4"&gt;Custom Bootstrap&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#reduce-ajax-requests" id="id5"&gt;Reduce AJAX requests&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#custom-jquery" id="id6"&gt;Custom jQuery&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#merge-and-minify-assets" id="id7"&gt;Merge and minify assets&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#eliminate-unnecessary-resources-and-dns-look-ups" id="id8"&gt;Eliminate unnecessary resources and DNS look-ups&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#post-optimisation" id="id9"&gt;Post-optimisation&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#hosting-environment" id="id10"&gt;Hosting environment&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#summary" id="id11"&gt;Summary&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#further-reading" id="id12"&gt;Further reading&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class="section" id="pre-optimisation"&gt;
&lt;h2&gt;&lt;a class="toc-backref" href="#id1"&gt;Pre-optimisation&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Before optimisation, as configured for this site, the index page generated
17&amp;nbsp;requests and had a total page size of 182.9&amp;nbsp;kB.&lt;/p&gt;
&lt;table border="1" class="docutils"&gt;
&lt;colgroup&gt;
&lt;col width="67%" /&gt;
&lt;col width="33%" /&gt;
&lt;/colgroup&gt;
&lt;thead valign="bottom"&gt;
&lt;tr&gt;&lt;th class="head"&gt;seth.fischer.nz&lt;/th&gt;
&lt;th class="head"&gt;Pre-optimisation&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td&gt;Requests&lt;/td&gt;
&lt;td&gt;15&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;Requests (SSL)&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;Redirects&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;Page size&lt;/td&gt;
&lt;td&gt;182.9&amp;nbsp;kB&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;Pingdom performance grade&lt;/td&gt;
&lt;td&gt;81/100&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;Google PageSpeed score (mobile)&lt;/td&gt;
&lt;td&gt;74/100&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;Google PageSpeed score (desktop)&lt;/td&gt;
&lt;td&gt;87/100&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;Full details are available in the &lt;a class="reference external" href="https://seth.fischer.nz/static/optimising-page-speed-case-study/seth.fischer.nz_2015-03-15_1905.har"&gt;pre-optimisation HAR file&lt;/a&gt;.&lt;/p&gt;
&lt;div class="figure"&gt;
&lt;img alt="Pingdom speed test summary pre-optimisation; Performance grade: 81/100; Requests: 17; Load time: 591 ms; Page size 182.9 kB" src="/static/optimising-page-speed-case-study/seth.fischer.nz_2015-03-15_1905_pingdom.png" style="width: 582px; height: 133px;" /&gt;
&lt;p class="caption"&gt;Pingdom speed test summary pre-optimisation.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="optimisations"&gt;
&lt;h2&gt;&lt;a class="toc-backref" href="#id2"&gt;Optimisations&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Six main optimisations were made as detailed below. Unless stated the file
sizes specified are for minified but uncompressed versions of the file.&lt;/p&gt;
&lt;div class="section" id="custom-font"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id3"&gt;Custom font&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;Improvements:&lt;/p&gt;
&lt;dl class="docutils"&gt;
&lt;dt&gt;Page size&lt;/dt&gt;
&lt;dd&gt;−96.1&amp;nbsp;kB&lt;/dd&gt;
&lt;/dl&gt;
&lt;p&gt;&lt;a class="reference external" href="https://github.com/FortAwesome/Font-Awesome"&gt;FontAwesome&lt;/a&gt; version 4.1.0 contains a total of 439 icons giving
&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;fontawesome-webfont.woff&lt;/span&gt;&lt;/tt&gt; a file size of 83.8&amp;nbsp;kB. A custom font
(&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;font-custom.woff&lt;/span&gt;&lt;/tt&gt;) containing only the 12 icons that were required reduced
the size to to 7.4&amp;nbsp;kB.&lt;/p&gt;
&lt;p&gt;The associated style sheet &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;font-awesome.min.css&lt;/span&gt;&lt;/tt&gt; with a file size of 20.8&amp;nbsp;kB
was replaced with &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;font-custom.css&lt;/span&gt;&lt;/tt&gt; having a file size of 1.1&amp;nbsp;kB.&lt;/p&gt;
&lt;p&gt;&lt;a class="reference external" href="https://github.com/FontCustom/fontcustom"&gt;Font Custom&lt;/a&gt; was used to create the custom font and Font Custom vectors were
obtained from &lt;a class="reference external" href="https://github.com/encharm/Font-Awesome-SVG-PNG"&gt;encharm/Font-Awesome-SVG-PNG&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Font Custom configuration is stored in &lt;tt class="docutils literal"&gt;fontcustom.yml&lt;/tt&gt;, or can be integrated
into a &lt;a class="reference external" href="https://gruntjs.com/"&gt;Grunt&lt;/a&gt; build with &lt;a class="reference external" href="https://github.com/sapegin/grunt-webfont"&gt;sapegin/grunt-webfont&lt;/a&gt;. See the next section for
the &lt;tt class="docutils literal"&gt;Gruntfile.js&lt;/tt&gt; which includes a &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;grunt-webfont&lt;/span&gt;&lt;/tt&gt; task.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="custom-bootstrap"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id4"&gt;Custom Bootstrap&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;Improvements:&lt;/p&gt;
&lt;dl class="docutils"&gt;
&lt;dt&gt;Page size&lt;/dt&gt;
&lt;dd&gt;−15.3&amp;nbsp;kB&lt;/dd&gt;
&lt;/dl&gt;
&lt;p&gt;A custom build of &lt;a class="reference external" href="https://getbootstrap.com/"&gt;Bootstrap&lt;/a&gt; was built with &lt;a class="reference external" href="http://compass-style.org/"&gt;Compass&lt;/a&gt;. By excluding ten
unused components from the build &lt;tt class="docutils literal"&gt;bootstrap.min.css&lt;/tt&gt; was reduced from
109.5&amp;nbsp;kB to 94.2&amp;nbsp;kB.&lt;/p&gt;
&lt;p&gt;The Bootstrap build process was included as a Grunt task using
&lt;a class="reference external" href="https://github.com/gruntjs/grunt-contrib-compass"&gt;gruntjs/grunt-contrib-compass&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Below is the &lt;tt class="docutils literal"&gt;Gruntfile.js&lt;/tt&gt; for this theme which includes both a
&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;grunt-webfont&lt;/span&gt;&lt;/tt&gt; task and a &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;grunt-contrib-compass&lt;/span&gt;&lt;/tt&gt; task.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nx"&gt;module&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;exports&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;grunt&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;use strict&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

    &lt;span class="nx"&gt;grunt&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;initConfig&lt;/span&gt;&lt;span class="p"&gt;({&lt;/span&gt;
        &lt;span class="nx"&gt;compass&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
            &lt;span class="nx"&gt;dist&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
                &lt;span class="nx"&gt;options&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
                    &lt;span class="nx"&gt;config&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;config.rb&amp;#39;&lt;/span&gt;
                &lt;span class="p"&gt;}&lt;/span&gt;
            &lt;span class="p"&gt;}&lt;/span&gt;
        &lt;span class="p"&gt;},&lt;/span&gt;
        &lt;span class="nx"&gt;webfont&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
            &lt;span class="nx"&gt;icons&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
                &lt;span class="nx"&gt;src&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;fontcustom/vectors/*.svg&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                &lt;span class="nx"&gt;dest&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;static/font&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                &lt;span class="nx"&gt;destCss&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;static/css&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                &lt;span class="nx"&gt;options&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
                    &lt;span class="nx"&gt;htmlDemo&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                    &lt;span class="nx"&gt;hashes&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                    &lt;span class="nx"&gt;font&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;font-custom&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                    &lt;span class="nx"&gt;types&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;eot,woff,svg,ttf&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                    &lt;span class="nx"&gt;syntax&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;bem&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                    &lt;span class="nx"&gt;templateOptions&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
                        &lt;span class="nx"&gt;baseClass&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;fa&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                        &lt;span class="nx"&gt;classPrefix&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;fa-&amp;#39;&lt;/span&gt;
                    &lt;span class="p"&gt;}&lt;/span&gt;
                &lt;span class="p"&gt;}&lt;/span&gt;
            &lt;span class="p"&gt;}&lt;/span&gt;
        &lt;span class="p"&gt;}&lt;/span&gt;
    &lt;span class="p"&gt;});&lt;/span&gt;

    &lt;span class="nx"&gt;grunt&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;loadNpmTasks&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;grunt-contrib-compass&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="nx"&gt;grunt&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;loadNpmTasks&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;grunt-webfont&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

    &lt;span class="nx"&gt;grunt&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;registerTask&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;default&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;compass&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;webfont&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]);&lt;/span&gt;
&lt;span class="p"&gt;};&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="reduce-ajax-requests"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id5"&gt;Reduce AJAX requests&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;Improvements:&lt;/p&gt;
&lt;dl class="docutils"&gt;
&lt;dt&gt;Requests (SSL)&lt;/dt&gt;
&lt;dd&gt;−1&lt;/dd&gt;
&lt;/dl&gt;
&lt;p&gt;The original theme included a script which obtained a list of GitHub
repositories directly from the &lt;a class="reference external" href="https://docs.github.com/en/rest"&gt;GitHub API&lt;/a&gt;. To reduce the overhead of a SSL
request the list of GitHub repositories was generated during the build process
with &lt;a class="reference external" href="https://github.com/kura/pelican-githubprojects"&gt;kura/pelican-githubprojects&lt;/a&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="custom-jquery"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id6"&gt;Custom jQuery&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;Improvements:&lt;/p&gt;
&lt;dl class="docutils"&gt;
&lt;dt&gt;Page size&lt;/dt&gt;
&lt;dd&gt;−18.5&amp;nbsp;kB&lt;/dd&gt;
&lt;/dl&gt;
&lt;p&gt;A custom build of &lt;a class="reference external" href="https://github.com/jquery/jquery"&gt;jQuery&lt;/a&gt; was created according to the instructions in the
&lt;a class="reference external" href="https://github.com/jquery/jquery/blob/master/README.md"&gt;jQuery README file&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;By excluding the modules ajax, deprecated, offset, and effects,
&lt;tt class="docutils literal"&gt;jquery.min.js&lt;/tt&gt; was reduced from 84.2&amp;nbsp;kB to 65.7&amp;nbsp;kB.&lt;/p&gt;
&lt;p&gt;Below is the Grunt command used to build &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;jquery-custom.min.js&lt;/span&gt;&lt;/tt&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="go"&gt;jquery((2.1.3))$ grunt custom:-ajax,-deprecated,-offset,-effects&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="merge-and-minify-assets"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id7"&gt;Merge and minify assets&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;Improvements:&lt;/p&gt;
&lt;dl class="docutils"&gt;
&lt;dt&gt;Requests&lt;/dt&gt;
&lt;dd&gt;−5&lt;/dd&gt;
&lt;/dl&gt;
&lt;p&gt;Both JavaScript and CSS were combined using &lt;a class="reference external" href="https://github.com/miracle2k/webassets"&gt;webassets&lt;/a&gt; via the
&lt;a class="reference external" href="https://github.com/getpelican/pelican-plugins"&gt;Pelican assets plug-in&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Five CSS files were merged into a single file and compressed with the
&lt;a class="reference external" href="https://yui.github.io/yuicompressor/"&gt;YUI Compressor&lt;/a&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;assets&lt;/span&gt; &lt;span class="nv"&gt;filters&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;yui_css&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nv"&gt;output&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;css/styles.%(version)s.min.css&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;css/bootstrap-custom.css&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;css/font-custom.css&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;css/github-repos.css&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;css/style.css&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;pygments&amp;quot;&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;&lt;span class="x"&gt;&lt;/span&gt;
&lt;span class="x"&gt;    &amp;lt;link href=&amp;quot;&lt;/span&gt;&lt;span class="cp"&gt;{{&lt;/span&gt; &lt;span class="nv"&gt;SITEURL&lt;/span&gt; &lt;span class="cp"&gt;}}&lt;/span&gt;&lt;span class="x"&gt;/&lt;/span&gt;&lt;span class="cp"&gt;{{&lt;/span&gt; &lt;span class="nv"&gt;ASSET_URL&lt;/span&gt; &lt;span class="cp"&gt;}}&lt;/span&gt;&lt;span class="x"&gt;&amp;quot; rel=&amp;quot;stylesheet&amp;quot; /&amp;gt;&lt;/span&gt;
&lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;endassets&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;&lt;span class="x"&gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Three JavaScript files were merged and compressed, again with the YUI
Compressor.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;assets&lt;/span&gt; &lt;span class="nv"&gt;filters&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;yui_js&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nv"&gt;output&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;js/scripts.%(version)s.min.js&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;js/jquery/jquery-custom.min.js&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;js/bootstrap/transition.js&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;js/bootstrap/collapse.js&amp;quot;&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;&lt;span class="x"&gt;&lt;/span&gt;
&lt;span class="x"&gt;    &amp;lt;script src=&amp;quot;&lt;/span&gt;&lt;span class="cp"&gt;{{&lt;/span&gt; &lt;span class="nv"&gt;SITEURL&lt;/span&gt; &lt;span class="cp"&gt;}}&lt;/span&gt;&lt;span class="x"&gt;/&lt;/span&gt;&lt;span class="cp"&gt;{{&lt;/span&gt; &lt;span class="nv"&gt;ASSET_URL&lt;/span&gt; &lt;span class="cp"&gt;}}&lt;/span&gt;&lt;span class="x"&gt;&amp;quot;&amp;gt;&amp;lt;/script&amp;gt;&lt;/span&gt;
&lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;endassets&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;&lt;span class="x"&gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;While the homepage of this site did not include images, page size can often be
significantly reduced by optimising images. For example, the two Pingdom screen
shots were reduced by &lt;a class="reference external" href="https://pmt.sourceforge.io/pngcrush/"&gt;pngcrush&lt;/a&gt; to approximately 27&amp;nbsp;% of the original size.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="eliminate-unnecessary-resources-and-dns-look-ups"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id8"&gt;Eliminate unnecessary resources and DNS look-ups&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;Improvements:&lt;/p&gt;
&lt;dl class="docutils"&gt;
&lt;dt&gt;Requests&lt;/dt&gt;
&lt;dd&gt;−4&lt;/dd&gt;
&lt;dt&gt;Redirects&lt;/dt&gt;
&lt;dd&gt;−1&lt;/dd&gt;
&lt;dt&gt;Page size&lt;/dt&gt;
&lt;dd&gt;−8.5&amp;nbsp;kB&lt;/dd&gt;
&lt;dt&gt;DNS look-ups&lt;/dt&gt;
&lt;dd&gt;−1&lt;/dd&gt;
&lt;/dl&gt;
&lt;p&gt;Some unnecessary resources were removed from the page including:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;The Creative Commons licence badge was removed saving two requests (one of
which was a 301 redirect) and 483&amp;nbsp;B.&lt;/li&gt;
&lt;li&gt;The JavaScript files &lt;tt class="docutils literal"&gt;github.js&lt;/tt&gt; (1.5&amp;nbsp;kB) and &lt;tt class="docutils literal"&gt;jXHR.js&lt;/tt&gt; (2.5&amp;nbsp;kB) were
removed as they were replaced by pelican-githubprojects.&lt;/li&gt;
&lt;li&gt;&lt;tt class="docutils literal"&gt;respond.js&lt;/tt&gt; (4.0&amp;nbsp;kB) was removed as it was decided not to support older
browsers.&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="post-optimisation"&gt;
&lt;h2&gt;&lt;a class="toc-backref" href="#id9"&gt;Post-optimisation&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Below is a table summarising the changes made to improve page speed.&lt;/p&gt;
&lt;table border="1" class="docutils"&gt;
&lt;colgroup&gt;
&lt;col width="42%" /&gt;
&lt;col width="21%" /&gt;
&lt;col width="22%" /&gt;
&lt;col width="16%" /&gt;
&lt;/colgroup&gt;
&lt;thead valign="bottom"&gt;
&lt;tr&gt;&lt;th class="head"&gt;seth.fischer.nz&lt;/th&gt;
&lt;th class="head"&gt;Pre-optimisation&lt;/th&gt;
&lt;th class="head"&gt;Post-optimisation&lt;/th&gt;
&lt;th class="head"&gt;Improvement&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td&gt;Requests&lt;/td&gt;
&lt;td&gt;16&lt;/td&gt;
&lt;td&gt;6&lt;/td&gt;
&lt;td&gt;−10 requests&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;Requests (SSL)&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;0&lt;/td&gt;
&lt;td&gt;−1 request&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;Redirects&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;0&lt;/td&gt;
&lt;td&gt;−1 redirect&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;Page size&lt;/td&gt;
&lt;td&gt;182.9&amp;nbsp;kB&lt;/td&gt;
&lt;td&gt;69.0&amp;nbsp;kB&lt;/td&gt;
&lt;td&gt;−113.9&amp;nbsp;kB&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;Pingdom performance grade&lt;/td&gt;
&lt;td&gt;81/100&lt;/td&gt;
&lt;td&gt;88/100&lt;/td&gt;
&lt;td&gt;+7/100&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;Google PageSpeed score (mobile)&lt;/td&gt;
&lt;td&gt;74/100&lt;/td&gt;
&lt;td&gt;89/100&lt;/td&gt;
&lt;td&gt;+15/100&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;Google PageSpeed score (desktop)&lt;/td&gt;
&lt;td&gt;87/100&lt;/td&gt;
&lt;td&gt;95/100&lt;/td&gt;
&lt;td&gt;+8/100&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;Full details are available in the &lt;a class="reference external" href="https://seth.fischer.nz/static/optimising-page-speed-case-study/seth.fischer.nz_2015-03-16_2149.har"&gt;post-optimisation HAR file&lt;/a&gt;.&lt;/p&gt;
&lt;div class="figure"&gt;
&lt;img alt="Pingdom speed test summary post-optimisation; Performance grade: 88/100; Requests: 6; Load time: 194 ms; Page size 69.0 kB" src="/static/optimising-page-speed-case-study/seth.fischer.nz_2015-03-16_2149_pingdom.png" style="width: 582px; height: 133px;" /&gt;
&lt;p class="caption"&gt;Pingdom speed test summary pre-optimisation.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="hosting-environment"&gt;
&lt;h2&gt;&lt;a class="toc-backref" href="#id10"&gt;Hosting environment&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;This site is currently hosted by &lt;a class="reference external" href="https://pages.github.com/"&gt;GitHub Pages&lt;/a&gt;. Besides free-of-charge
managed hosting, GitHub Pages also offers all the advantages of their global
content delivery network.&lt;/p&gt;
&lt;p&gt;GitHub Pages compresses &lt;tt class="docutils literal"&gt;*.html&lt;/tt&gt;, &lt;tt class="docutils literal"&gt;*.css&lt;/tt&gt;, and &lt;tt class="docutils literal"&gt;*.js&lt;/tt&gt; files using gzip
and sets the appropriate HTTP header &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;Content-Encoding:&lt;/span&gt; gzip&lt;/tt&gt;.&lt;/p&gt;
&lt;p&gt;A disadvantage of using GitHub Pages as a hosting platform (in relation to page
speed) is the inability to modify HTTP headers to control client-side caching.&lt;/p&gt;
&lt;p&gt;The cache control HTTP headers set by GitHub Pages at the time of writing were:&lt;/p&gt;
&lt;table border="1" class="docutils"&gt;
&lt;colgroup&gt;
&lt;col width="63%" /&gt;
&lt;col width="37%" /&gt;
&lt;/colgroup&gt;
&lt;thead valign="bottom"&gt;
&lt;tr&gt;&lt;th class="head"&gt;Content-Type&lt;/th&gt;
&lt;th class="head"&gt;Cache-Control&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td&gt;text/html&lt;/td&gt;
&lt;td&gt;max-age=600&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;text/css&lt;/td&gt;
&lt;td&gt;max-age=600&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;application/javascript&lt;/td&gt;
&lt;td&gt;max-age=600&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;If supported by the hosting environment a far future expires header
&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;Cache-Control:&lt;/span&gt; &lt;span class="pre"&gt;&amp;quot;max-age=31536000&amp;quot;&lt;/span&gt;&lt;/tt&gt; (one year) could safely be added to
content types text/css and application/javascript as the webassets plug-in adds
a version identifier to the filename of those content types.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="summary"&gt;
&lt;h2&gt;&lt;a class="toc-backref" href="#id11"&gt;Summary&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;These optimisations have reduced the page size by 113.9&amp;nbsp;kB and the number of
requests by twelve. These improvements result in a significantly improved page
load time.&lt;/p&gt;
&lt;p&gt;As a result of the modifications made to achieve these improvements the
capability and flexibility of the original theme has been reduced. In addition,
due to the extensive nature of the modifications merging upstream commits is no
longer a trivial task.&lt;/p&gt;
&lt;p&gt;The ease of use of the original theme has also been affected by introducing the
following dependencies:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;strong&gt;Build from source&lt;/strong&gt;&lt;ul&gt;
&lt;li&gt;jQuery&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Node packages&lt;/strong&gt;&lt;ul&gt;
&lt;li&gt;Grunt&lt;/li&gt;
&lt;li&gt;grunt-contrib-compass&lt;/li&gt;
&lt;li&gt;grunt-webfont&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Pelican plug-ins&lt;/strong&gt;&lt;ul&gt;
&lt;li&gt;pelican-assets&lt;/li&gt;
&lt;li&gt;pelican-githubprojects&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Ruby gems&lt;/strong&gt;&lt;ul&gt;
&lt;li&gt;bootstrap-sass&lt;/li&gt;
&lt;li&gt;compass&lt;/li&gt;
&lt;li&gt;fontcustom&lt;/li&gt;
&lt;li&gt;sass&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class="section" id="further-reading"&gt;
&lt;h2&gt;&lt;a class="toc-backref" href="#id12"&gt;Further reading&lt;/a&gt;&lt;/h2&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;a class="reference external" href="https://w3c.github.io/web-performance/specs/HAR/Overview.html"&gt;HTTP Archive (HAR) format specification&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="https://webassets.readthedocs.io/en/latest/expiring.html"&gt;URL Expiry (cache busting)&lt;/a&gt; webassets documentation&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="https://developers.google.com/speed"&gt;Make the web faster&lt;/a&gt; Google Developers documentation&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="https://developer.yahoo.com/performance/rules.html"&gt;Best Practices for Speeding Up Your Web Site&lt;/a&gt; Yahoo Developer Network&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="https://pages.github.com/"&gt;GitHub Pages&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="https://tools.pingdom.com/"&gt;Pingdom tools website speed test&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
</content><category term="Web development"></category><category term="Client side"></category><category term="Pelican"></category></entry><entry><title>Deploying Drupal 8 with Fabric</title><link href="https://seth.fischer.nz/drupal-8-fabric-deploy.html" rel="alternate"></link><published>2015-02-06T09:38:00+13:00</published><updated>2015-02-06T09:38:00+13:00</updated><author><name>Seth Fischer</name></author><id>tag:seth.fischer.nz,2015-02-06:/drupal-8-fabric-deploy.html</id><summary type="html">&lt;p class="first"&gt;This Drupal 8 article is obsolete.&lt;/p&gt;
&lt;p class="last"&gt;An automated build and deployment process saves time and, more
importantly, provides a safeguard against failed deployments. Fabric is a
tool that can be used to automate application deployment and related tasks.
This article describes using Fabric to deploy a Drupal 8 site.&lt;/p&gt;
</summary><content type="html">&lt;div class="admonition warning"&gt;
&lt;p class="first admonition-title"&gt;Warning&lt;/p&gt;
&lt;p class="last"&gt;This Drupal&amp;nbsp;8 article is obsolete. It was published in February 2015, nine
months before Drupal&amp;nbsp;8 was released.&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;An automated build and deployment process saves time and, more importantly,
provides a safeguard against failed deployments. &lt;a class="reference external" href="http://www.fabfile.org/"&gt;Fabric&lt;/a&gt; is a tool that can
be used to automate application deployment and related tasks. This article
describes using Fabric to deploy a Drupal&amp;nbsp;8 site.&lt;/p&gt;
&lt;p&gt;Visit &lt;a class="reference external" href="https://github.com/sethfischer/fabric-deploy"&gt;sethfischer/fabric-deploy&lt;/a&gt; for the most recent version of the fabfile
which is an adaptation of &lt;a class="reference external" href="https://github.com/halcyonCorsair/fabric-deploy"&gt;halcyonCorsair/fabric-deploy&lt;/a&gt;—a fabfile for the
deployment of Drupal&amp;nbsp;7 sites.&lt;/p&gt;
&lt;div class="contents topic" id="contents"&gt;
&lt;p class="topic-title"&gt;Contents&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;a class="reference internal" href="#drupal-project-structure" id="id1"&gt;Drupal project structure&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a class="reference internal" href="#synchronise-site-uuid-across-instances" id="id2"&gt;Synchronise site UUID across instances&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#exclude-files-from-release-tarball" id="id3"&gt;Exclude files from release tarball&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#target-host-configuration" id="id4"&gt;Target host configuration&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a class="reference internal" href="#user-account" id="id5"&gt;User account&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#directory-structure" id="id6"&gt;Directory structure&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#dependencies" id="id7"&gt;Dependencies&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#manual-configuration" id="id8"&gt;Manual configuration&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#fabfile" id="id9"&gt;Fabfile&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a class="reference internal" href="#configuration" id="id10"&gt;Configuration&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#available-commands" id="id11"&gt;Available commands&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#usage" id="id12"&gt;Usage&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#source-code" id="id13"&gt;Source code&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#further-reading" id="id14"&gt;Further reading&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class="section" id="drupal-project-structure"&gt;
&lt;h2&gt;&lt;a class="toc-backref" href="#id1"&gt;Drupal project structure&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;The fabfile is designed to deploy a site having a project structure as
described in &lt;a class="reference external" href="https://seth.fischer.nz/drupal-8-workflow-using-git-subtree-merge.html"&gt;A Drupal&amp;nbsp;8 workflow using the Git subtree merge strategy&lt;/a&gt;.
However it may be easily adapted to accommodate another project structure.&lt;/p&gt;
&lt;div class="section" id="synchronise-site-uuid-across-instances"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id2"&gt;Synchronise site UUID across instances&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;To share configuration between instances of the site (development, staging,
production) they must share a common
&lt;abbr title="Universally unique identifier"&gt;UUID&lt;/abbr&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$ &lt;/span&gt;drush cget system.site
&lt;span class="go"&gt;uuid: cdd9a662-e53d-0944-be57-8765c04d38f1&lt;/span&gt;
&lt;span class="go"&gt;name: example.com&lt;/span&gt;
&lt;span class="go"&gt;mail: admin@example.com&lt;/span&gt;
&lt;span class="go"&gt;slogan: &amp;#39;&amp;#39;&lt;/span&gt;
&lt;span class="go"&gt;page:&lt;/span&gt;
&lt;span class="go"&gt;  403: &amp;#39;&amp;#39;&lt;/span&gt;
&lt;span class="go"&gt;  404: &amp;#39;&amp;#39;&lt;/span&gt;
&lt;span class="go"&gt;  front: node&lt;/span&gt;
&lt;span class="go"&gt;admin_compact_mode: false&lt;/span&gt;
&lt;span class="go"&gt;weight_select_max: 100&lt;/span&gt;
&lt;span class="go"&gt;langcode: en&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The site UUID may be edited with the command &lt;tt class="docutils literal"&gt;drush cedit system.site&lt;/tt&gt;. For
a robust approach to synchronising UUIDs across instances of a site see
&lt;a class="reference external" href="https://blog.dcycle.com/blog/68/approach-code-driven-development-drupal-8/"&gt;An approach to code-driven development in Drupal 8&lt;/a&gt; by &lt;a class="reference external" href="https://github.com/alberto56/"&gt;Albert Albala&lt;/a&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="exclude-files-from-release-tarball"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id3"&gt;Exclude files from release tarball&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;As an enhancement files can be excluded from the release tarball by including
a &lt;tt class="docutils literal"&gt;.gitattributes&lt;/tt&gt; file in the root of the repository. For each file that
should be excluded from the release the &lt;a class="reference external" href="https://git-scm.com/book/en/v2/Customizing-Git-Git-Attributes#_exporting_your_repository"&gt;export-ignore attribute&lt;/a&gt; should be
specified. Use this
&lt;a class="reference external" href="https://gist.github.com/sethfischer/bdda9753837ab1da680a"&gt;.gitattributes export-ignore template for Drupal&amp;nbsp;8 projects&lt;/a&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="target-host-configuration"&gt;
&lt;h2&gt;&lt;a class="toc-backref" href="#id4"&gt;Target host configuration&lt;/a&gt;&lt;/h2&gt;
&lt;div class="section" id="user-account"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id5"&gt;User account&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;The user who executes the deployment must have ssh access to the target host
and permissions to execute commands as both the &lt;tt class="docutils literal"&gt;root&lt;/tt&gt; and web server user --
usually &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;www-data&lt;/span&gt;&lt;/tt&gt; on Debian–based systems.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="directory-structure"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id6"&gt;Directory structure&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;Variable data such as the Drupal &lt;tt class="docutils literal"&gt;files/&lt;/tt&gt; directory, &lt;tt class="docutils literal"&gt;settings.php&lt;/tt&gt;,
and &lt;tt class="docutils literal"&gt;services.yml&lt;/tt&gt; is located in &lt;tt class="docutils literal"&gt;/var/lib/www/example.com/&lt;/tt&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$ &lt;/span&gt;tree -AF /var/lib/www/example.com/
&lt;span class="go"&gt;/var/lib/www/example.com/&lt;/span&gt;
&lt;span class="go"&gt;├── files/&lt;/span&gt;
&lt;span class="go"&gt;├── services.yml&lt;/span&gt;
&lt;span class="go"&gt;└── settings.php&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The Drupal site code base is installed in &lt;tt class="docutils literal"&gt;/var/www/&lt;/tt&gt; with symlinks to the
variable data being created during deployment.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$ &lt;/span&gt;tree -AFL &lt;span class="m"&gt;4&lt;/span&gt; /var/www/example.com/
&lt;span class="go"&gt;/var/www/example.com/&lt;/span&gt;
&lt;span class="go"&gt;├── current -&amp;gt; /var/www/example.com/releases/tag_x/&lt;/span&gt;
&lt;span class="go"&gt;└── releases/&lt;/span&gt;
&lt;span class="go"&gt;    └── tag_x/&lt;/span&gt;
&lt;span class="go"&gt;        ├── config/&lt;/span&gt;
&lt;span class="go"&gt;        │   ├── active/&lt;/span&gt;
&lt;span class="go"&gt;        │   ├── deploy/&lt;/span&gt;
&lt;span class="go"&gt;        │   └── staging/&lt;/span&gt;
&lt;span class="go"&gt;        ├── drupal/&lt;/span&gt;
&lt;span class="go"&gt;        │   ├── composer.json&lt;/span&gt;
&lt;span class="go"&gt;        │   ├── core/&lt;/span&gt;
&lt;span class="go"&gt;        │   ├── example.gitignore&lt;/span&gt;
&lt;span class="go"&gt;        │   ├── index.php&lt;/span&gt;
&lt;span class="go"&gt;        │   ├── modules/&lt;/span&gt;
&lt;span class="go"&gt;        │   ├── profiles/&lt;/span&gt;
&lt;span class="go"&gt;        │   ├── README.txt&lt;/span&gt;
&lt;span class="go"&gt;        │   ├── robots.txt&lt;/span&gt;
&lt;span class="go"&gt;        │   ├── sites/&lt;/span&gt;
&lt;span class="go"&gt;        │   ├── themes/&lt;/span&gt;
&lt;span class="go"&gt;        │   └── web.config&lt;/span&gt;
&lt;span class="go"&gt;        └── README.md&lt;/span&gt;

&lt;span class="gp"&gt;$ &lt;/span&gt;tree -AFL /var/www/example.com/releases/tag_x/drupal/sites/default/
&lt;span class="go"&gt;/var/www/example.com/releases/tag_x/drupal/sites/default/&lt;/span&gt;
&lt;span class="go"&gt;├── files -&amp;gt; /var/lib/www/uat.reptiles.veri.co.nz/files/&lt;/span&gt;
&lt;span class="go"&gt;├── services.yml -&amp;gt; /var/lib/www/uat.reptiles.veri.co.nz/services.yml&lt;/span&gt;
&lt;span class="go"&gt;└── settings.php -&amp;gt; /var/lib/www/uat.reptiles.veri.co.nz/settings.php&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="dependencies"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id7"&gt;Dependencies&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;The following tools must be installed on the target host:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;a class="reference external" href="https://wiki.debian.org/SSH"&gt;OpenSSH server&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="https://docs.drush.org/en/7.x/install/"&gt;Drush&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class="section" id="manual-configuration"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id8"&gt;Manual configuration&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;The database, &lt;tt class="docutils literal"&gt;settings.php&lt;/tt&gt; and &lt;tt class="docutils literal"&gt;services.yml&lt;/tt&gt; must be manually created on
the target host before the first deployment.&lt;/p&gt;
&lt;p&gt;Open a MySQL console:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$ &lt;/span&gt;ssh host
&lt;span class="gp"&gt;$ &lt;/span&gt;mysql -uroot -p
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Create database and user:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;CREATE&lt;/span&gt; &lt;span class="k"&gt;DATABASE&lt;/span&gt; &lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="k"&gt;CREATE&lt;/span&gt; &lt;span class="k"&gt;USER&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;dbuser&amp;#39;&lt;/span&gt;&lt;span class="nv"&gt;@&amp;#39;localhost&amp;#39;&lt;/span&gt; &lt;span class="k"&gt;IDENTIFIED&lt;/span&gt; &lt;span class="k"&gt;BY&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;password&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="k"&gt;GRANT&lt;/span&gt; &lt;span class="k"&gt;ALL&lt;/span&gt; &lt;span class="k"&gt;PRIVILEGES&lt;/span&gt; &lt;span class="k"&gt;ON&lt;/span&gt; &lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="k"&gt;TO&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;dbuser&amp;#39;&lt;/span&gt;&lt;span class="nv"&gt;@&amp;#39;localhost&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="k"&gt;FLUSH&lt;/span&gt; &lt;span class="k"&gt;PRIVILEGES&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Copy &lt;tt class="docutils literal"&gt;sites/default/settings.php&lt;/tt&gt; and &lt;tt class="docutils literal"&gt;sites/default/services.yml&lt;/tt&gt; to the
target host and edit as appropriate according to the environment.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$ &lt;/span&gt;scp settings.php host:/var/lib/www/example.com/settings.php
&lt;span class="gp"&gt;$ &lt;/span&gt;scp services.yml host:/var/lib/www/example.com/services.yml
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="fabfile"&gt;
&lt;h2&gt;&lt;a class="toc-backref" href="#id9"&gt;Fabfile&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Source code is hosted at &lt;a class="reference external" href="https://github.com/sethfischer/fabric-deploy"&gt;sethfischer/fabric-deploy&lt;/a&gt;.&lt;/p&gt;
&lt;div class="section" id="configuration"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id10"&gt;Configuration&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;Configuration is expressed via &lt;a class="reference external" href="https://yaml.org/"&gt;YAML&lt;/a&gt; with one file per project. Below is an
example configuration file.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# example.yml&lt;/span&gt;

&lt;span class="c1"&gt;# global configuration common to all environments&lt;/span&gt;
&lt;span class="nt"&gt;_global&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="nt"&gt;repository&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;     &lt;span class="l l-Scalar l-Scalar-Plain"&gt;ssh+git://github.com/user/repo.git&lt;/span&gt;
    &lt;span class="nt"&gt;build_dir&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;      &lt;span class="l l-Scalar l-Scalar-Plain"&gt;/home/tmp/builds&lt;/span&gt;
    &lt;span class="nt"&gt;remote_tmp_dir&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;/tmp&lt;/span&gt;

&lt;span class="c1"&gt;# staging environment&lt;/span&gt;
&lt;span class="nt"&gt;staging&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="nt"&gt;hosts&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;staging.example.com&lt;/span&gt;
    &lt;span class="nt"&gt;remote_tmp_dir&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;/tmp&lt;/span&gt;

&lt;span class="c1"&gt;# production environment&lt;/span&gt;
&lt;span class="nt"&gt;prod&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="nt"&gt;hosts&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;example.com&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="available-commands"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id11"&gt;Available commands&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;&lt;tt class="docutils literal"&gt;fab &lt;span class="pre"&gt;-f&lt;/span&gt; drupal8 &lt;span class="pre"&gt;-l&lt;/span&gt;&lt;/tt&gt; lists the available commands with a short description:&lt;/p&gt;
&lt;dl class="docutils"&gt;
&lt;dt&gt;deploy&lt;/dt&gt;
&lt;dd&gt;Deploy release&lt;/dd&gt;
&lt;dt&gt;init_deploy&lt;/dt&gt;
&lt;dd&gt;Deploy initial release&lt;/dd&gt;
&lt;dt&gt;init_host&lt;/dt&gt;
&lt;dd&gt;Initialise directory structure on target host&lt;/dd&gt;
&lt;dt&gt;site&lt;/dt&gt;
&lt;dd&gt;Load configuration from YAML file&lt;/dd&gt;
&lt;/dl&gt;
&lt;/div&gt;
&lt;div class="section" id="usage"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id12"&gt;Usage&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;Initialise directory structure on the &lt;tt class="docutils literal"&gt;uat&lt;/tt&gt; host of &lt;tt class="docutils literal"&gt;example.com&lt;/tt&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$ &lt;/span&gt;fab -f drupal8 site:example.com,uat init_host
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Deploy &lt;tt class="docutils literal"&gt;tag_x&lt;/tt&gt; for &lt;tt class="docutils literal"&gt;example.com&lt;/tt&gt; to &lt;tt class="docutils literal"&gt;uat&lt;/tt&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$ &lt;/span&gt;fab -f drupal8 site:example.com,uat deploy:tag_x
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="source-code"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id13"&gt;Source code&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;For the latest code &lt;tt class="docutils literal"&gt;git clone &lt;span class="pre"&gt;https://github.com/sethfischer/fabric-deploy&lt;/span&gt;&lt;/tt&gt;
or &lt;a class="reference external" href="https://github.com/sethfischer/fabric-deploy/fork"&gt;create a fork&lt;/a&gt;.&lt;/p&gt;
&lt;pre class="code python literal-block"&gt;
&lt;span class="c1"&gt;# -*- coding: utf-8 -*-&lt;/span&gt;
&lt;span class="sd"&gt;&amp;quot;&amp;quot;&amp;quot;Fabric deploy for Drupal 8&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;

&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;os&lt;/span&gt;

&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;yaml&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;fabric.api&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;env&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;lcd&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;local&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;put&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;run&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;runs_once&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;settings&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;sudo&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;task&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;fabric.colors&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;red&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;fabric.utils&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;abort&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;warn&lt;/span&gt;


&lt;span class="nd"&gt;&amp;#64;task&lt;/span&gt;
&lt;span class="nd"&gt;&amp;#64;runs_once&lt;/span&gt;
&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;site&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;site_name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;tier&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="sd"&gt;&amp;quot;&amp;quot;&amp;quot;Load configuration from YAML file
    :param site_name: Site name
    :type site_name: str
    :param tier: Staging tier
    :type tier: str
    &amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
    &lt;span class="n"&gt;env&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;site_name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;site_name&lt;/span&gt;
    &lt;span class="n"&gt;env&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;tier&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;tier&lt;/span&gt;

    &lt;span class="n"&gt;site_config_filename&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;config/&lt;/span&gt;&lt;span class="si"&gt;{site_name}&lt;/span&gt;&lt;span class="s2"&gt;.yml&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;env&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

    &lt;span class="k"&gt;try&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;site_config_file&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;site_config_filename&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;r&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;except&lt;/span&gt; &lt;span class="ne"&gt;IOError&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;abort&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
            &lt;span class="s2"&gt;&amp;quot;Unable to read &lt;/span&gt;&lt;span class="si"&gt;{site_config_filename}&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
                &lt;span class="n"&gt;site_config_filename&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;site_config_filename&lt;/span&gt;
            &lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;site_config_data&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;yaml&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;safe_load&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;site_config_file&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="n"&gt;site_config_file&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;close&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;

        &lt;span class="n"&gt;global_config_data&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;site_config_data&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;_global&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
        &lt;span class="n"&gt;env&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;update&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;global_config_data&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

        &lt;span class="n"&gt;tier_config_data&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;site_config_data&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;tier&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
        &lt;span class="n"&gt;env&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;update&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tier_config_data&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

        &lt;span class="n"&gt;env&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;site_build_dir&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;join&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;env&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;build_dir&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;env&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;site_name&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="n"&gt;env&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;site_repo_dir&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;join&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;env&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;site_build_dir&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;repo&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="n"&gt;env&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;tar_basename&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="si"&gt;{site_name}&lt;/span&gt;&lt;span class="s2"&gt;.tar&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;env&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="n"&gt;env&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;tar_gz_basename&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="si"&gt;{tar_basename}&lt;/span&gt;&lt;span class="s2"&gt;.gz&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;env&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="n"&gt;env&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;tar_pathname&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;join&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;env&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;site_build_dir&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;env&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;tar_basename&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="n"&gt;env&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;tar_gz_pathname&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;join&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;env&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;site_build_dir&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;env&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;tar_gz_basename&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;


&lt;span class="nd"&gt;&amp;#64;task&lt;/span&gt;
&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;init_host&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
    &lt;span class="sd"&gt;&amp;quot;&amp;quot;&amp;quot;Initialise directory structure on target host&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
    &lt;span class="n"&gt;project_dir&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;/var/www/&lt;/span&gt;&lt;span class="si"&gt;{host}&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;env&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;release_dir&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="si"&gt;{project_dir}&lt;/span&gt;&lt;span class="s2"&gt;/releases&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;project_dir&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;project_dir&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;data_dir&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;/var/lib/www/&lt;/span&gt;&lt;span class="si"&gt;{host}&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;env&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

    &lt;span class="n"&gt;sudo&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;mkdir -p &lt;/span&gt;&lt;span class="si"&gt;{release_dir}&lt;/span&gt;&lt;span class="s2"&gt;/&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;release_dir&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;release_dir&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
    &lt;span class="n"&gt;sudo&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;chown -R www-data:www-data &lt;/span&gt;&lt;span class="si"&gt;{project_dir}&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;project_dir&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;project_dir&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;

    &lt;span class="n"&gt;sudo&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;mkdir -p &lt;/span&gt;&lt;span class="si"&gt;{data_dir}&lt;/span&gt;&lt;span class="s2"&gt;/files&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;data_dir&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;data_dir&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
    &lt;span class="n"&gt;sudo&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;chown -R www-data:www-data &lt;/span&gt;&lt;span class="si"&gt;{data_dir}&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;data_dir&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;data_dir&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;

    &lt;span class="n"&gt;warn&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Database must be manually created.&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;warn&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="si"&gt;{data_dir}&lt;/span&gt;&lt;span class="s2"&gt;/settings.php must be manually created.&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;data_dir&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;data_dir&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
    &lt;span class="n"&gt;warn&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="si"&gt;{data_dir}&lt;/span&gt;&lt;span class="s2"&gt;/services.yml must be manually created.&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;data_dir&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;data_dir&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;


&lt;span class="nd"&gt;&amp;#64;task&lt;/span&gt;
&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;init_deploy&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tag&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="sd"&gt;&amp;quot;&amp;quot;&amp;quot;Deploy initial release
    :param tag: Git tags from which to build release
    :type tag: str
    &amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
    &lt;span class="n"&gt;build_exists&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tag&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;build&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tag&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;upload&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
    &lt;span class="n"&gt;extract&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
    &lt;span class="n"&gt;symlink_settings&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
    &lt;span class="n"&gt;symlink_release&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
    &lt;span class="n"&gt;run_drush&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;state-set system.maintenance 1&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;run_drush&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;config-import deploy&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;run_drush&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;updatedb&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;run_drush&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;cache-rebuild&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;run_drush&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;state-set system.maintenance 0&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;


&lt;span class="nd"&gt;&amp;#64;task&lt;/span&gt;
&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;deploy&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tag&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="sd"&gt;&amp;quot;&amp;quot;&amp;quot;Deploy release
    :param tag: Git tags from which to build release
    :type tag: str
    &amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
    &lt;span class="n"&gt;build_exists&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tag&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;build&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tag&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;upload&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
    &lt;span class="n"&gt;extract&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
    &lt;span class="n"&gt;run_drush&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;state-set system.maintenance 1&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;symlink_settings&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
    &lt;span class="n"&gt;symlink_release&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
    &lt;span class="n"&gt;run_drush&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;config-import deploy&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;run_drush&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;updatedb&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;run_drush&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;cache-rebuild&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;run_drush&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;state-set system.maintenance 0&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;


&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;make_dirs&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;directory&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="sd"&gt;&amp;quot;&amp;quot;&amp;quot;Create directories recursively
    :param directory: Directory to be created
    :type directory: str
    &amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="ow"&gt;not&lt;/span&gt; &lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;exists&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;directory&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;makedirs&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;directory&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;


&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;build_exists&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tag&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="sd"&gt;&amp;quot;&amp;quot;&amp;quot;Test if release has previously been deployed
    :param tag: Git tags from which to build release
    :type tag: str
    &amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
    &lt;span class="n"&gt;project_dir&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;/var/www/&lt;/span&gt;&lt;span class="si"&gt;{host}&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;env&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;release_dir&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="si"&gt;{project_dir}&lt;/span&gt;&lt;span class="s2"&gt;/releases&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;project_dir&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;project_dir&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

    &lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="n"&gt;settings&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;warn_only&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;True&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="n"&gt;result&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;run&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
            &lt;span class="s2"&gt;&amp;quot;! test -d &lt;/span&gt;&lt;span class="si"&gt;{release_dir}&lt;/span&gt;&lt;span class="s2"&gt;/&lt;/span&gt;&lt;span class="si"&gt;{tag}&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;release_dir&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;release_dir&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;tag&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;tag&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;result&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;failed&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="n"&gt;abort&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;red&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Release has previously been deployed.&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;


&lt;span class="nd"&gt;&amp;#64;runs_once&lt;/span&gt;
&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;build&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tag&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="sd"&gt;&amp;quot;&amp;quot;&amp;quot;Build release tarball
    :param tag: Git tags from which to build release
    :type tag: str
    &amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
    &lt;span class="n"&gt;env&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;release_tag&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;tag&lt;/span&gt;

    &lt;span class="n"&gt;make_dirs&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;env&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;site_repo_dir&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

    &lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="n"&gt;lcd&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;env&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;site_repo_dir&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="n"&gt;settings&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;warn_only&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;True&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
            &lt;span class="n"&gt;inside_work_tree&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;local&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;git rev-parse --is-inside-work-tree&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;inside_work_tree&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;failed&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="n"&gt;local&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;git clone &lt;/span&gt;&lt;span class="si"&gt;{repository}&lt;/span&gt;&lt;span class="s2"&gt; .&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;env&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;

        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;local&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;git pull&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;succeeded&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="n"&gt;local&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
                &lt;span class="p"&gt;(&lt;/span&gt;
                    &lt;span class="s2"&gt;&amp;quot;git archive &amp;quot;&lt;/span&gt;
                    &lt;span class="s2"&gt;&amp;quot;--format=tar &amp;quot;&lt;/span&gt;
                    &lt;span class="s2"&gt;&amp;quot;--output=&lt;/span&gt;&lt;span class="si"&gt;{tar_pathname}&lt;/span&gt;&lt;span class="s2"&gt; &amp;quot;&lt;/span&gt;
                    &lt;span class="s2"&gt;&amp;quot;--prefix=&lt;/span&gt;&lt;span class="si"&gt;{release_tag}&lt;/span&gt;&lt;span class="s2"&gt;/ &amp;quot;&lt;/span&gt;
                    &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="si"&gt;{release_tag}&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;
                &lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;env&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
            &lt;span class="p"&gt;)&lt;/span&gt;
            &lt;span class="n"&gt;local&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;gzip --force -9 &lt;/span&gt;&lt;span class="si"&gt;{tar_pathname}&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;env&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;


&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;upload&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
    &lt;span class="sd"&gt;&amp;quot;&amp;quot;&amp;quot;Copy tarball to target host&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
    &lt;span class="n"&gt;put&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;env&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;tar_gz_pathname&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;env&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;remote_tmp_dir&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;


&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;extract&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
    &lt;span class="sd"&gt;&amp;quot;&amp;quot;&amp;quot;Extract tarball into release directory&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
    &lt;span class="n"&gt;project_dir&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;/var/www/&lt;/span&gt;&lt;span class="si"&gt;{host}&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;env&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;release_dir&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="si"&gt;{project_dir}&lt;/span&gt;&lt;span class="s2"&gt;/releases&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;project_dir&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;project_dir&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

    &lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="n"&gt;settings&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;sudo_user&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;www-data&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="n"&gt;tar_cmd&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;
            &lt;span class="s2"&gt;&amp;quot;tar &amp;quot;&lt;/span&gt;
            &lt;span class="s2"&gt;&amp;quot;--gzip &amp;quot;&lt;/span&gt;
            &lt;span class="s2"&gt;&amp;quot;--extract &amp;quot;&lt;/span&gt;
            &lt;span class="s2"&gt;&amp;quot;--verbose &amp;quot;&lt;/span&gt;
            &lt;span class="s2"&gt;&amp;quot;--file &lt;/span&gt;&lt;span class="si"&gt;{remote_tmp_dir}&lt;/span&gt;&lt;span class="s2"&gt;/&lt;/span&gt;&lt;span class="si"&gt;{tar_gz_basename}&lt;/span&gt;&lt;span class="s2"&gt; &amp;quot;&lt;/span&gt;
            &lt;span class="s2"&gt;&amp;quot;--directory &lt;/span&gt;&lt;span class="si"&gt;{release_dir}&lt;/span&gt;&lt;span class="s2"&gt;/&amp;quot;&lt;/span&gt;
        &lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="n"&gt;sudo&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
            &lt;span class="n"&gt;tar_cmd&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
                &lt;span class="n"&gt;remote_tmp_dir&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;env&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;remote_tmp_dir&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                &lt;span class="n"&gt;tar_gz_basename&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;env&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;tar_gz_basename&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                &lt;span class="n"&gt;release_dir&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;release_dir&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
            &lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="p"&gt;)&lt;/span&gt;

    &lt;span class="n"&gt;run&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;rm &lt;/span&gt;&lt;span class="si"&gt;{remote_tmp_dir}&lt;/span&gt;&lt;span class="s2"&gt;/&lt;/span&gt;&lt;span class="si"&gt;{tar_gz_basename}&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;env&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;


&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;symlink_settings&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
    &lt;span class="sd"&gt;&amp;quot;&amp;quot;&amp;quot;Symlink configuration files and variable data&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
    &lt;span class="n"&gt;project_dir&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;/var/www/&lt;/span&gt;&lt;span class="si"&gt;{host}&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;env&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;release_dir&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="si"&gt;{project_dir}&lt;/span&gt;&lt;span class="s2"&gt;/releases&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;project_dir&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;project_dir&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;sites_default&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="si"&gt;{release_dir}&lt;/span&gt;&lt;span class="s2"&gt;/&lt;/span&gt;&lt;span class="si"&gt;{release_tag}&lt;/span&gt;&lt;span class="s2"&gt;/drupal/sites/default&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
        &lt;span class="n"&gt;release_dir&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;release_dir&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;release_tag&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;env&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;release_tag&lt;/span&gt;
    &lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;data_dir&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;/var/lib/www/&lt;/span&gt;&lt;span class="si"&gt;{host}&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;env&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

    &lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="n"&gt;settings&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;sudo_user&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;www-data&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="n"&gt;files_target&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="si"&gt;{data_dir}&lt;/span&gt;&lt;span class="s2"&gt;/files&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;data_dir&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;data_dir&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="n"&gt;files_dir&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="si"&gt;{sites_default}&lt;/span&gt;&lt;span class="s2"&gt;/files&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;sites_default&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;sites_default&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

        &lt;span class="n"&gt;sudo&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
            &lt;span class="s2"&gt;&amp;quot;ln -nfs &lt;/span&gt;&lt;span class="si"&gt;{files_target}&lt;/span&gt;&lt;span class="s2"&gt; &lt;/span&gt;&lt;span class="si"&gt;{files_dir}&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
                &lt;span class="n"&gt;files_target&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;files_target&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;files_dir&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;files_dir&lt;/span&gt;
            &lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="p"&gt;)&lt;/span&gt;

        &lt;span class="n"&gt;settings_target&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="si"&gt;{data_dir}&lt;/span&gt;&lt;span class="s2"&gt;/settings.php&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;data_dir&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;data_dir&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="n"&gt;settings_file&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="si"&gt;{sites_default}&lt;/span&gt;&lt;span class="s2"&gt;/settings.php&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
            &lt;span class="n"&gt;sites_default&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;sites_default&lt;/span&gt;
        &lt;span class="p"&gt;)&lt;/span&gt;

        &lt;span class="n"&gt;sudo&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
            &lt;span class="s2"&gt;&amp;quot;ln -nfs &lt;/span&gt;&lt;span class="si"&gt;{settings_target}&lt;/span&gt;&lt;span class="s2"&gt; &lt;/span&gt;&lt;span class="si"&gt;{settings_file}&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
                &lt;span class="n"&gt;settings_target&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;settings_target&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;settings_file&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;settings_file&lt;/span&gt;
            &lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="p"&gt;)&lt;/span&gt;

        &lt;span class="n"&gt;services_target&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="si"&gt;{data_dir}&lt;/span&gt;&lt;span class="s2"&gt;/services.yml&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;data_dir&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;data_dir&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="n"&gt;services_file&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="si"&gt;{sites_default}&lt;/span&gt;&lt;span class="s2"&gt;/services.yml&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
            &lt;span class="n"&gt;sites_default&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;sites_default&lt;/span&gt;
        &lt;span class="p"&gt;)&lt;/span&gt;

        &lt;span class="n"&gt;sudo&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
            &lt;span class="s2"&gt;&amp;quot;ln -nfs &lt;/span&gt;&lt;span class="si"&gt;{services_target}&lt;/span&gt;&lt;span class="s2"&gt; &lt;/span&gt;&lt;span class="si"&gt;{services_file}&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
                &lt;span class="n"&gt;services_target&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;services_target&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;services_file&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;services_file&lt;/span&gt;
            &lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="p"&gt;)&lt;/span&gt;

    &lt;span class="n"&gt;sudo&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
        &lt;span class="s2"&gt;&amp;quot;chown www-data:www-data &lt;/span&gt;&lt;span class="si"&gt;{settings_target}&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
            &lt;span class="n"&gt;settings_target&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;settings_target&lt;/span&gt;
        &lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;sudo&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;chmod 0400 &lt;/span&gt;&lt;span class="si"&gt;{settings_target}&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;settings_target&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;settings_target&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;

    &lt;span class="n"&gt;sudo&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
        &lt;span class="s2"&gt;&amp;quot;chown www-data:www-data &lt;/span&gt;&lt;span class="si"&gt;{services_target}&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
            &lt;span class="n"&gt;services_target&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;services_target&lt;/span&gt;
        &lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;sudo&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;chmod 0400 &lt;/span&gt;&lt;span class="si"&gt;{services_target}&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;services_target&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;services_target&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;


&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;symlink_release&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
    &lt;span class="sd"&gt;&amp;quot;&amp;quot;&amp;quot;Symlink release&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
    &lt;span class="n"&gt;release_dir&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;/var/www/&lt;/span&gt;&lt;span class="si"&gt;{host}&lt;/span&gt;&lt;span class="s2"&gt;/releases/&lt;/span&gt;&lt;span class="si"&gt;{release_tag}&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;env&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;current&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;/var/www/&lt;/span&gt;&lt;span class="si"&gt;{host}&lt;/span&gt;&lt;span class="s2"&gt;/current&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;env&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="n"&gt;settings&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;sudo_user&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;www-data&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="n"&gt;sudo&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
            &lt;span class="s2"&gt;&amp;quot;ln -nfs &lt;/span&gt;&lt;span class="si"&gt;{release_dir}&lt;/span&gt;&lt;span class="s2"&gt; &lt;/span&gt;&lt;span class="si"&gt;{current}&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
                &lt;span class="n"&gt;release_dir&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;release_dir&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;current&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;current&lt;/span&gt;
            &lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="p"&gt;)&lt;/span&gt;


&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;run_drush&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;command&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="sd"&gt;&amp;quot;&amp;quot;&amp;quot;Run a Drush command
    :param command: Drush command to run
    :type command: str
    &amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
    &lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="n"&gt;settings&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;sudo_user&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;www-data&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="n"&gt;sudo&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
            &lt;span class="s2"&gt;&amp;quot;drush -u 1 -y -r &lt;/span&gt;&lt;span class="si"&gt;{drupal_root}&lt;/span&gt;&lt;span class="s2"&gt; &lt;/span&gt;&lt;span class="si"&gt;{command}&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
                &lt;span class="n"&gt;drupal_root&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;/var/www/&lt;/span&gt;&lt;span class="si"&gt;{host}&lt;/span&gt;&lt;span class="s2"&gt;/current/drupal&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;env&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
                &lt;span class="n"&gt;command&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;command&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
            &lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="further-reading"&gt;
&lt;h2&gt;&lt;a class="toc-backref" href="#id14"&gt;Further reading&lt;/a&gt;&lt;/h2&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;a class="reference external" href="https://drushcommands.com/drush-7x/"&gt;Drush 7.x commands&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="https://docs.fabfile.org/en/1.10/"&gt;Fabric’s documentation&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="https://www.drupal.org/node/1613424"&gt;Drupal core issue: Allow a site to be installed from existing
configuration&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="https://www.drupal.org/docs/configuration-management/managing-your-sites-configuration"&gt;Managing configuration in Drupal 8&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
</content><category term="DevOps"></category><category term="Drupal 8"></category><category term="Drupal"></category><category term="Fabric"></category><category term="Python"></category></entry><entry><title>A Drupal 8 workflow using the Git subtree merge strategy</title><link href="https://seth.fischer.nz/drupal-8-workflow-using-git-subtree-merge.html" rel="alternate"></link><published>2015-01-23T19:20:00+13:00</published><updated>2015-01-23T19:20:00+13:00</updated><author><name>Seth Fischer</name></author><id>tag:seth.fischer.nz,2015-01-23:/drupal-8-workflow-using-git-subtree-merge.html</id><summary type="html">&lt;p class="first"&gt;This Drupal 8 article is obsolete.&lt;/p&gt;
&lt;p class="last"&gt;Often there are components of a Drupal website that should not be
located in the document root such as configuration files. It is convenient
to keep these files in version control but outside of the Drupal root. By
utilising Git subtrees, a Drupal installation root may be below the root of
the main repository, and upstream changes to Drupal core conveniently
merged with git read-tree.&lt;/p&gt;
</summary><content type="html">&lt;div class="admonition warning"&gt;
&lt;p class="first admonition-title"&gt;Warning&lt;/p&gt;
&lt;p class="last"&gt;This Drupal&amp;nbsp;8 article is obsolete. It was published in January 2015, eleven
months before Drupal&amp;nbsp;8 was released and prior to a
&lt;a class="reference external" href="https://www.drupal.org/docs/develop/using-composer/using-composer-with-drupal"&gt;composer-based workflow&lt;/a&gt; being implemented.&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;Often there are components of a Drupal website that should not be located in
the document root such as configuration files, deployment scripts, and
functional tests. By utilising Git subtrees, a Drupal installation root (or web
server document root) may be below the root of the main repository. Upstream
changes to Drupal core may be conveniently merged with &lt;tt class="docutils literal"&gt;git &lt;span class="pre"&gt;read-tree&lt;/span&gt;&lt;/tt&gt;.&lt;/p&gt;
&lt;div class="contents topic" id="contents"&gt;
&lt;p class="topic-title"&gt;Contents&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;a class="reference internal" href="#initialise-git-repository" id="id1"&gt;Initialise Git repository&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#add-upstream-remote" id="id2"&gt;Add upstream remote&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#checkout-a-local-copy-of-the-upstream-branch" id="id3"&gt;Checkout a local copy of the upstream branch&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#pull-upstream-into-a-subdirectory-in-the-master-branch" id="id4"&gt;Pull upstream into a subdirectory in the master branch&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#create-a-gitingore-for-drupal-core" id="id5"&gt;Create a &lt;tt class="docutils literal"&gt;.gitingore&lt;/tt&gt; for Drupal core&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#create-directories-outside-the-document-root" id="id6"&gt;Create directories outside the document root&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#create-the-files-directory-and-set-permissions" id="id7"&gt;Create the &lt;tt class="docutils literal"&gt;files&lt;/tt&gt; directory and set permissions&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#create-database" id="id8"&gt;Create database&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#site-installation" id="id9"&gt;Site installation&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#drupal-configuration-directories" id="id10"&gt;Drupal configuration directories&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#export-configuration" id="id11"&gt;Export configuration&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#update-drupal-core" id="id12"&gt;Update Drupal core&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#further-reading" id="id13"&gt;Further reading&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class="section" id="initialise-git-repository"&gt;
&lt;h2&gt;&lt;a class="toc-backref" href="#id1"&gt;Initialise Git repository&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Initialise Git repository and add your &lt;tt class="docutils literal"&gt;.gitignore&lt;/tt&gt;, &lt;tt class="docutils literal"&gt;README&lt;/tt&gt;, and
&lt;tt class="docutils literal"&gt;LICENSE&lt;/tt&gt; files.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$ &lt;/span&gt;mkdir myproject
&lt;span class="gp"&gt;$ &lt;/span&gt;&lt;span class="nb"&gt;cd&lt;/span&gt; myproject
&lt;span class="gp"&gt;$ &lt;/span&gt;git init
&lt;span class="go"&gt;Initialized empty Git repository in /var/www/myproject/.git/&lt;/span&gt;
&lt;span class="gp"&gt;$ &lt;/span&gt;vi README.md
&lt;span class="gp"&gt;$ &lt;/span&gt;git add README.md
&lt;span class="gp"&gt;$ &lt;/span&gt;git commit -m &lt;span class="s2"&gt;&amp;quot;Add README.md&amp;quot;&lt;/span&gt;
&lt;span class="go"&gt;[master (root-commit) 3a30763] Add README.txt&lt;/span&gt;
&lt;span class="go"&gt; 1 file changed, 1 insertion(+)&lt;/span&gt;
&lt;span class="go"&gt; create mode 100644 README.txt&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="add-upstream-remote"&gt;
&lt;h2&gt;&lt;a class="toc-backref" href="#id2"&gt;Add upstream remote&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Add the drupal.org git repository as a remote with the name &lt;tt class="docutils literal"&gt;upstream&lt;/tt&gt;. To
improve efficiency specify that only the &lt;tt class="docutils literal"&gt;8.0.x&lt;/tt&gt; branch is to be tracked with
the &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;-t&lt;/span&gt;&lt;/tt&gt; option.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$ &lt;/span&gt;git remote add -t &lt;span class="m"&gt;8&lt;/span&gt;.0.x upstream http://git.drupal.org/project/drupal.git
&lt;span class="gp"&gt;$ &lt;/span&gt;git fetch upstream
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="checkout-a-local-copy-of-the-upstream-branch"&gt;
&lt;h2&gt;&lt;a class="toc-backref" href="#id3"&gt;Checkout a local copy of the upstream branch&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Checkout a local copy of the &lt;tt class="docutils literal"&gt;upstream/8.0.x&lt;/tt&gt; branch.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$ &lt;/span&gt;git checkout -b upstream upstream/8.0.x
&lt;span class="go"&gt;Branch upstream set up to track remote branch 8.0.x from upstream by rebasing.&lt;/span&gt;
&lt;span class="go"&gt;Switched to a new branch &amp;#39;upstream&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="pull-upstream-into-a-subdirectory-in-the-master-branch"&gt;
&lt;h2&gt;&lt;a class="toc-backref" href="#id4"&gt;Pull upstream into a subdirectory in the master branch&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;The &lt;tt class="docutils literal"&gt;upstream/8.0.x&lt;/tt&gt; branch is pulled in as a subdirectory of the master
branch using the &lt;tt class="docutils literal"&gt;git &lt;span class="pre"&gt;read-tree&lt;/span&gt;&lt;/tt&gt; command. The name of the subdirectory is
specified with the &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;--prefix&lt;/span&gt;&lt;/tt&gt; option; in this case &lt;tt class="docutils literal"&gt;drupal/&lt;/tt&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$ &lt;/span&gt;git checkout master
&lt;span class="gp"&gt;$ &lt;/span&gt;git merge -s ours --no-commit upstream/8.0.x
&lt;span class="go"&gt;Automatic merge went well; stopped before committing as requested&lt;/span&gt;
&lt;span class="gp"&gt;$ &lt;/span&gt;git read-tree --prefix&lt;span class="o"&gt;=&lt;/span&gt;drupal/ -u upstream/8.0.x
&lt;span class="gp"&gt;$ &lt;/span&gt;git commit
&lt;span class="go"&gt;[master bd410e7] Merge remote-tracking branch &amp;#39;upstream/8.0.x&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The upstream branch is now a subdirectory of the master branch.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$ &lt;/span&gt;tree -L &lt;span class="m"&gt;2&lt;/span&gt;
&lt;span class="go"&gt;.&lt;/span&gt;
&lt;span class="go"&gt;|-- drupal&lt;/span&gt;
&lt;span class="go"&gt;|   |-- composer.json&lt;/span&gt;
&lt;span class="go"&gt;|   |-- core&lt;/span&gt;
&lt;span class="go"&gt;|   |-- example.gitignore&lt;/span&gt;
&lt;span class="go"&gt;|   |-- index.php&lt;/span&gt;
&lt;span class="go"&gt;|   |-- modules&lt;/span&gt;
&lt;span class="go"&gt;|   |-- profiles&lt;/span&gt;
&lt;span class="go"&gt;|   |-- README.txt&lt;/span&gt;
&lt;span class="go"&gt;|   |-- robots.txt&lt;/span&gt;
&lt;span class="go"&gt;|   |-- sites&lt;/span&gt;
&lt;span class="go"&gt;|   |-- themes&lt;/span&gt;
&lt;span class="go"&gt;|   ``-- web.config&lt;/span&gt;
&lt;span class="go"&gt;``-- README.md&lt;/span&gt;

&lt;span class="go"&gt;6 directories, 7 files&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="create-a-gitingore-for-drupal-core"&gt;
&lt;h2&gt;&lt;a class="toc-backref" href="#id5"&gt;Create a &lt;tt class="docutils literal"&gt;.gitingore&lt;/tt&gt; for Drupal core&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Drupal core has an example &lt;tt class="docutils literal"&gt;.gitignore&lt;/tt&gt; file which provides an excellent
starting point and is sufficient for most projects.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$ &lt;/span&gt;cp drupal/example.gitignore drupal/.gitignore
&lt;span class="gp"&gt;$ &lt;/span&gt;git add drupal/.gitignore
&lt;span class="gp"&gt;$ &lt;/span&gt;git commit -m &lt;span class="s2"&gt;&amp;quot;Add .gitignore for Drupal core&amp;quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="create-directories-outside-the-document-root"&gt;
&lt;h2&gt;&lt;a class="toc-backref" href="#id6"&gt;Create directories outside the document root&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;As the document root is now below the repository root, files and directories
may be committed to the repository without exposing them to the web server.&lt;/p&gt;
&lt;p&gt;In this example—when configuring the web server—the document root is set to
&lt;tt class="docutils literal"&gt;/var/www/myproject/drupal&lt;/tt&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$ &lt;/span&gt;mkdir -p config/active config/staging config/deploy
&lt;span class="gp"&gt;$ &lt;/span&gt;tree -L &lt;span class="m"&gt;2&lt;/span&gt;
&lt;span class="go"&gt;.&lt;/span&gt;
&lt;span class="go"&gt;|-- config&lt;/span&gt;
&lt;span class="go"&gt;|   |-- active&lt;/span&gt;
&lt;span class="go"&gt;|   |-- deploy&lt;/span&gt;
&lt;span class="go"&gt;|   ``-- staging&lt;/span&gt;
&lt;span class="go"&gt;|-- drupal&lt;/span&gt;
&lt;span class="go"&gt;|   |-- composer.json&lt;/span&gt;
&lt;span class="go"&gt;|   |-- core&lt;/span&gt;
&lt;span class="go"&gt;|   |-- example.gitignore&lt;/span&gt;
&lt;span class="go"&gt;|   |-- index.php&lt;/span&gt;
&lt;span class="go"&gt;|   |-- modules&lt;/span&gt;
&lt;span class="go"&gt;|   |-- profiles&lt;/span&gt;
&lt;span class="go"&gt;|   |-- README.txt&lt;/span&gt;
&lt;span class="go"&gt;|   |-- robots.txt&lt;/span&gt;
&lt;span class="go"&gt;|   |-- sites&lt;/span&gt;
&lt;span class="go"&gt;|   |-- themes&lt;/span&gt;
&lt;span class="go"&gt;|   ``-- web.config&lt;/span&gt;
&lt;span class="go"&gt;``-- README.md&lt;/span&gt;

&lt;span class="go"&gt;9 directories, 7 files&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="create-the-files-directory-and-set-permissions"&gt;
&lt;h2&gt;&lt;a class="toc-backref" href="#id7"&gt;Create the &lt;tt class="docutils literal"&gt;files&lt;/tt&gt; directory and set permissions&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;The Drupal &lt;tt class="docutils literal"&gt;files&lt;/tt&gt; directory must be manually created.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$ &lt;/span&gt;mkdir drupal/sites/default/files
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;To work efficiently with Drush the files in &lt;tt class="docutils literal"&gt;sites/default/files&lt;/tt&gt; should be
writeable both by the web server and command-line user. An alternative to
&lt;tt class="docutils literal"&gt;chmod &lt;span class="pre"&gt;-R&lt;/span&gt; 777 sites/default/files&lt;/tt&gt; is to use &lt;a class="reference external" href="https://wiki.debian.org/Permissions#Access_Control_Lists_in_Linux"&gt;Access Control Lists&lt;/a&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$ &lt;/span&gt;&lt;span class="nv"&gt;HTTPDUSER&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="sb"&gt;``&lt;/span&gt;ps aux &lt;span class="p"&gt;|&lt;/span&gt; grep -E &lt;span class="s1"&gt;&amp;#39;[a]pache|[h]ttpd|[_]www|[w]ww-data|[n]ginx&amp;#39;&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
grep -v root &lt;span class="p"&gt;|&lt;/span&gt; head -1 &lt;span class="p"&gt;|&lt;/span&gt; cut -d&lt;span class="se"&gt;\ &lt;/span&gt; -f1&lt;span class="sb"&gt;``&lt;/span&gt;
&lt;span class="gp"&gt;$ &lt;/span&gt;sudo setfacl -R -m u:&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$HTTPDUSER&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;:rwX -m u:&lt;span class="sb"&gt;`&lt;/span&gt;whoami&lt;span class="sb"&gt;`&lt;/span&gt;:rwX drupal/sites/default/files
&lt;span class="gp"&gt;$ &lt;/span&gt;sudo setfacl -dR -m u:&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$HTTPDUSER&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;:rwX -m u:&lt;span class="sb"&gt;`&lt;/span&gt;whoami&lt;span class="sb"&gt;`&lt;/span&gt;:rwX drupal/sites/default/files
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;tt class="docutils literal"&gt;HTTPDUSER&lt;/tt&gt; is usually &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;www-data&lt;/span&gt;&lt;/tt&gt; on Debian-based distributions.&lt;/p&gt;
&lt;p&gt;It may be convenient to add similar ACL permissions to the &lt;tt class="docutils literal"&gt;config/active&lt;/tt&gt;,
&lt;tt class="docutils literal"&gt;config/staging&lt;/tt&gt;, and &lt;tt class="docutils literal"&gt;config/deploy&lt;/tt&gt; directories.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="create-database"&gt;
&lt;h2&gt;&lt;a class="toc-backref" href="#id8"&gt;Create database&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Open a MySQL console:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$ &lt;/span&gt;mysql -uroot -p
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Create database and user:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;CREATE&lt;/span&gt; &lt;span class="k"&gt;DATABASE&lt;/span&gt; &lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="k"&gt;CREATE&lt;/span&gt; &lt;span class="k"&gt;USER&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;dbuser&amp;#39;&lt;/span&gt;&lt;span class="nv"&gt;@&amp;#39;localhost&amp;#39;&lt;/span&gt; &lt;span class="k"&gt;IDENTIFIED&lt;/span&gt; &lt;span class="k"&gt;BY&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;password&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="k"&gt;GRANT&lt;/span&gt; &lt;span class="k"&gt;ALL&lt;/span&gt; &lt;span class="k"&gt;PRIVILEGES&lt;/span&gt; &lt;span class="k"&gt;ON&lt;/span&gt; &lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="k"&gt;TO&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;dbuser&amp;#39;&lt;/span&gt;&lt;span class="nv"&gt;@&amp;#39;localhost&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="k"&gt;FLUSH&lt;/span&gt; &lt;span class="k"&gt;PRIVILEGES&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="site-installation"&gt;
&lt;h2&gt;&lt;a class="toc-backref" href="#id9"&gt;Site installation&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Install the site with the standard install profile and change the administrator
password.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$ &lt;/span&gt;&lt;span class="nb"&gt;cd&lt;/span&gt; drupal
&lt;span class="gp"&gt;$ &lt;/span&gt;drush site-install standard --db-url&lt;span class="o"&gt;=&lt;/span&gt;mysql://dbuser:password@localhost/db &lt;span class="se"&gt;\&lt;/span&gt;
--site-name&lt;span class="o"&gt;=&lt;/span&gt;drupal8
&lt;span class="gp"&gt;$ &lt;/span&gt;drush upwd admin --password&lt;span class="o"&gt;=&lt;/span&gt;password
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="drupal-configuration-directories"&gt;
&lt;h2&gt;&lt;a class="toc-backref" href="#id10"&gt;Drupal configuration directories&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Edit &lt;tt class="docutils literal"&gt;sites/default/settings.php&lt;/tt&gt; and update the location of the
configuration directories.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="cp"&gt;&amp;lt;?php&lt;/span&gt;

&lt;span class="c1"&gt;// Default config directories provided by the installer.&lt;/span&gt;
&lt;span class="nv"&gt;$config_directories&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;active&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;../config/active&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="nv"&gt;$config_directories&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;staging&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;../config/staging&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

&lt;span class="c1"&gt;// Config directory used for deployments.&lt;/span&gt;
&lt;span class="nv"&gt;$config_directories&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;deploy&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;../config/deploy&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="export-configuration"&gt;
&lt;h2&gt;&lt;a class="toc-backref" href="#id11"&gt;Export configuration&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Export the configuration from the database into the &lt;tt class="docutils literal"&gt;deploy&lt;/tt&gt; configuration
directory.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$ &lt;/span&gt;&lt;span class="nb"&gt;cd&lt;/span&gt; drupal/
&lt;span class="gp"&gt;$ &lt;/span&gt;drush config-export deploy
&lt;span class="go"&gt;Configuration successfully exported to ../config/deploy.             [success]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Once exported, this configuration may be committed to the Git repository. As
part of the deployment process the configuration may be imported with the
command &lt;tt class="docutils literal"&gt;drush &lt;span class="pre"&gt;config-import&lt;/span&gt; deploy&lt;/tt&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="update-drupal-core"&gt;
&lt;h2&gt;&lt;a class="toc-backref" href="#id12"&gt;Update Drupal core&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;To merge upstream change to Drupal core the &lt;a class="reference external" href="https://git-scm.com/book/en/v2/Git-Tools-Advanced-Merging#_subtree_merge"&gt;Git subtree merge strategy&lt;/a&gt; is
used.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$ &lt;/span&gt;git pull -s subtree upstream &lt;span class="m"&gt;8&lt;/span&gt;.0.x
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The preceding command merges the history of &lt;tt class="docutils literal"&gt;upstream&lt;/tt&gt; with the main
repository. If it is not preferable to merge histories the &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;--squash&lt;/span&gt;&lt;/tt&gt; and
&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;--no-commit&lt;/span&gt;&lt;/tt&gt; options can be used along with the &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;-s&lt;/span&gt; subtree&lt;/tt&gt; strategy
option:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$ &lt;/span&gt;git checkout master
&lt;span class="gp"&gt;$ &lt;/span&gt;git merge --squash -s subtree --no-commit upstream
&lt;span class="go"&gt;Squash commit -- not updating HEAD&lt;/span&gt;
&lt;span class="go"&gt;Automatic merge went well; stopped before committing as requested&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Remember to rebuild the cache after each merge:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$ &lt;/span&gt;drush cache-rebuild
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="further-reading"&gt;
&lt;h2&gt;&lt;a class="toc-backref" href="#id13"&gt;Further reading&lt;/a&gt;&lt;/h2&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;a class="reference external" href="https://git-scm.com/book/en/v2/Git-Tools-Advanced-Merging#_subtree_merge"&gt;Git Tools - Subtree Merging&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="https://www.kernel.org/pub/software/scm/git/docs/howto/using-merge-subtree.html"&gt;How to use the subtree merge strategy&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="https://seth.fischer.nz/drupal-8-fabric-deploy.html"&gt;Deploying Drupal&amp;nbsp;8 with Fabric&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
</content><category term="Web development"></category><category term="Drupal 8"></category><category term="Drupal"></category><category term="Git"></category></entry><entry><title>Getting started with Drupal 8</title><link href="https://seth.fischer.nz/drupal-8-getting-started.html" rel="alternate"></link><published>2014-11-28T22:22:00+13:00</published><updated>2014-11-28T22:22:00+13:00</updated><author><name>Seth Fischer</name></author><id>tag:seth.fischer.nz,2014-11-28:/drupal-8-getting-started.html</id><summary type="html">&lt;p class="first"&gt;This Drupal 8 article is obsolete.&lt;/p&gt;
&lt;p class="last"&gt;Now that Drupal 8 is in beta phase it is a great time for site
developers to start exploring the API. This article serves as an
introduction to installing and configuring Drupal 8 using Git and Drush.&lt;/p&gt;
</summary><content type="html">&lt;div class="admonition warning"&gt;
&lt;p class="first admonition-title"&gt;Warning&lt;/p&gt;
&lt;p class="last"&gt;This Drupal&amp;nbsp;8 article is obsolete. It was published in November 2014, 12 months
before Drupal&amp;nbsp;8 was released.&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;Now that &lt;a class="reference external" href="https://www.drupal.org/8"&gt;Drupal&amp;nbsp;8&lt;/a&gt; is in beta phase it is time for site developers to start
exploring the API. This article describes the installation and configuration of
Drupal&amp;nbsp;8 using Git and Drush.&lt;/p&gt;
&lt;div class="admonition warning"&gt;
&lt;p class="first admonition-title"&gt;Warning&lt;/p&gt;
&lt;p class="last"&gt;As of 28 November 2014 there were 22 &lt;a class="reference external" href="https://www.drupal.org/project/issues/search/drupal?project_issue_followers=&amp;amp;status%5B0%5D=1&amp;amp;status%5B1%5D=13&amp;amp;status%5B2%5D=8&amp;amp;status%5B3%5D=14&amp;amp;status%5B4%5D=15&amp;amp;status%5B5%5D=4&amp;amp;priorities%5B0%5D=400&amp;amp;categories%5B0%5D=1&amp;amp;categories%5B1%5D=2&amp;amp;version%5B0%5D=any_8.&amp;amp;issue_tags_op=%3D&amp;amp;issue_tags=D8%20upgrade%20path"&gt;issues tagged with D8 upgrade path&lt;/a&gt;,
so it may be necessary to rebuild your site with the next core update.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="contents topic" id="contents"&gt;
&lt;p class="topic-title"&gt;Contents&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;a class="reference internal" href="#before-starting" id="id3"&gt;Before starting&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#clone-drupal-8" id="id4"&gt;Clone Drupal&amp;nbsp;8&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#create-the-files-directory-and-set-permissions" id="id5"&gt;Create the &lt;tt class="docutils literal"&gt;files&lt;/tt&gt; directory and set permissions&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#create-database" id="id6"&gt;Create database&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#site-installation" id="id7"&gt;Site installation&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#configure-a-drush-alias" id="id8"&gt;Configure a Drush alias&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#install-contrib-modules" id="id9"&gt;Install contrib modules&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a class="reference internal" href="#devel" id="id10"&gt;Devel&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#examples" id="id11"&gt;Examples&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#regularly-update-drupal-core" id="id12"&gt;Regularly update Drupal core&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#further-reading" id="id13"&gt;Further reading&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class="section" id="before-starting"&gt;
&lt;h2&gt;&lt;a class="toc-backref" href="#id3"&gt;Before starting&lt;/a&gt;&lt;/h2&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;set-up a &lt;abbr title="Linux, Apache, MySQL, PHP"&gt;LAMP&lt;/abbr&gt; or
&lt;abbr title="Linux, nginx, MySQL, PHP"&gt;LNMP&lt;/abbr&gt; stack conforming with the
&lt;a class="reference external" href="https://api.drupal.org/api/drupal/core!INSTALL.txt/8.2.x"&gt;Drupal&amp;nbsp;8 system requirements&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="http://git-scm.com/book/en/v2/Getting-Started-Installing-Git"&gt;install git&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="https://getcomposer.org/doc/00-intro.md#installation-linux-unix-macos"&gt;install Composer&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;using composer, &lt;a class="reference external" href="https://docs.drush.org/en/7.x/install/#composer-one-drush-for-all-projects"&gt;install Drush 7.x (dev)&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class="section" id="clone-drupal-8"&gt;
&lt;h2&gt;&lt;a class="toc-backref" href="#id4"&gt;Clone Drupal&amp;nbsp;8&lt;/a&gt;&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$ &lt;/span&gt;git clone -b &lt;span class="m"&gt;8&lt;/span&gt;.0.x --single-branch http://git.drupal.org/project/drupal.git
&lt;span class="gp"&gt;$ &lt;/span&gt;git remote rename origin upstream
&lt;span class="gp"&gt;$ &lt;/span&gt;git remote add origin &lt;span class="o"&gt;[&lt;/span&gt;url&lt;span class="o"&gt;]&lt;/span&gt;
&lt;span class="gp"&gt;$ &lt;/span&gt;git checkout -b master
&lt;span class="gp"&gt;$ &lt;/span&gt;cp example.gitignore .gitignore
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="create-the-files-directory-and-set-permissions"&gt;
&lt;h2&gt;&lt;a class="toc-backref" href="#id5"&gt;Create the &lt;tt class="docutils literal"&gt;files&lt;/tt&gt; directory and set permissions&lt;/a&gt;&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$ &lt;/span&gt;mkdir sites/default/files
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;To work efficiently with Drush the files in &lt;tt class="docutils literal"&gt;sites/default/files&lt;/tt&gt; should be
writeable both by the web server and command line user. An alternative to
&lt;tt class="docutils literal"&gt;chmod &lt;span class="pre"&gt;-R&lt;/span&gt; 777 sites/default/files&lt;/tt&gt; is to use &lt;a class="reference external" href="https://wiki.debian.org/Permissions#Access_Control_Lists_in_Linux"&gt;Access Control Lists&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;The following shell commands have been adapted from the
&lt;a class="reference external" href="https://symfony.com/doc/2.3/book/installation.html"&gt;Installing and Configuring Symfony&lt;/a&gt; section of the The Symfony Book.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$ &lt;/span&gt;&lt;span class="nv"&gt;HTTPDUSER&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="sb"&gt;`&lt;/span&gt;ps aux &lt;span class="p"&gt;|&lt;/span&gt; grep -E &lt;span class="s1"&gt;&amp;#39;[a]pache|[h]ttpd|[_]www|[w]ww-data|[n]ginx&amp;#39;&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; grep -v root &lt;span class="p"&gt;|&lt;/span&gt; head -1 &lt;span class="p"&gt;|&lt;/span&gt; cut -d&lt;span class="se"&gt;\ &lt;/span&gt; -f1&lt;span class="sb"&gt;`&lt;/span&gt;
&lt;span class="gp"&gt;$ &lt;/span&gt;sudo setfacl -R -m u:&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$HTTPDUSER&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;:rwX -m u:&lt;span class="sb"&gt;`&lt;/span&gt;whoami&lt;span class="sb"&gt;`&lt;/span&gt;:rwX sites/default/files
&lt;span class="gp"&gt;$ &lt;/span&gt;sudo setfacl -dR -m u:&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$HTTPDUSER&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;:rwX -m u:&lt;span class="sb"&gt;`&lt;/span&gt;whoami&lt;span class="sb"&gt;`&lt;/span&gt;:rwX sites/default/files
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;tt class="docutils literal"&gt;HTTPDUSER&lt;/tt&gt; is usually &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;www-data&lt;/span&gt;&lt;/tt&gt; on Debian-based distributions.&lt;/p&gt;
&lt;p&gt;Before setting the access control only the Drush user has &lt;tt class="docutils literal"&gt;rw&lt;/tt&gt; permissions:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$ &lt;/span&gt;getfacl sites/default/files
&lt;span class="gp"&gt;# &lt;/span&gt;file: cache
&lt;span class="gp"&gt;# &lt;/span&gt;owner: drushuser
&lt;span class="gp"&gt;# &lt;/span&gt;group: drushuser
&lt;span class="go"&gt;user::rwx&lt;/span&gt;
&lt;span class="go"&gt;group::rwx&lt;/span&gt;
&lt;span class="go"&gt;other::rwx&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;After setting the access control both the web server user and Drush user have
&lt;tt class="docutils literal"&gt;rw&lt;/tt&gt; permissions:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$ &lt;/span&gt;getfacl sites/default/files
&lt;span class="gp"&gt;# &lt;/span&gt;file: cache
&lt;span class="gp"&gt;# &lt;/span&gt;owner: drushuser
&lt;span class="gp"&gt;# &lt;/span&gt;group: drushuser
&lt;span class="go"&gt;user::rwx&lt;/span&gt;
&lt;span class="go"&gt;user:www-data:rwx&lt;/span&gt;
&lt;span class="go"&gt;user:drushuser:rwx&lt;/span&gt;
&lt;span class="go"&gt;group::rwx&lt;/span&gt;
&lt;span class="go"&gt;mask::rwx&lt;/span&gt;
&lt;span class="go"&gt;other::rwx&lt;/span&gt;
&lt;span class="go"&gt;default:user::rwx&lt;/span&gt;
&lt;span class="go"&gt;default:user:www-data:rwx&lt;/span&gt;
&lt;span class="go"&gt;default:user:drushuser:rwx&lt;/span&gt;
&lt;span class="go"&gt;default:group::rwx&lt;/span&gt;
&lt;span class="go"&gt;default:mask::rwx&lt;/span&gt;
&lt;span class="go"&gt;default:other::rwx&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="create-database"&gt;
&lt;h2&gt;&lt;a class="toc-backref" href="#id6"&gt;Create database&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Open a MySQL console:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$ &lt;/span&gt;mysql -uroot -p
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Create database and user:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;CREATE&lt;/span&gt; &lt;span class="k"&gt;DATABASE&lt;/span&gt; &lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="k"&gt;CREATE&lt;/span&gt; &lt;span class="k"&gt;USER&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;dbuser&amp;#39;&lt;/span&gt;&lt;span class="nv"&gt;@&amp;#39;localhost&amp;#39;&lt;/span&gt; &lt;span class="k"&gt;IDENTIFIED&lt;/span&gt; &lt;span class="k"&gt;BY&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;password&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="k"&gt;GRANT&lt;/span&gt; &lt;span class="k"&gt;ALL&lt;/span&gt; &lt;span class="k"&gt;PRIVILEGES&lt;/span&gt; &lt;span class="k"&gt;ON&lt;/span&gt; &lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="k"&gt;TO&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;dbuser&amp;#39;&lt;/span&gt;&lt;span class="nv"&gt;@&amp;#39;localhost&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="k"&gt;FLUSH&lt;/span&gt; &lt;span class="k"&gt;PRIVILEGES&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="site-installation"&gt;
&lt;h2&gt;&lt;a class="toc-backref" href="#id7"&gt;Site installation&lt;/a&gt;&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$ &lt;/span&gt;drush site-install standard --db-url&lt;span class="o"&gt;=&lt;/span&gt;mysql://dbuser:password@localhost/db --site-name&lt;span class="o"&gt;=&lt;/span&gt;drupal8
&lt;span class="gp"&gt;$ &lt;/span&gt;drush upwd admin --password&lt;span class="o"&gt;=&lt;/span&gt;password
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Drupal&amp;nbsp;8 beta is now configured and you may login with the username “admin” and
password “password”.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="configure-a-drush-alias"&gt;
&lt;h2&gt;&lt;a class="toc-backref" href="#id8"&gt;Configure a Drush alias&lt;/a&gt;&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$ &lt;/span&gt;cp ~/.composer/vendor/drush/drush/examples/example.aliases.drushrc.php ~/.drush/aliases.drushrc.php
&lt;span class="gp"&gt;$ &lt;/span&gt;drush site-alias @self --full --with-optional &amp;gt;&amp;gt; ~/.drush/aliases.drushrc.php
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Edit &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;~/.drush/aliases.drushrc.php&lt;/span&gt;&lt;/tt&gt; and enter your site’s URI.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="cp"&gt;&amp;lt;?php&lt;/span&gt;
&lt;span class="sd"&gt;/**&lt;/span&gt;
&lt;span class="sd"&gt; * Drupal 8 beta&lt;/span&gt;
&lt;span class="sd"&gt; */&lt;/span&gt;
&lt;span class="nv"&gt;$aliases&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;drupal8&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;array&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;
  &lt;span class="s1"&gt;&amp;#39;root&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;/var/www/drupal8&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
  &lt;span class="s1"&gt;&amp;#39;uri&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;http://drupal8&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
  &lt;span class="s1"&gt;&amp;#39;#name&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;drupal8&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
  &lt;span class="s1"&gt;&amp;#39;path-aliases&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt;
  &lt;span class="k"&gt;array&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="s1"&gt;&amp;#39;%drush&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;/home/seth/.composer/vendor/drush/drush&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s1"&gt;&amp;#39;%site&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;sites/default/&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
  &lt;span class="p"&gt;),&lt;/span&gt;
&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Check that your system meets the minimum core requirements:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$ &lt;/span&gt;drush @drupal8 core-requirements
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Check the status of the site installation by running &lt;tt class="docutils literal"&gt;drush &amp;#64;drupal8 status&lt;/tt&gt;.
The output is as follows:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$ &lt;/span&gt;drush @drupal8 status
&lt;span class="go"&gt; Drupal version         :  8.0.0-dev&lt;/span&gt;
&lt;span class="go"&gt; Site URI               :  http://drupal8&lt;/span&gt;
&lt;span class="go"&gt; Database driver        :  mysql&lt;/span&gt;
&lt;span class="go"&gt; Database hostname      :  localhost&lt;/span&gt;
&lt;span class="go"&gt; Database port          :&lt;/span&gt;
&lt;span class="go"&gt; Database username      :  drupal8&lt;/span&gt;
&lt;span class="go"&gt; Database name          :  drupal8&lt;/span&gt;
&lt;span class="go"&gt; Database               :  Connected&lt;/span&gt;
&lt;span class="go"&gt; Drupal bootstrap       :  Successful&lt;/span&gt;
&lt;span class="go"&gt; Drupal user            :  Anonymous&lt;/span&gt;
&lt;span class="go"&gt; Default theme          :  bartik&lt;/span&gt;
&lt;span class="go"&gt; Administration theme   :  seven&lt;/span&gt;
&lt;span class="go"&gt; PHP executable         :  /usr/bin/php&lt;/span&gt;
&lt;span class="go"&gt; PHP configuration      :  /etc/php5/cli/php.ini&lt;/span&gt;
&lt;span class="go"&gt; PHP OS                 :  Linux&lt;/span&gt;
&lt;span class="go"&gt; Drush version          :  7.0-dev&lt;/span&gt;
&lt;span class="go"&gt; Drush temp directory   :  /tmp&lt;/span&gt;
&lt;span class="go"&gt; Drush configuration    :&lt;/span&gt;
&lt;span class="go"&gt; Drush alias files      :  /home/user/.drush/aliases.drushrc.php&lt;/span&gt;
&lt;span class="go"&gt; Drupal root            :  /var/www/drupal8&lt;/span&gt;
&lt;span class="go"&gt; Site path              :  sites/default&lt;/span&gt;
&lt;span class="go"&gt; File directory path    :  sites/default/files&lt;/span&gt;
&lt;span class="go"&gt; Temporary file         :  /tmp&lt;/span&gt;
&lt;span class="go"&gt; directory path&lt;/span&gt;
&lt;span class="go"&gt; Active config path     :  sites/default/files/config_jP-uX_4rcMWllW18FM124krsM&lt;/span&gt;
&lt;span class="go"&gt;                           An44d1rdD2t5zXZLAaQcrXQjUATnoTTQ5gtw-iH5fqcmlTFCQ/ac&lt;/span&gt;
&lt;span class="go"&gt;                           tive&lt;/span&gt;
&lt;span class="go"&gt; Staging config path    :  sites/default/files/config_jP-uX_4rcMWllW18FM124krsM&lt;/span&gt;
&lt;span class="go"&gt;                           An44d1rdD2t5zXZLAaQcrXQjUATnoTTQ5gtw-iH5fqcmlTFCQ/st&lt;/span&gt;
&lt;span class="go"&gt;                           aging&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="install-contrib-modules"&gt;
&lt;h2&gt;&lt;a class="toc-backref" href="#id9"&gt;Install contrib modules&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Two useful modules for developers are &lt;a class="reference external" href="https://www.drupal.org/project/devel"&gt;devel&lt;/a&gt; and &lt;a class="reference external" href="https://www.drupal.org/project/examples"&gt;examples&lt;/a&gt;.&lt;/p&gt;
&lt;div class="section" id="devel"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id10"&gt;Devel&lt;/a&gt;&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$ &lt;/span&gt;drush @drupal8 pm-download devel
&lt;span class="gp"&gt;$ &lt;/span&gt;drush @drupal8 pm-enable devel
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="examples"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id11"&gt;Examples&lt;/a&gt;&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$ &lt;/span&gt;drush @drupal8 pm-download examples
&lt;span class="gp"&gt;$ &lt;/span&gt;drush @drupal8 pm-enable examples
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The single command &lt;tt class="docutils literal"&gt;drush &amp;#64;drupal8 &lt;span class="pre"&gt;pm-enable&lt;/span&gt; module&lt;/tt&gt; downloads module (if
required) before enabling it.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="regularly-update-drupal-core"&gt;
&lt;h2&gt;&lt;a class="toc-backref" href="#id12"&gt;Regularly update Drupal core&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;As Drupal&amp;nbsp;8 pushes on through beta releases you should regularly merge in the
latest code:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp gp-VirtualEnv"&gt;(master)&lt;/span&gt;&lt;span class="gp"&gt;$ &lt;/span&gt;git checkout master
&lt;span class="gp gp-VirtualEnv"&gt;(master)&lt;/span&gt;&lt;span class="gp"&gt;$ &lt;/span&gt;git fetch upstream
&lt;span class="gp gp-VirtualEnv"&gt;(master)&lt;/span&gt;&lt;span class="gp"&gt;$ &lt;/span&gt;git merge upstream/8.0.x
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Remember to rebuild the site after each merge:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$ &lt;/span&gt;drush cache-rebuild
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Before all issues tagged with “D8 upgrade path” have been closed you may find
that you are required to repeat the preceding site installation commands after
updating Drupal core.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="further-reading"&gt;
&lt;h2&gt;&lt;a class="toc-backref" href="#id13"&gt;Further reading&lt;/a&gt;&lt;/h2&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;a class="reference external" href="https://www.drupal.org/node/803746"&gt;Building a Drupal site with Git&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="http://git-scm.com/"&gt;git-scm.com&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
</content><category term="Web development"></category><category term="Drupal 8"></category><category term="Drupal"></category></entry></feed>